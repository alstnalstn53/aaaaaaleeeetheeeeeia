<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aletheia</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/EffectComposer.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/RenderPass.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/ShaderPass.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/CopyShader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/LuminosityHighPassShader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/UnrealBloomPass.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
<script src="https://unpkg.com/lenis@1.1.18/dist/lenis.min.js"></script>
<style>
:root{--bg:#fafaf8;--text:#111;--sub:#555;--line:#e0e0e0;--nav-bg:rgba(250,250,248,0.45);--font-main:"Helvetica Neue","Arial",sans-serif;--font-mono:"Courier New",Courier,monospace;--cursor-color:#000;--cursor-border:rgba(0,0,0,0.1);--cursor-ring-bg:rgba(255,255,255,0.05)}
body.dark-mode{--bg:#0a0a0a;--text:#e8e8e8;--sub:#999;--line:#222;--nav-bg:rgba(20,20,20,0.6);--cursor-color:#fff;--cursor-border:rgba(255,255,255,0.15);--cursor-ring-bg:rgba(255,255,255,0.03)}
*{transition:color 0.6s ease,border-color 0.6s ease,background-color 0.6s ease}
*{margin:0;padding:0;box-sizing:border-box;cursor:none!important}
body{background:var(--bg);color:var(--text);font-family:var(--font-main);line-height:1.5;overflow-x:hidden;transition:background 0.8s cubic-bezier(0.4,0,0.2,1),color 0.6s ease}
body::after{content:"";position:fixed;top:0;left:0;width:100%;height:100%;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.05'/%3E%3C/svg%3E");pointer-events:none;z-index:9000;opacity:0.03}
.cursor-dot{width:4px;height:4px;background:var(--cursor-color);border-radius:50%;position:fixed;pointer-events:none;z-index:999999;transition:transform 0.1s,background 0.4s}
.cursor-ring{width:34px;height:34px;border:1px solid var(--cursor-border);border-radius:50%;position:fixed;pointer-events:none;z-index:999999;transition:transform 0.2s ease-out,border-color 0.4s,background 0.4s;transform:translate(-50%,-50%);backdrop-filter:blur(3px);background:var(--cursor-ring-bg)}
body.hovered .cursor-ring{transform:translate(-50%,-50%) scale(1.2);background:rgba(255,255,255,0.1);border-color:rgba(0,0,0,0.2);backdrop-filter:blur(0)}
body.dark-mode.hovered .cursor-ring{background:rgba(255,255,255,0.05);border-color:rgba(255,255,255,0.3)}
body.clicking .cursor-ring{transform:translate(-50%,-50%) scale(0.7);transition:transform 0.08s}
body.clicking .cursor-dot{transform:scale(1.4);transition:transform 0.08s}
.container{max-width:1520px;margin:0 auto;padding:0 40px}
nav{position:fixed;top:20px;left:50%;transform:translateX(-50%);width:98%;max-width:1580px;height:75px;display:flex;justify-content:space-between;align-items:center;padding:0 40px;z-index:7000;background:var(--nav-bg);border:1px solid rgba(255,255,255,0.15);border-radius:6px;backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);box-shadow:0 10px 30px rgba(0,0,0,0.02);transition:background 0.8s,border-color 0.8s}}
.logo{font-size:19px;font-weight:300;letter-spacing:-0.01em;cursor:pointer;display:flex;align-items:center;gap:8px;color:#000;line-height:1}
.logo svg{width:20px;height:20px;fill:none;stroke:#000;stroke-width:1.5;flex-shrink:0;vertical-align:middle;position:relative;top:-1px}
.nav-center{display:flex;gap:32px;list-style:none;position:absolute;left:50%;transform:translateX(-50%);font-size:12px;font-weight:400;letter-spacing:0.05em}
.nav-center li{color:#999;transition:color 0.6s ease;cursor:pointer;position:relative;padding:6px 0}
.nav-center li:hover{color:#000}
.nav-center li:active{transform:scale(0.94);transition:0.06s}
.nav-center li.active{color:#000;font-weight:600}
.nav-center li.active::after{content:'';position:absolute;bottom:-2px;left:0;right:0;height:1.5px;background:#000}
.nav-auth{display:flex;align-items:center;gap:12px}
.btn-signin{display:flex;align-items:center;gap:7px;padding:0 16px;height:34px;border:1px solid rgba(0,0,0,0.1);border-radius:8px;background:transparent;font-size:12px;font-weight:400;color:#333;cursor:pointer;transition:0.2s;font-family:inherit;box-sizing:border-box}
.btn-signin:hover{border-color:rgba(0,0,0,0.25);background:rgba(0,0,0,0.02)}
.btn-signin svg{width:14px;height:14px}
.nav-profile{display:none;align-items:center;cursor:pointer;position:relative}
.nav-profile.show{display:flex}
.nav-profile-btn{display:flex;align-items:center;gap:7px;padding:0 16px;height:34px;border:1px solid rgba(0,0,0,0.1);border-radius:8px;background:transparent;font-size:12px;font-weight:400;color:#333;cursor:pointer;transition:0.2s;font-family:inherit;box-sizing:border-box}
.nav-profile-btn:hover{border-color:rgba(0,0,0,0.25);background:rgba(0,0,0,0.02)}
.nav-profile-btn svg{width:14px;height:14px;stroke:currentColor;fill:none;stroke-width:1.5}
.nav-name{font-size:13px;font-weight:400}
.profile-dropdown{display:none;position:absolute;top:50px;right:0;background:#fff;border:1px solid rgba(0,0,0,0.08);border-radius:10px;padding:6px;min-width:160px;box-shadow:0 8px 30px rgba(0,0,0,0.12);z-index:9999}
.profile-dropdown.show{display:block}
.pd-item{display:block;width:100%;padding:9px 14px;font-size:12px;color:#333;border:none;background:none;text-align:left;cursor:pointer;border-radius:6px;transition:0.15s;font-family:inherit}
.pd-item:hover{background:rgba(0,0,0,0.04)}
.page{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;visibility:hidden;transition:opacity 1.2s ease;overflow:hidden;background:transparent;pointer-events:none}
.page.active{opacity:1;visibility:visible;z-index:2;pointer-events:auto}
#page-about{overflow-y:auto;background:transparent}
#canvas-container{position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:auto}

/* ABOUT */
#page-about .container{background:transparent}
#page-about section{padding:180px 0;border-bottom:1px solid rgba(0,0,0,0.04);position:relative}
.reveal{opacity:0;filter:blur(15px);transform:translateY(50px);will-change:transform,opacity,filter}
.reveal.active{opacity:1;filter:blur(0);transform:translateY(0)}
.typing-target{opacity:0}.typing-active{opacity:1}
.hero-top{height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;overflow:hidden;z-index:1;gap:20px}
.hero-landing{display:contents}
.hl-logo{font-size:clamp(18px,2.2vw,26px);font-weight:500;letter-spacing:0.04em;color:#000;opacity:0;transform:translateY(-10px);filter:blur(6px);transition:opacity 4s cubic-bezier(0.19,1,0.22,1),transform 4s cubic-bezier(0.19,1,0.22,1),filter 4s cubic-bezier(0.19,1,0.22,1);line-height:1.4;text-align:center}
.hl-logo.visible{opacity:1;transform:translateY(0);filter:blur(0)}
.hl-bottom{display:flex;flex-direction:column;align-items:center}
.hl-typing{font-size:clamp(28px,3.5vw,52px);font-weight:400;color:#222;letter-spacing:0.01em;min-height:1.4em;text-align:center;line-height:1.3;text-shadow:0 0 40px rgba(255,255,255,0.9)}
.hl-typing .cursor{display:inline-block;width:2px;height:1em;background:#000;margin-left:2px;animation:blink 0.6s infinite;vertical-align:text-bottom}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0}}
.hl-subtitle{margin-top:20px;text-align:center;opacity:0;transform:translateY(10px);transition:opacity 2s ease,transform 2s ease}
.hl-subtitle.visible{opacity:1;transform:translateY(0)}
.hl-sub-line1{font-size:clamp(11px,1.2vw,14px);color:#666;letter-spacing:0.02em;margin-bottom:8px;line-height:1.5}
.hl-sub-line2{font-size:clamp(10px,1.1vw,13px);color:#888;letter-spacing:0.01em;line-height:1.6;font-weight:300}
.hl-buttons{display:flex;gap:12px;margin-top:24px;opacity:0;transform:translateY(10px);filter:blur(6px);transition:opacity 4s cubic-bezier(0.19,1,0.22,1),transform 4s cubic-bezier(0.19,1,0.22,1),filter 4s cubic-bezier(0.19,1,0.22,1)}
.hl-buttons.visible{opacity:1;transform:translateY(0);filter:blur(0)}
.hl-btn{padding:12px 28px;border:1px solid rgba(0,0,0,0.1);border-radius:30px;background:rgba(255,255,255,0.2);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);font-size:11px;font-weight:600;letter-spacing:0.12em;color:#111;cursor:pointer;transition:all 0.3s;font-family:inherit}
.hl-btn:hover{background:rgba(0,0,0,0.06);border-color:rgba(0,0,0,0.25);transform:translateY(-2px)}
.hl-btn:active{transform:translateY(0) scale(0.96);transition:all 0.08s}
.scroll-indicator{position:absolute;bottom:40px;left:50%;transform:translateX(-50%);display:flex;flex-direction:column;align-items:center;gap:8px;opacity:0;transition:opacity 1.5s ease}
.scroll-indicator.visible{animation:scrollFade 3s ease-in-out infinite}
@keyframes scrollFade{0%,100%{opacity:0.3}50%{opacity:1}}
.scroll-icon{width:24px;height:36px;border:2px solid rgba(0,0,0,0.2);border-radius:12px;position:relative;display:flex;justify-content:center;padding-top:6px}
.scroll-wheel{width:3px;height:6px;background:rgba(0,0,0,0.3);border-radius:2px;animation:scrollWheel 2s ease-in-out infinite}
@keyframes scrollWheel{0%,100%{transform:translateY(0);opacity:1}50%{transform:translateY(10px);opacity:0.3}}
.scroll-text{font-size:10px;letter-spacing:0.15em;color:rgba(0,0,0,0.3);font-weight:400;text-transform:uppercase}
.label{font-size:42px;font-weight:500;letter-spacing:-0.02em;color:#000;margin-bottom:80px;display:block;font-family:var(--font-main);min-height:1.2em;text-shadow:0 0 30px rgba(255,255,255,0.8)}
.phi-text{font-size:28px;font-weight:300;line-height:1.5;max-width:900px;margin-bottom:40px;color:#222;text-shadow:0 0 20px rgba(255,255,255,0.6)}
.phi-desc{font-size:16px;color:var(--sub);line-height:1.7;max-width:750px;font-weight:300;text-shadow:0 0 20px rgba(255,255,255,0.6)}
.method-list{display:flex;flex-direction:column;width:100%}
.method-row{display:flex;justify-content:space-between;align-items:flex-start;padding:80px 0;border-bottom:1px solid rgba(0,0,0,0.04);position:relative;transition:0.3s}
.method-row:last-child{border-bottom:none}
.method-left{width:30%;display:flex;flex-direction:column;padding-top:10px}
.m-num{font-size:12px;font-weight:600;color:#999;margin-bottom:20px;letter-spacing:0.05em}
.m-desc{font-size:15px;line-height:1.6;color:#444;margin-bottom:30px;font-weight:300;word-break:keep-all}
.m-btn{padding:10px 24px;font-size:12px;font-weight:600;border:1px solid #ccc;background:transparent;color:#000;border-radius:50px;width:fit-content;cursor:pointer;transition:all 0.3s ease;font-family:inherit}
.m-btn:hover{border-color:#000;background:#000;color:#fff;transform:translateY(-2px)}
.m-btn:active{transform:translateY(0) scale(0.95);transition:all 0.08s}
.method-right{width:65%;text-align:right;user-select:none}
.big-typo{display:flex;justify-content:flex-end;gap:5px;font-size:clamp(50px,8vw,120px);font-weight:300;line-height:0.9;color:#000;letter-spacing:-0.02em;cursor:default;text-shadow:0 0 40px rgba(255,255,255,0.9);filter:blur(6px);opacity:0.4;transition:filter 0.6s,opacity 0.6s}
.method-row:hover .big-typo{filter:blur(0);opacity:1}
.char{display:inline-block;transition:transform 0.4s cubic-bezier(0.175,0.885,0.32,1.275);will-change:transform}
footer{padding:60px 0;font-size:12px;color:var(--sub);display:flex;justify-content:space-between;border-top:1px solid var(--line);margin-top:100px}

/* SERVICE PAGES */

/* ===== DEMO SECTIONS ===== */
.demo-section{padding:140px 0!important;transform:scale(0.96);filter:blur(4px);opacity:0.4;will-change:transform,opacity,filter}
.demo-section.focused{transform:scale(1);filter:blur(0);opacity:1}
.demo-layout{display:flex;gap:60px;align-items:center;max-width:1200px;margin:0 auto;padding:0 40px}
.demo-layout-reverse{flex-direction:row-reverse}
.demo-text{flex:1;min-width:0}
.demo-visual{flex:1;min-width:0}
.demo-num{font-size:10px;font-weight:500;color:#c9a96e;letter-spacing:0.12em;display:block;margin-bottom:20px}
body.dark-mode .demo-num{color:#8b7355}
.demo-title{font-size:clamp(24px,3vw,36px);font-weight:400;letter-spacing:-0.02em;line-height:1.4;margin-bottom:20px;color:#111}
body.dark-mode .demo-title{color:#e8e8e8}
.demo-desc{font-size:15px;line-height:1.9;color:#555;font-weight:300;word-break:keep-all;margin-bottom:12px;letter-spacing:-0.01em}
body.dark-mode .demo-desc{color:#999}
.demo-sub{font-size:13px;color:#aaa;font-weight:300;line-height:1.6}

/* Demo Chat Mock - Premium Architectural */
.demo-chat-mock{background:rgba(255,255,255,0.4);backdrop-filter:blur(60px) saturate(200%);-webkit-backdrop-filter:blur(60px) saturate(200%);border:0.5px solid rgba(0,0,0,0.06);border-radius:24px;overflow:hidden;max-width:520px;box-shadow:0 1px 0 rgba(255,255,255,0.5) inset,0 30px 80px rgba(0,0,0,0.03),0 2px 6px rgba(0,0,0,0.02)}
body.dark-mode .demo-chat-mock{background:rgba(255,255,255,0.03);border-color:rgba(255,255,255,0.06);box-shadow:0 1px 0 rgba(255,255,255,0.04) inset,0 30px 80px rgba(0,0,0,0.3)}
.dcm-header{padding:20px 28px 14px;display:flex;align-items:center;gap:10px;border-bottom:0.5px solid rgba(0,0,0,0.04)}
body.dark-mode .dcm-header{border-bottom-color:rgba(255,255,255,0.04)}
.dcm-status{width:5px;height:5px;border-radius:50%;background:#22c55e;box-shadow:0 0 8px rgba(34,197,94,0.3);animation:pulse 3s ease-in-out infinite}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:0.6;transform:scale(0.9)}}
.dcm-title{font-size:9px;letter-spacing:0.14em;color:#aaa;font-weight:500;text-transform:uppercase}
body.dark-mode .dcm-title{color:#555}
.dcm-messages{padding:24px 28px 36px;display:flex;flex-direction:column;gap:32px;height:460px;overflow:hidden;position:relative}
.dcm-messages::after{content:'';position:absolute;bottom:0;left:0;right:0;height:80px;background:linear-gradient(transparent,rgba(255,255,255,0.6));pointer-events:none}
body.dark-mode .dcm-messages::after{background:linear-gradient(transparent,rgba(10,10,10,0.6))}
.dcm-msg{filter:blur(12px);opacity:0.1;transition:filter 1.4s cubic-bezier(0.16,1,0.3,1),opacity 1.4s cubic-bezier(0.16,1,0.3,1);display:flex;flex-direction:column;gap:8px}
.dcm-msg.show{filter:blur(0);opacity:1}
.dcm-label{font-size:9px;letter-spacing:0.12em;color:#c9a96e;display:block;font-weight:500;text-transform:uppercase}
body.dark-mode .dcm-label{color:#8b7355}
.dcm-user .dcm-label{text-align:right;color:#999}
body.dark-mode .dcm-user .dcm-label{color:#555}
.dcm-bubble{font-size:14.5px;line-height:2;color:#222;font-weight:300;padding:0;position:relative;word-break:keep-all;letter-spacing:-0.01em}
body.dark-mode .dcm-bubble{color:#ddd}
.dcm-ai .dcm-bubble{padding-left:16px;border-left:1.5px solid rgba(201,169,110,0.2);margin-left:4px}
body.dark-mode .dcm-ai .dcm-bubble{border-left-color:rgba(201,169,110,0.15)}
.dcm-user{align-items:flex-end}
.dcm-user .dcm-bubble{background:rgba(0,0,0,0.02);backdrop-filter:blur(20px);border-radius:16px;padding:14px 20px;border:0.5px solid rgba(0,0,0,0.04);max-width:85%}
body.dark-mode .dcm-user .dcm-bubble{background:rgba(255,255,255,0.03);border-color:rgba(255,255,255,0.06)}

/* Demo Profile Mock - Premium */
.demo-profile-mock{background:rgba(0,0,0,0.02);border:0.5px solid rgba(0,0,0,0.06);border-radius:20px;overflow:hidden;max-width:420px;box-shadow:0 20px 60px rgba(0,0,0,0.03)}
body.dark-mode .demo-profile-mock{background:rgba(255,255,255,0.02);border-color:rgba(255,255,255,0.06);box-shadow:0 20px 60px rgba(0,0,0,0.2)}
.dpm-header{padding:16px 20px;border-bottom:0.5px solid rgba(0,0,0,0.04);display:flex;justify-content:space-between;align-items:center}
body.dark-mode .dpm-header{border-color:rgba(255,255,255,0.04)}
.dpm-title{font-size:11px;font-weight:500;letter-spacing:0.08em;color:#c9a96e;text-transform:uppercase}
.dpm-ver{font-size:9px;color:#ccc;font-weight:400;letter-spacing:0.05em}
body.dark-mode .dpm-ver{color:#444}
.dpm-body{padding:20px}
.dpm-tag-area{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:20px}
.dpm-tag{padding:5px 12px;font-size:10px;border-radius:20px;border:0.5px solid rgba(0,0,0,0.08);color:#666;font-weight:400;opacity:0;transform:scale(0.8);transition:opacity 0.5s,transform 0.5s;letter-spacing:0.02em}
body.dark-mode .dpm-tag{border-color:rgba(255,255,255,0.08);color:#999}
.dpm-tag.show{opacity:1;transform:scale(1)}
.dpm-section{margin-bottom:18px;padding-top:14px;border-top:0.5px solid rgba(0,0,0,0.03)}
.dpm-section:first-of-type{border-top:none;padding-top:0}
body.dark-mode .dpm-section{border-top-color:rgba(255,255,255,0.03)}
.dpm-label{font-size:9px;letter-spacing:0.1em;text-transform:uppercase;color:#aaa;display:block;margin-bottom:8px;font-weight:500}
body.dark-mode .dpm-label{color:#555}
.dpm-value,.dpm-narrative{font-size:13.5px;line-height:1.8;color:#333;font-weight:300;letter-spacing:-0.01em}
body.dark-mode .dpm-value,body.dark-mode .dpm-narrative{color:#bbb}
.dpm-energy{display:flex;flex-direction:column;gap:6px}
.dpm-energy-high{font-size:12px;color:#22c55e;font-weight:300}
.dpm-energy-low{font-size:12px;color:#ef4444;font-weight:300;opacity:0.7}
body.dark-mode .demo-manifesto .dm-line{color:#888}
body.dark-mode .dm-line-strong{color:#eee}
body.dark-mode .dm-divider{background:rgba(255,255,255,0.08)}

/* Demo Essence Flow */
/* MANIFESTO VISUAL - Premium */
.demo-manifesto{padding:48px 36px;display:flex;flex-direction:column;gap:16px;position:relative}
.demo-manifesto::before{content:'';position:absolute;top:40px;left:36px;width:2px;height:calc(100% - 80px);background:linear-gradient(to bottom,rgba(0,0,0,0.04),rgba(0,0,0,0.01));pointer-events:none}
body.dark-mode .demo-manifesto::before{background:linear-gradient(to bottom,rgba(255,255,255,0.06),rgba(255,255,255,0.01))}
.dm-line{font-size:clamp(16px,2vw,22px);font-weight:300;color:var(--sub);line-height:1.5;transition:all 0.6s;padding-left:20px}
.dm-line-fade{opacity:0.3}
.dm-line-strike{opacity:0.25;text-decoration:line-through;text-decoration-color:rgba(255,255,255,0.2)}
body:not(.dark-mode) .dm-line-strike{text-decoration-color:rgba(0,0,0,0.15)}
.dm-line-strong{font-weight:400;color:var(--text);font-size:clamp(20px,2.5vw,28px);letter-spacing:-0.01em;padding-left:20px}
.dm-divider{width:40px;height:1px;background:var(--line);margin:12px 0 8px 20px}

/* ===== MOBILE RESPONSIVE ===== */
/* ===== HAMBURGER ===== */
.nav-hamburger{display:none;flex-direction:column;gap:4px;padding:8px;cursor:pointer!important;background:none;border:none;z-index:7001}
.nav-hamburger span{display:block;width:18px;height:1.5px;background:var(--text);transition:all 0.3s;border-radius:1px}
.nav-hamburger.open span:nth-child(1){transform:rotate(45deg) translate(4px,4px)}
.nav-hamburger.open span:nth-child(2){opacity:0}
.nav-hamburger.open span:nth-child(3){transform:rotate(-45deg) translate(4px,-4px)}
.nav-mobile-menu{display:none;position:fixed;top:0;left:0;width:100%;height:100vh;height:100dvh;background:var(--bg);z-index:6999;flex-direction:column;align-items:center;justify-content:center;gap:28px;opacity:0;transition:opacity 0.3s}
.nav-mobile-menu.show{display:flex;opacity:1}
.nav-mobile-menu li{list-style:none;font-size:16px;font-weight:300;letter-spacing:0.1em;color:var(--text);cursor:pointer!important;padding:12px 24px;transition:0.2s}
.nav-mobile-menu li:hover{opacity:0.6}
/* ===== ESSENCE PROMPTS BLUR ===== */
.essence-prompts{margin-top:16px;padding:14px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.06);border-radius:12px}
body:not(.dark-mode) .essence-prompts{background:rgba(0,0,0,0.02);border-color:rgba(0,0,0,0.06)}
.ep-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
.ep-title{font-size:10px;font-weight:600;letter-spacing:0.08em;color:var(--sub);display:flex;align-items:center;gap:6px}
.ep-title svg{width:13px;height:13px;stroke:currentColor;fill:none;stroke-width:1.5}
.ep-badge{font-size:8px;padding:2px 7px;border-radius:10px;background:rgba(255,200,0,0.15);color:#b8860b;font-weight:600}
body.dark-mode .ep-badge{background:rgba(255,200,0,0.1);color:#daa520}
.ep-list{display:flex;flex-direction:column;gap:5px}
.ep-item{font-size:12px;line-height:1.6;color:var(--text);padding:7px 10px;background:rgba(255,255,255,0.03);border-radius:6px;border:1px solid rgba(255,255,255,0.04);overflow:hidden;transition:all 0.3s}
body:not(.dark-mode) .ep-item{background:rgba(0,0,0,0.015);border-color:rgba(0,0,0,0.04)}
.ep-item.locked{filter:blur(5px);user-select:none;pointer-events:none}
.ep-item.preview{filter:blur(0)}
.ep-unlock{display:flex;align-items:center;justify-content:center;gap:6px;margin-top:10px;padding:8px 16px;border:1px solid rgba(255,255,255,0.1);border-radius:8px;background:rgba(255,255,255,0.03);font-size:11px;color:var(--sub);cursor:pointer!important;transition:all 0.3s;font-family:inherit;width:100%}
body:not(.dark-mode) .ep-unlock{border-color:rgba(0,0,0,0.1);background:rgba(0,0,0,0.02)}
.ep-unlock:hover{background:rgba(255,255,255,0.08);color:var(--text)}
.ep-unlock svg{width:13px;height:13px;stroke:currentColor;fill:none;stroke-width:1.5}
/* ===== PATTERN INSIGHT CARD ===== */
/* INSIGHT TOAST — fixed top of chat */
.insight-toast{position:absolute;top:52px;left:50%;transform:translateX(-50%) translateY(-10px);padding:8px 16px;background:rgba(20,20,20,0.85);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,0.08);border-radius:8px;font-size:11px;color:rgba(255,255,255,0.8);z-index:100;opacity:0;transition:all 0.6s cubic-bezier(0.19,1,0.22,1);pointer-events:none;max-width:80%;text-align:center;letter-spacing:0.01em;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
body:not(.dark-mode) .insight-toast{background:rgba(0,0,0,0.75);color:rgba(255,255,255,0.9)}
.insight-toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
/* ===== PROGRESS STAGES ===== */
.um-depth-stages{display:flex;justify-content:space-between;margin-top:8px;position:relative}
.um-depth-stages::before{content:'';position:absolute;top:50%;left:10%;right:10%;height:1px;background:rgba(255,255,255,0.06);z-index:0}
body:not(.dark-mode) .um-depth-stages::before{background:rgba(0,0,0,0.06)}
.um-stage{font-size:8px;font-weight:600;letter-spacing:0.06em;color:var(--sub);opacity:0.3;transition:all 0.6s;position:relative;z-index:1;padding:2px 4px}
.um-stage.active{opacity:1;color:var(--text)}
.um-stage.completed{opacity:0.6}
/* ===== ESSENCE DOC GEN ===== */
.essence-doc-gen{margin-top:14px;text-align:center}
.ed-btn{display:flex;align-items:center;justify-content:center;gap:8px;width:100%;padding:12px 16px;border:1px solid rgba(255,255,255,0.12);border-radius:10px;background:rgba(255,255,255,0.04);font-size:12px;font-weight:500;color:var(--text);cursor:pointer!important;transition:all 0.3s;font-family:inherit;letter-spacing:0.02em}
body:not(.dark-mode) .ed-btn{border-color:rgba(0,0,0,0.1);background:rgba(0,0,0,0.02)}
.ed-btn:hover{background:rgba(255,255,255,0.1);transform:translateY(-1px)}
.ed-btn svg{width:15px;height:15px;stroke:currentColor;fill:none;stroke-width:1.5}
.ed-desc{font-size:9px;color:var(--sub);margin-top:6px;line-height:1.5;opacity:0.7}
/* ===== MOBILE ===== */
@media(max-width:768px){
  *{cursor:auto!important}
  .cursor-dot,.cursor-ring{display:none!important}
  body::after{display:none}
  .demo-section{transform:scale(0.98)!important;filter:blur(2px)!important;opacity:0.6!important}
  .demo-section.focused{transform:scale(1)!important;filter:blur(0)!important;opacity:1!important}
  nav{top:0;height:56px;padding:0 16px;border-radius:0;width:100%;max-width:100%}
  .logo{font-size:15px}.logo svg{width:20px;height:20px}
  .nav-center{display:none!important}
  .nav-auth{display:none!important}
  .nav-profile{display:none!important}
  .nav-hamburger{display:flex}
  .btn-theme{width:30px;height:30px}.btn-theme svg{width:13px;height:13px}
  .lang-btn{padding:0 8px;height:30px;font-size:10px}
  .container{padding:0 20px}
  .hero-top{height:80vh;gap:14px}
  .hl-logo{font-size:16px!important}
  .hl-typing{font-size:22px!important}
  .hl-sub-line1{font-size:10px!important}
  .hl-sub-line2{font-size:9px!important}
  .hl-buttons{flex-direction:column;gap:8px}
  .hl-btn{font-size:10px;padding:10px 24px}
  #page-about section{padding:80px 0!important}
  .label{font-size:24px!important;margin-bottom:40px!important}
  .phi-text{font-size:18px!important;line-height:1.6}
  .phi-desc{font-size:13px!important}
  .demo-section{padding:60px 0!important}
  .demo-layout,.demo-layout-reverse{flex-direction:column!important;gap:24px;padding:0 20px}
  .demo-title{font-size:20px!important}
  .demo-desc{font-size:13px}
  .demo-chat-mock,.demo-profile-mock{max-width:100%;width:100%}
  .dcm-messages{height:400px;padding:8px 20px 28px;gap:24px}
  .dcm-bubble{font-size:13px;line-height:1.9}
  .scroll-indicator{bottom:30px}
  .method-row{flex-direction:column!important;padding:50px 0!important}
  .method-left,.method-right{width:100%!important}
  .method-left{margin-bottom:30px}.method-right{text-align:left}
  .big-typo{font-size:40px!important;justify-content:flex-start!important;filter:blur(0)!important;opacity:0.6!important}
  .chatbox-wrap{padding:0 8px 8px!important;flex-direction:column;gap:8px}
  .chatbox{max-width:100%;border-radius:16px}
  .chatbox.expanded{height:calc(100vh - 80px)!important;height:calc(100dvh - 80px)!important;border-radius:16px 16px 0 0}
  .unmask-panel{display:none!important}
  .cb-bar{padding:0 12px!important;height:48px!important}
  .cb-ta{font-size:14px!important;text-align:left!important}
  .cb-btns-left,.cb-side-btns{gap:4px!important}
  .cb-side-btns .cb-btn{display:none}.cb-side-btns .cb-btn:last-child{display:flex}
  .cb-msgs{padding:12px!important}
  .msg-body{max-width:90%!important;font-size:14px!important}
  .msg-actions{opacity:1}
  .cb-header{padding:10px 14px!important}
  .cb-header-actions{gap:6px!important}
  .svc-intro{padding:0 20px}
  .svc-intro-title{font-size:24px!important}
  .svc-intro-desc{font-size:13px!important}
  .ir-grid{grid-template-columns:1fr}
  .archive-map-canvas{height:auto;min-height:100vh;padding:0 20px;display:flex;flex-direction:column;align-items:center;gap:40px;padding-top:160px;padding-bottom:60px}
  .archive-map-canvas .map-lines{display:none}
  .map-node{position:relative!important;left:auto!important;top:auto!important;transform:none!important}
  .map-label{position:relative;top:auto;left:auto;transform:none;margin-top:10px}
  .map-container{transform:scale(0.7)!important}
  .project-detail-inner{padding:70px 24px}
  .project-detail-close{top:20px;right:20px;width:36px;height:36px}
  .pd-gallery{grid-template-columns:1fr}.pd-gallery-item.wide{grid-column:span 1}
  .pd-meta{flex-wrap:wrap;gap:20px}
  .pricing-grid{grid-template-columns:1fr}
  .mypage-grid{grid-template-columns:1fr}
  .side-panel{width:100%!important;max-width:100%!important;right:0!important;border-radius:16px 16px 0 0!important;bottom:0!important;top:auto!important;max-height:70vh!important}
  .cbp-scroll{padding:12px!important}
  footer{flex-direction:column;gap:8px;text-align:center;padding:40px 0!important}
}
@media(max-width:480px){
  nav{padding:0 12px;height:50px}
  .hero-top{height:70vh}
  .hl-typing{font-size:18px!important}
  .hl-sub-line1{font-size:9px!important}
  .hl-sub-line2{font-size:8px!important}
  .demo-title{font-size:18px!important}
  .dcm-messages{height:380px!important;padding:8px 18px 24px;gap:22px}
  .dcm-bubble{font-size:13px!important;line-height:1.85!important}
  .scroll-indicator{bottom:25px;transform:translateX(-50%) scale(0.9)}
  .dpm-body{padding:12px}
  .label{font-size:20px!important}
}

@media(max-width:480px){
  nav{padding:0 12px;height:50px}
  .nav-center{gap:12px;font-size:9px}
  .demo-title{font-size:19px!important}
  .demo-desc{font-size:12px}
  .dcm-messages{height:360px!important;padding:8px 16px 20px;gap:20px}
  .dcm-bubble{font-size:12px!important;line-height:1.8!important}
  .dcm-header{padding:16px 20px 12px}
  .scroll-indicator{display:none}
  .dpm-body{padding:14px}
}
/* ===== END MOBILE ===== */

/* ===== END MOBILE ===== */
/* ===== URP — In-chatbox slide panel ===== */
.cb-slider{display:flex;width:200%;flex:1;min-height:0;transition:transform 0.5s cubic-bezier(0.16,1,0.3,1)}
.cb-slider.show-urp{transform:translateX(-50%)}
.cb-slider>.cb-body{width:50%;flex-shrink:0;display:flex;flex-direction:column;overflow:hidden}
.cb-slider>.urp-view{width:50%;flex-shrink:0;display:flex;flex-direction:column;overflow:hidden}
/* URP header */
.urp-head{padding:12px 18px;border-bottom:1px solid rgba(0,0,0,0.06);display:flex;align-items:center;gap:10px;flex-shrink:0}
.urp-back{width:28px;height:28px;border:1px solid rgba(0,0,0,0.08);border-radius:8px;background:transparent;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:0.2s;flex-shrink:0}
.urp-back:hover{border-color:rgba(0,0,0,0.2);background:rgba(0,0,0,0.03)}
.urp-back svg{width:14px;height:14px;stroke:#777;fill:none;stroke-width:1.5}
.urp-head-title{font-size:11px;font-weight:500;letter-spacing:0.08em;color:#999;flex:1}
.urp-head-badge{font-size:8px;padding:2px 8px;border-radius:10px;background:rgba(0,0,0,0.04);color:#aaa;font-family:'Courier New',monospace;letter-spacing:0.05em}
.urp-print{width:28px;height:28px;border:1px solid rgba(0,0,0,0.08);border-radius:8px;background:transparent;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:0.2s;flex-shrink:0}
.urp-print:hover{border-color:rgba(0,0,0,0.2);background:rgba(0,0,0,0.03)}
.urp-print svg{width:13px;height:13px;stroke:#777;fill:none;stroke-width:1.5}
/* URP body */
.urp-body{flex:1;overflow-y:auto;padding:20px 18px;scrollbar-width:none;-ms-overflow-style:none}
.urp-body::-webkit-scrollbar{display:none}
/* URP content */
.urp-name{font-size:18px;font-weight:300;color:#1a1a1a;margin-bottom:2px}
.urp-role{font-size:10px;color:#999;font-family:'Courier New',monospace;letter-spacing:0.03em;margin-bottom:14px}
.urp-tags{display:flex;flex-wrap:wrap;gap:5px;margin-bottom:20px}
.urp-tag{padding:3px 10px;border-radius:14px;font-size:10px;font-weight:400;color:#555;border:1px solid rgba(0,0,0,0.07);background:rgba(0,0,0,0.02)}
.urp-card{background:rgba(0,0,0,0.02);border:1px solid rgba(0,0,0,0.05);border-radius:10px;padding:14px;margin-bottom:10px}
.urp-card-title{font-size:9px;font-weight:500;color:#999;margin-bottom:6px;letter-spacing:0.04em;text-transform:uppercase}
.urp-card-text{font-size:12.5px;font-weight:300;color:#1a1a1a;line-height:1.7}
.urp-card-sub{font-size:11px;font-weight:300;color:#777;line-height:1.6;margin-top:5px}
.urp-divider{font-size:8px;font-weight:400;letter-spacing:4px;color:#bbb;font-family:'Courier New',monospace;margin:24px 0 14px;text-align:center}
.urp-grid2{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:10px}
.urp-strike{text-decoration:line-through;color:#aaa;font-size:10px;line-height:1.7}
.urp-bold{font-weight:400;color:#1a1a1a;font-size:10px;line-height:1.7}
.urp-timeline{display:flex;flex-direction:column;gap:10px}
.urp-tl-item{display:flex;gap:10px;font-size:10px;color:#777}
.urp-tl-item.now{color:#1a1a1a;font-weight:400}
.urp-tl-year{width:54px;flex-shrink:0;font-family:'Courier New',monospace;font-size:9px}
.urp-tl-name{width:44px;flex-shrink:0;font-weight:400}
.urp-tl-desc{flex:1;font-weight:300}
.urp-mat-board{width:100%;aspect-ratio:16/9;border-radius:8px;overflow:hidden;position:relative;background:#e8e4dd;margin-bottom:12px}
.urp-mat-board img{width:100%;height:100%;object-fit:cover}
.urp-mat-item{display:flex;align-items:flex-start;gap:8px;padding:6px 0;border-bottom:1px solid rgba(0,0,0,0.04);font-size:10px}
.urp-mat-item:last-child{border-bottom:none}
.urp-mat-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;margin-top:2px}
.urp-mat-name{font-weight:400;color:#1a1a1a;min-width:40px}
.urp-mat-note{color:#999;font-family:'Courier New',monospace;font-size:8px}
.urp-mat-desc{color:#777;font-weight:300;flex:1}
.urp-kw-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.urp-kw-card{background:rgba(0,0,0,0.02);border:1px solid rgba(0,0,0,0.05);border-radius:8px;padding:12px}
.urp-kw-ko{font-size:13px;font-weight:300;color:#1a1a1a;margin-bottom:2px}
.urp-kw-en{font-size:7px;font-weight:400;letter-spacing:0.1em;color:#bbb;font-family:'Courier New',monospace;margin-bottom:5px}
.urp-kw-desc{font-size:9px;font-weight:300;color:#777;line-height:1.5}
.urp-empty{text-align:center;padding:60px 16px;color:#aaa;font-size:12px;line-height:1.8}
.urp-loading{text-align:center;padding:60px 16px;color:#999;font-size:12px}
.urp-golden-svg{display:block;margin:0 auto 12px;max-width:120px}
.urp-pos-svg{display:block;width:100%;max-width:320px;margin:0 auto}
/* URP dark mode */
body.dark-mode .urp-head{border-bottom-color:rgba(255,255,255,0.06)}
body.dark-mode .urp-back,body.dark-mode .urp-print{border-color:rgba(255,255,255,0.1)}
body.dark-mode .urp-back:hover,body.dark-mode .urp-print:hover{border-color:rgba(255,255,255,0.2);background:rgba(255,255,255,0.05)}
body.dark-mode .urp-back svg,body.dark-mode .urp-print svg{stroke:#888}
body.dark-mode .urp-name{color:#e8e8e8}
body.dark-mode .urp-card{background:rgba(255,255,255,0.03);border-color:rgba(255,255,255,0.06)}
body.dark-mode .urp-card-text{color:#ddd}
body.dark-mode .urp-card-sub{color:#666}
body.dark-mode .urp-tag{color:#aaa;border-color:rgba(255,255,255,0.08);background:rgba(255,255,255,0.03)}
body.dark-mode .urp-strike{color:#555}
body.dark-mode .urp-bold{color:#ddd}
body.dark-mode .urp-mat-name{color:#ddd}
body.dark-mode .urp-kw-card{background:rgba(255,255,255,0.03);border-color:rgba(255,255,255,0.06)}
body.dark-mode .urp-kw-ko{color:#e8e8e8}
body.dark-mode .urp-empty{color:#555}

.svc-page{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;position:relative;background:transparent}
.svc-intro{text-align:center;max-width:560px;padding:0 30px}
.svc-intro-num{font-size:11px;font-weight:600;color:#bbb;letter-spacing:0.15em;margin-bottom:16px}
.svc-intro-title{font-size:clamp(28px,3.5vw,48px);font-weight:400;letter-spacing:-0.02em;margin-bottom:16px;color:#111}
.svc-intro-desc{font-size:15px;color:#888;line-height:1.8;font-weight:400;word-break:keep-all}

/* Service page entrance animation */
.svc-anim{opacity:0;transform:translateY(20px);filter:blur(6px);transition:opacity 1.6s cubic-bezier(0.19,1,0.22,1),transform 1.6s cubic-bezier(0.19,1,0.22,1),filter 1.6s cubic-bezier(0.19,1,0.22,1)}
.svc-anim.visible{opacity:1;transform:translateY(0);filter:blur(0)}

/* ============================================
   CHATBOX (v4 pattern – bottom fixed, height expand)
   ============================================ */
.chatbox-wrap{position:fixed;left:0;right:0;bottom:0;width:100%;display:flex;justify-content:center;align-items:flex-end;gap:12px;padding:0 24px 12px;z-index:9999;pointer-events:none}
.chatbox-wrap>*{pointer-events:auto}
.chatbox{width:100%;max-width:700px;display:flex;flex-direction:column;height:56px;overflow:hidden;border-radius:20px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.08);backdrop-filter:blur(30px);-webkit-backdrop-filter:blur(30px);box-shadow:0 10px 40px rgba(0,0,0,0.03);transition:height 1.2s cubic-bezier(0.19,1,0.22,1),background 1s,box-shadow 1s,border-color 1s,backdrop-filter 1s,-webkit-backdrop-filter 1s;pointer-events:auto}
.chatbox.expanded{height:min(76vh,calc(100vh - 140px));background:rgba(255,255,255,0.12);box-shadow:0 20px 80px rgba(0,0,0,0.04);border-color:rgba(255,255,255,0.12);backdrop-filter:blur(40px);-webkit-backdrop-filter:blur(40px)}
/* UNMASK PANEL */
.unmask-panel{width:100%;max-width:560px;height:min(76vh,calc(100vh - 140px));border-radius:20px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.08);backdrop-filter:blur(40px);-webkit-backdrop-filter:blur(40px);box-shadow:0 20px 80px rgba(0,0,0,0.04);display:flex;flex-direction:column;overflow:hidden;flex-shrink:0}
.um-header{padding:16px 20px 12px;border-bottom:1px solid rgba(0,0,0,0.04);display:flex;align-items:center;justify-content:space-between;flex-shrink:0}
.um-header-title{font-size:11px;letter-spacing:0.1em;text-transform:uppercase;color:#999;font-weight:500}
.um-header-status{font-size:10px;color:#bbb;display:flex;align-items:center;gap:5px}
.um-status-dot{width:5px;height:5px;border-radius:50%;background:#ccc;transition:background 0.5s}
.um-status-dot.active{background:#4ade80;animation:statusPulse 2s ease-in-out infinite}
@keyframes statusPulse{0%,100%{opacity:1}50%{opacity:0.4}}
.um-body{flex:1;overflow-y:auto;padding:16px 20px;scrollbar-width:none;-ms-overflow-style:none}
.um-body::-webkit-scrollbar{display:none}
.um-empty{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;gap:12px;text-align:center}
.um-empty-icon{width:40px;height:40px;border-radius:50%;border:1px solid rgba(0,0,0,0.06);display:flex;align-items:center;justify-content:center}
.um-empty-icon svg{width:18px;height:18px;stroke:#ccc;fill:none;stroke-width:1.5}
.um-empty-text{font-size:12px;color:#bbb;line-height:1.6}
/* Data fragments */
.um-fragment{opacity:0;transform:translateY(8px);transition:opacity 0.6s,transform 0.6s;margin-bottom:16px}
.um-fragment.visible{opacity:1;transform:translateY(0)}
.um-frag-label{font-size:9px;letter-spacing:0.1em;text-transform:uppercase;color:#aaa;margin-bottom:6px;font-weight:500}
.um-frag-content{font-size:12px;color:#666;line-height:1.6}
.um-frag-tags{display:flex;flex-wrap:wrap;gap:4px;margin-top:4px}
.um-frag-tag{padding:3px 8px;border:1px solid rgba(0,0,0,0.06);border-radius:12px;font-size:10px;color:#888;background:rgba(0,0,0,0.02);animation:tagFadeIn 0.5s ease}
@keyframes tagFadeIn{from{opacity:0;transform:scale(0.8)}to{opacity:1;transform:scale(1)}}
.um-frag-bar{height:3px;border-radius:2px;background:rgba(0,0,0,0.04);margin-top:6px;overflow:hidden}
.um-frag-bar-fill{height:100%;border-radius:2px;background:rgba(0,0,0,0.15);transition:width 1s cubic-bezier(0.4,0,0.2,1);width:0}
.um-frag-node{display:flex;align-items:center;gap:8px;margin-bottom:8px}
.um-frag-dot{width:6px;height:6px;border-radius:50%;background:#000;opacity:0.15;flex-shrink:0}
.um-frag-line{font-size:11px;color:#777;line-height:1.5}
/* Dark mode */
body.dark-mode .um-header{border-bottom-color:rgba(255,255,255,0.04)}
body.dark-mode .unmask-panel{background:rgba(20,20,20,0.6);border-color:rgba(255,255,255,0.06)}body.dark-mode .um-empty-icon{border-color:rgba(255,255,255,0.08)}
body.dark-mode .um-empty-icon svg{stroke:#555}
body.dark-mode .um-empty-text{color:#555}
body.dark-mode .um-frag-content{color:#999}
body.dark-mode .um-frag-tag{border-color:rgba(255,255,255,0.06);color:#777;background:rgba(255,255,255,0.03)}
body.dark-mode .um-frag-bar{background:rgba(255,255,255,0.04)}
body.dark-mode .um-frag-bar-fill{background:rgba(255,255,255,0.2)}
body.dark-mode .um-frag-dot{background:#fff}
body.dark-mode .um-frag-line{color:#888}
.chatbox .cb-header,.chatbox .cb-msgs,.chatbox .cb-input{opacity:0;filter:blur(6px);transition:opacity 1s ease 0.3s,filter 1s ease 0.3s}
.chatbox.expanded .cb-header,.chatbox.expanded .cb-msgs,.chatbox.expanded .cb-input{opacity:1;filter:blur(0)}

/* Collapsed Bar */
.cb-bar{display:flex;align-items:center;gap:10px;padding:14px 18px;min-height:56px;height:56px;cursor:pointer;flex-shrink:0}
.cb-model{display:inline-flex;align-items:center;gap:5px;font-size:11px;font-weight:500;color:#999;padding:3px 10px;border-radius:6px;background:rgba(255,255,255,0.1);cursor:pointer;transition:0.2s;flex-shrink:0;-webkit-user-select:none;user-select:none}
.cb-model:active{transform:scale(0.93);transition:0.06s}
.cb-model:hover{background:rgba(0,0,0,0.07);color:#666}
.cb-model .dot{width:5px;height:5px;border-radius:50%}
.cb-model .arr{width:10px;height:10px;stroke:currentColor;fill:none;stroke-width:2}
.cb-ph{flex:1;font-size:14px;color:#bbb;font-weight:400;display:flex;align-items:center}
.cb-caret{display:inline-block;width:1.5px;height:15px;background:#999;margin-right:4px;animation:blink 1.2s ease-in-out infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0}}
.chatbox.expanded .cb-ph,.chatbox.expanded .cb-caret{display:none}
.chatbox.expanded .cb-bar{display:none}

/* Expanded Body */
.cb-body{display:flex;flex-direction:column;flex:1;overflow:hidden;min-height:0;position:relative}
.cb-header{display:flex;align-items:center;justify-content:space-between;padding:14px 18px 12px;border-bottom:1px solid rgba(255,255,255,0.08);flex-shrink:0}
.cb-header-left{display:flex;align-items:center;gap:8px}
.cb-header-center{display:flex;flex-direction:column;align-items:center;gap:4px;flex:1;max-width:200px;margin:0 auto}
.cb-progress-info{display:flex;align-items:center;gap:8px;font-size:10px}
.cb-turn-count{color:#999;font-weight:400}
.cb-stage-name{color:#333;font-weight:500;padding:2px 8px;background:rgba(0,0,0,0.04);border-radius:8px}
.cb-progress-bar{width:100%;height:3px;background:rgba(0,0,0,0.06);border-radius:2px;overflow:hidden}
.cb-progress-fill{height:100%;background:linear-gradient(90deg,rgba(0,0,0,0.4),rgba(0,0,0,0.7));border-radius:2px;transition:width 0.5s ease;width:0}
.cb-header-right{display:flex;align-items:center;gap:5px}
.cb-header-logo{width:22px;height:22px;border-radius:6px;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center}
.cb-header-logo svg{width:11px;height:11px;stroke:#fff;fill:none;stroke-width:1.5}
.cb-header-name{font-size:12px;font-weight:500;color:#444}
.cb-close{width:28px;height:28px;border-radius:7px;border:none;background:rgba(0,0,0,0.04);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:0.15s}
.cb-close:hover{background:rgba(0,0,0,0.08)}
.cb-close svg{width:12px;height:12px;stroke:#888;fill:none;stroke-width:2}

/* Messages */
.cb-msgs{flex:1;overflow-y:auto;padding:16px 18px;display:flex;flex-direction:column;gap:16px;scrollbar-width:none;-ms-overflow-style:none}
.cb-msgs::-webkit-scrollbar{display:none}
.cb-welcome{display:flex;flex-direction:column;align-items:center;text-align:center;padding:30px 10px;flex:1;justify-content:center}
.cb-welcome.hidden{display:none}
.cb-welcome-t{font-size:17px;font-weight:400;color:#222;margin-bottom:5px}
.cb-welcome-s{font-size:13px;color:#aaa;font-weight:400;line-height:1.5;max-width:260px}
.cb-chips{display:flex;flex-wrap:wrap;gap:6px;justify-content:center;margin-top:18px}
.cb-chip{padding:7px 14px;border-radius:16px;font-size:11px;color:#555;background:rgba(255,255,255,0.2);border:1px solid rgba(0,0,0,0.03);cursor:pointer;transition:0.25s;font-family:inherit;font-weight:400}
.cb-chip:hover{background:rgba(255,255,255,0.4);border-color:rgba(0,0,0,0.08);transform:translateY(-1px)}
.cb-chip:active{transform:translateY(0) scale(0.95);transition:0.06s}
.cb-input.locked{opacity:0.35;pointer-events:none;user-select:none}
.cb-input.locked .cb-ta{cursor:default}

/* Onboarding */
.ob-step{display:none;flex-direction:column;align-items:center;padding:30px 20px;width:100%;max-width:480px;margin:0 auto}
.ob-step.active{display:flex;animation:obFadeIn 0.6s ease}
@keyframes obFadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.ob-progress{display:flex;gap:6px;margin-bottom:24px}
.ob-dot{width:6px;height:6px;border-radius:50%;background:rgba(0,0,0,0.1);transition:0.3s}
.ob-dot.active{background:#000;width:20px;border-radius:3px}
.ob-dot.done{background:rgba(0,0,0,0.3)}
.ob-title{font-size:18px;font-weight:500;color:#000;margin-bottom:6px;text-align:center}
.ob-subtitle{font-size:12px;color:#999;margin-bottom:24px;text-align:center;font-weight:400}
.ob-options{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;width:100%}
.ob-option{display:flex;flex-direction:column;align-items:center;padding:20px 16px;border:1px solid rgba(0,0,0,0.06);border-radius:12px;background:rgba(255,255,255,0.3);backdrop-filter:blur(10px);cursor:pointer;transition:0.25s;font-family:inherit;text-align:center}
.ob-option:hover{background:rgba(255,255,255,0.5);border-color:rgba(0,0,0,0.12);transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.04)}
.ob-option:active{transform:translateY(0) scale(0.98);transition:0.08s}
.ob-option-icon{width:32px;height:32px;margin-bottom:10px;display:flex;align-items:center;justify-content:center;color:#333}
.ob-option-icon svg{width:24px;height:24px}
.ob-option-label{font-size:13px;font-weight:500;color:#111;margin-bottom:4px}
.ob-option-desc{font-size:10px;color:#888;font-weight:400;line-height:1.4}
.ob-option:nth-child(5){grid-column:1/-1;max-width:280px;margin:0 auto;width:100%}
.ob-input-group{width:100%;margin-bottom:20px}
.ob-input{width:100%;padding:12px 16px;border:1px solid rgba(0,0,0,0.08);border-radius:10px;background:rgba(255,255,255,0.4);font-size:13px;color:#111;font-family:inherit;transition:0.2s;outline:none}
.ob-input:focus{border-color:rgba(0,0,0,0.2);background:rgba(255,255,255,0.6)}
.ob-input::placeholder{color:#aaa}
.ob-quick-picks{display:flex;flex-wrap:wrap;gap:6px;margin-top:10px}
.ob-qp{padding:6px 12px;border-radius:12px;font-size:11px;color:#666;background:rgba(255,255,255,0.25);border:1px solid rgba(0,0,0,0.04);cursor:pointer;transition:0.2s;font-family:inherit}
.ob-qp:hover{background:rgba(255,255,255,0.5);border-color:rgba(0,0,0,0.1)}
.ob-qp:active{transform:scale(0.95);transition:0.06s}
.ob-nav{display:flex;gap:10px;width:100%;margin-top:10px}
.ob-btn{flex:1;padding:12px 20px;border-radius:20px;font-size:12px;font-weight:500;cursor:pointer;transition:0.25s;font-family:inherit;border:1px solid rgba(0,0,0,0.08)}
.ob-btn-back{background:rgba(255,255,255,0.3);color:#666}
.ob-btn-back:hover{background:rgba(255,255,255,0.5);border-color:rgba(0,0,0,0.15)}
.ob-btn-next,.ob-btn-start{background:rgba(0,0,0,0.85);color:#fff;border-color:rgba(0,0,0,0.9)}
.ob-btn-next:hover,.ob-btn-start:hover{background:#000;transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,0.15)}
.ob-btn:active{transform:translateY(0) scale(0.97);transition:0.08s}
.ob-summary{width:100%;background:rgba(255,255,255,0.35);border:1px solid rgba(0,0,0,0.06);border-radius:12px;padding:16px;margin-bottom:16px}
.ob-summary-item{font-size:12px;color:#444;margin-bottom:8px;line-height:1.6}
.ob-summary-item:last-child{margin-bottom:0}
.ob-summary-item strong{font-weight:600;color:#000;margin-right:6px}

/* Next Step Card */
.next-step-card{display:none;background:rgba(255,255,255,0.45);backdrop-filter:blur(20px);border:1px solid rgba(0,0,0,0.08);border-radius:16px;padding:20px;margin:20px 0;animation:fadeInUp 0.6s ease}
.next-step-card.show{display:block}
@keyframes fadeInUp{from{opacity:0;transform:translateY(15px)}to{opacity:1;transform:translateY(0)}}
.nsc-title{font-size:15px;font-weight:600;color:#000;margin-bottom:6px;text-align:center}
.nsc-subtitle{font-size:11px;color:#888;margin-bottom:18px;text-align:center;line-height:1.5}
.nsc-options{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.nsc-option{display:flex;flex-direction:column;align-items:center;padding:16px 12px;border:1px solid rgba(0,0,0,0.08);border-radius:12px;background:rgba(255,255,255,0.35);cursor:pointer;transition:0.25s;text-align:center}
.nsc-option:hover{background:rgba(255,255,255,0.6);border-color:rgba(0,0,0,0.15);transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.06)}
.nsc-option:active{transform:translateY(0) scale(0.98);transition:0.08s}
.nsc-option-icon{margin-bottom:8px;width:28px;height:28px;display:flex;align-items:center;justify-content:center}.nsc-option-icon svg{width:100%;height:100%;stroke-width:1.5}
.nsc-option-label{font-size:12px;font-weight:500;color:#111;margin-bottom:4px}
.nsc-option-desc{font-size:9px;color:#888;line-height:1.3}
.nsc-option.premium{position:relative;border-color:rgba(0,0,0,0.12)}
.nsc-option.premium::after{content:'PRO';position:absolute;top:6px;right:6px;font-size:8px;font-weight:700;color:#fff;background:linear-gradient(135deg,#000,#333);padding:2px 6px;border-radius:4px;letter-spacing:0.05em}

/* Msg — Claude-style clean */
.msg{display:flex;gap:12px;animation:msgIn 0.4s ease;position:relative;padding:4px 0}
.msg.msg-right{flex-direction:row-reverse}
.msg.msg-right .msg-body{display:flex;flex-direction:column;align-items:flex-end}
.msg.msg-right .msg-text{background:rgba(0,0,0,0.04);display:inline-block;padding:10px 16px;border-radius:18px;text-align:left;width:fit-content;max-width:80%;color:#1a1a1a;font-size:14px}
.msg-text .quote{background:rgba(0,0,0,0.04);padding:2px 6px;border-radius:4px;font-style:italic;color:#555;border-left:2px solid rgba(0,0,0,0.15);margin:0 2px;display:inline}
.msg:not(.msg-right) .msg-body{display:flex;flex-direction:column;align-items:flex-start}
.msg:not(.msg-right) .msg-text{background:transparent;padding:2px 0;border:none;width:100%;max-width:100%}
@keyframes msgIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.msg-ava{width:26px;height:26px;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;margin-top:2px}
.msg-ava.ai{background:#1a1a1a}.msg-ava.ai svg{width:12px;height:12px;stroke:#fff;fill:none;stroke-width:1.5}
.msg-ava.user{display:none}
.msg-body{flex:1;min-width:0}
.msg-role{font-size:10px;font-weight:500;color:#999;margin-bottom:6px;letter-spacing:0.03em}
.msg-text{font-size:14.5px;line-height:1.8;color:#1a1a1a;font-weight:350;word-break:keep-all;letter-spacing:-0.01em}
/* Markdown in AI messages */
.msg-text strong,.msg-text b{font-weight:600;color:#111}
.msg-text em,.msg-text i{font-style:italic;color:#333}
.msg-text code{background:rgba(0,0,0,0.05);padding:1px 5px;border-radius:4px;font-family:'Courier New',monospace;font-size:13px}
.msg-text pre{background:rgba(0,0,0,0.04);padding:12px 16px;border-radius:8px;overflow-x:auto;margin:8px 0;font-family:'Courier New',monospace;font-size:13px;line-height:1.6}
.msg-text ul,.msg-text ol{margin:6px 0;padding-left:20px}
.msg-text li{margin:3px 0;line-height:1.7}
.msg-text h3{font-size:15px;font-weight:600;margin:12px 0 6px;color:#111}
.msg-text h4{font-size:14px;font-weight:600;margin:10px 0 4px;color:#222}
.msg-text blockquote{border-left:3px solid rgba(0,0,0,0.12);padding-left:14px;margin:8px 0;color:#555;font-style:italic}
.msg-text hr{border:none;border-top:1px solid rgba(0,0,0,0.08);margin:12px 0}
.msg-text p{margin:6px 0}
.msg-text p:first-child{margin-top:0}
.msg-text p:last-child{margin-bottom:0}

/* Msg actions (bookmark, image) */
.msg-actions{display:flex;gap:4px;margin-top:4px;opacity:0;transition:opacity 0.2s}
.msg:hover .msg-actions{opacity:1}
.msg-action-btn{width:22px;height:22px;border:none;background:rgba(0,0,0,0.04);border-radius:5px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:0.15s}
.msg-action-btn:hover{background:rgba(0,0,0,0.08)}
.msg-action-btn svg{width:11px;height:11px;stroke:#999;fill:none;stroke-width:1.5}
.msg-action-btn.bookmarked{background:rgba(0,0,0,0.08)}
.msg-action-btn.bookmarked svg{stroke:#000;fill:#000}

/* Msg image */
.msg-img{max-width:200px;border-radius:10px;margin-top:6px;cursor:pointer;transition:0.2s}
.msg-img:hover{transform:scale(1.02)}

.typing span{display:inline-block;width:5px;height:5px;border-radius:50%;background:#ccc;margin-right:4px;animation:tDot 1.4s ease infinite}
.typing span:nth-child(2){animation-delay:0.15s}.typing span:nth-child(3){animation-delay:0.3s}
@keyframes tDot{0%,80%,100%{opacity:0.3;transform:scale(0.8)}40%{opacity:1;transform:scale(1.2)}}

/* Input */
.cb-input{padding:10px 16px 12px;border-top:1px solid rgba(255,255,255,0.06);flex-shrink:0}
.cb-model-row{display:flex;align-items:center;padding:0 4px 10px}
.cb-input-row{display:flex;align-items:flex-end;gap:8px;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.1);border-radius:14px;padding:8px 10px;transition:0.25s}
.cb-input-row:focus-within{border-color:rgba(255,255,255,0.2);box-shadow:0 4px 20px rgba(0,0,0,0.02);background:rgba(255,255,255,0.15)}
/* Attach btn */
.cb-attach{width:28px;height:28px;border:none;background:rgba(0,0,0,0.04);border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:0.15s;flex-shrink:0}
.cb-attach:hover{background:rgba(0,0,0,0.08)}
.cb-attach:active{transform:scale(0.88);transition:0.06s}
.cb-attach svg{width:13px;height:13px;stroke:#888;fill:none;stroke-width:1.5}

/* Header icon buttons */
.cb-icon-btn{width:28px;height:28px;border-radius:7px;border:none;background:rgba(0,0,0,0.04);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:0.15s}
.cb-icon-btn:hover{background:rgba(0,0,0,0.08)}
.cb-icon-btn:active{transform:scale(0.88);transition:0.06s}
.cb-icon-btn svg{width:13px;height:13px;stroke:#888;fill:none;stroke-width:1.5}
.cb-icon-btn.active{background:#000}
.cb-icon-btn.active svg{stroke:#fff}
.cb-icon-btn.pulse{animation:btnPulse 0.6s ease}
@keyframes btnPulse{0%{transform:scale(1)}50%{transform:scale(1.2);background:rgba(0,0,0,0.15)}100%{transform:scale(1)}}
/* Unmask button enhancements */
#cbProfileBtn{position:relative}
.unmask-badge{position:absolute;top:-4px;right:-4px;min-width:16px;height:16px;border-radius:8px;background:#000;color:#fff;font-size:9px;font-weight:600;display:flex;align-items:center;justify-content:center;padding:0 4px;opacity:0;transform:scale(0);transition:all 0.4s cubic-bezier(0.34,1.56,0.64,1);pointer-events:none}
.unmask-badge.show{opacity:1;transform:scale(1)}
body.dark-mode .unmask-badge{background:#fff;color:#000}
.cb-icon-btn.unmask-glow{animation:unmaskGlow 1.5s ease}
@keyframes unmaskGlow{0%{transform:scale(1);box-shadow:none}15%{transform:scale(1.3);box-shadow:0 0 20px rgba(0,0,0,0.2)}30%{transform:scale(1.15)}50%{transform:scale(1.25);box-shadow:0 0 12px rgba(0,0,0,0.1)}100%{transform:scale(1);box-shadow:none}}
body.dark-mode .cb-icon-btn.unmask-glow{animation:unmaskGlowDk 1.5s ease}
@keyframes unmaskGlowDk{0%{transform:scale(1);box-shadow:none}15%{transform:scale(1.3);box-shadow:0 0 20px rgba(255,255,255,0.25)}30%{transform:scale(1.15)}50%{transform:scale(1.25);box-shadow:0 0 12px rgba(255,255,255,0.15)}100%{transform:scale(1);box-shadow:none}}
.cb-icon-btn.unmask-shake{animation:unmaskShake 0.5s ease}
@keyframes unmaskShake{0%,100%{transform:translateX(0)}15%{transform:translateX(-3px)}30%{transform:translateX(3px)}45%{transform:translateX(-2px)}60%{transform:translateX(2px)}75%{transform:translateX(-1px)}}

/* Overlay panels (history / profile) */
.cb-overlay-panel{display:none;position:absolute;top:54px;left:0;right:0;bottom:0;background:rgba(255,255,255,0.92);backdrop-filter:blur(60px);-webkit-backdrop-filter:blur(60px);z-index:10;overflow-y:auto;padding:20px;animation:panelIn 0.8s ease;scrollbar-width:none;-ms-overflow-style:none}
.cb-overlay-panel::-webkit-scrollbar{display:none}
.cb-overlay-panel.show{display:block}
@keyframes panelIn{from{opacity:0;filter:blur(6px);transform:translateY(6px)}to{opacity:1;filter:blur(0);transform:translateY(0)}}
.cbp-title{font-size:14px;font-weight:500;color:#333;letter-spacing:-0.01em;margin-bottom:16px}
.cbp-profile-sub{font-size:12px;color:#aaa;font-weight:400;margin-bottom:16px;line-height:1.5}

/* History items */
.cbh-item{padding:12px 14px;border-radius:10px;cursor:pointer;transition:background 0.15s;margin-bottom:4px;background:rgba(255,255,255,0.5)}
.cbh-item:hover{background:rgba(255,255,255,0.75)}
.cbh-item-date{font-size:10px;color:#bbb;margin-bottom:4px;letter-spacing:0.02em}
.cbh-item-preview{font-size:13px;color:#333;font-weight:400;line-height:1.4;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.cbh-empty{text-align:center;padding:40px 10px;font-size:13px;color:#999;font-weight:400;line-height:1.6}

/* Profile tags */
.cbp-tags{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:20px}

/* Gallery grid */
.cbp-gallery{display:grid;grid-template-columns:repeat(3,1fr);gap:6px}
.cbp-gallery-item{aspect-ratio:1;border-radius:8px;overflow:hidden;cursor:pointer;position:relative}
.cbp-gallery-item img{width:100%;height:100%;object-fit:cover;transition:transform 0.3s}
.cbp-gallery-item:hover img{transform:scale(1.05)}
.cbp-gallery-empty{grid-column:1/-1;text-align:center;padding:40px 10px;font-size:13px;color:#999;font-weight:400;line-height:1.6}

/* File attachment preview */
.cb-file-preview{display:flex;align-items:center;gap:8px;padding:8px 12px;margin:0 16px 6px;background:rgba(0,0,0,0.03);border-radius:10px;font-size:12px;color:#555}
.cb-file-preview-icon{width:28px;height:28px;border-radius:6px;background:rgba(0,0,0,0.06);display:flex;align-items:center;justify-content:center;flex-shrink:0}
.cb-file-preview-icon svg{width:13px;height:13px;stroke:#666;fill:none;stroke-width:1.5}
.cb-file-preview-name{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.cb-file-preview-remove{width:20px;height:20px;border:none;background:none;cursor:pointer;display:flex;align-items:center;justify-content:center;opacity:0.5}
.cb-file-preview-remove:hover{opacity:1}
.cb-file-preview-remove svg{width:10px;height:10px;stroke:#999;fill:none;stroke-width:2}
.cbp-tag{padding:5px 12px;border-radius:20px;font-size:11px;font-weight:500;background:rgba(0,0,0,0.04);color:#555;animation:tagIn 0.4s ease;border:1px solid rgba(0,0,0,0.06)}
.cbp-tag.new{background:rgba(0,0,0,0.08);color:#000;border-color:rgba(0,0,0,0.12)}
@keyframes tagIn{from{opacity:0;transform:scale(0.8)}to{opacity:1;transform:scale(1)}}
.cbp-section{margin-bottom:16px;padding:14px;background:rgba(255,255,255,0.5);border-radius:10px;border:1px solid rgba(0,0,0,0.04)}
.cbp-section.locked{opacity:0.3;pointer-events:none}
.cbp-section.unlocked{animation:sectionUnlock 0.8s ease}
@keyframes sectionUnlock{0%{opacity:0.3;transform:translateY(4px)}100%{opacity:1;transform:translateY(0)}}
.cbp-section-title{font-size:11px;font-weight:500;color:#999;letter-spacing:0;margin-bottom:8px}
.cbp-section-value{font-size:13px;color:#333;font-weight:400;line-height:1.6;word-break:keep-all}
/* Unmask depth & status */
.um-depth-wrap{margin-bottom:18px}
.um-depth-label{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.um-depth-title{font-size:10px;letter-spacing:0.08em;text-transform:uppercase;color:#aaa;font-weight:500}
.um-depth-count{font-size:10px;color:#bbb}
.um-depth-bar{height:3px;border-radius:2px;background:rgba(0,0,0,0.05);overflow:hidden}
.um-depth-fill{height:100%;border-radius:2px;background:#000;opacity:0.2;width:0;transition:width 1.5s cubic-bezier(0.4,0,0.2,1)}
.um-status{font-size:10px;color:#bbb;display:flex;align-items:center;gap:5px;margin-bottom:16px}
.um-status-dot{width:5px;height:5px;border-radius:50%;background:#ccc;transition:background 0.5s}
.um-status-dot.active{background:#4ade80;animation:umPulse 2s ease infinite}
@keyframes umPulse{0%,100%{opacity:1;box-shadow:0 0 0 0 rgba(74,222,128,0.4)}50%{opacity:0.6;box-shadow:0 0 6px 2px rgba(74,222,128,0.15)}}
body.dark-mode .um-depth-bar{background:rgba(255,255,255,0.05)}
body.dark-mode .um-depth-fill{background:#fff;opacity:0.25}
.cbp-prompt-wrap{margin-top:20px;padding:14px;background:rgba(0,0,0,0.02);border-radius:10px;border:1px solid rgba(0,0,0,0.04)}
.cbp-prompt{font-size:12px;color:#888;line-height:1.7;white-space:pre-wrap;word-break:break-all;max-height:120px;overflow-y:auto;scrollbar-width:none}
.cbp-prompt::-webkit-scrollbar{display:none}
.cb-ta{flex:1;border:none;outline:none;background:transparent;font-size:14px;font-family:inherit;color:#111;resize:none;line-height:1.5;max-height:100px;min-height:30px;font-weight:400;padding:4px 0}
.cb-ta::placeholder{color:#bbb}
.cb-send{width:30px;height:30px;border-radius:10px;background:#000;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;opacity:0.12;transition:0.2s}
.cb-send.ready{opacity:1}
.cb-send:active{transform:scale(0.88);transition:0.06s}
.cb-send svg{width:14px;height:14px;stroke:#fff;fill:none;stroke-width:2}

/* UNMASK */
.btn-unmask-start{margin-top:28px;padding:12px 28px;border:1px solid #000;border-radius:8px;background:#000;color:#fff;font-size:13px;font-weight:500;cursor:pointer;transition:0.2s;font-family:inherit}
.btn-unmask-start:hover{background:#222}

/* INTERPRET */
.interpret-input-wrap{display:flex;gap:10px;max-width:420px;margin:28px auto 0}
.interpret-input{flex:1;padding:13px 18px;border:1px solid rgba(0,0,0,0.08);border-radius:10px;font-size:14px;font-family:inherit;outline:none;transition:0.2s;background:rgba(255,255,255,0.7);backdrop-filter:blur(10px)}
.interpret-input:focus{border-color:rgba(0,0,0,0.2);background:rgba(255,255,255,0.9)}
.interpret-go{padding:13px 24px;background:#000;color:#fff;border:none;border-radius:10px;font-size:13px;font-weight:500;cursor:pointer;transition:0.2s;font-family:inherit}
.interpret-go:hover{background:#222}
.interpret-result{width:100%;max-width:600px;margin:40px auto 0;padding:0 20px;animation:msgIn 0.6s ease}
.ir-header{display:flex;align-items:center;gap:10px;margin-bottom:24px}
.ir-field{font-size:20px;font-weight:500;color:#111}
.ir-badge{font-size:10px;font-weight:600;color:#999;letter-spacing:0.08em;padding:4px 10px;border:1px solid rgba(0,0,0,0.08);border-radius:20px}
.ir-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px}
.ir-card{padding:18px;background:rgba(255,255,255,0.5);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border:1px solid rgba(0,0,0,0.04);border-radius:12px}
.ir-card-title{font-size:11px;font-weight:600;color:#999;margin-bottom:10px;letter-spacing:0.02em}
.ir-card-body{font-size:14px;color:#222;font-weight:400;line-height:1.6}
.ir-insight{padding:20px;background:rgba(0,0,0,0.03);border-radius:12px;border:1px solid rgba(0,0,0,0.04)}
#page-interpret .svc-page{overflow-y:auto;padding-bottom:80px}

/* ARCHIVE */
#page-archive{padding-top:0;overflow-y:auto;overflow-x:hidden}
.archive-map{position:relative;width:100%;min-height:100vh;display:flex;align-items:center;justify-content:center}
.archive-map-header{position:absolute;top:100px;left:50%;transform:translateX(-50%);text-align:center;z-index:5;pointer-events:none}
.archive-map-title{font-size:clamp(28px,3vw,44px);font-weight:300;letter-spacing:-0.02em;margin-bottom:8px;color:var(--text)}
.archive-map-sub{font-size:13px;color:#999;font-weight:300}
.archive-map-canvas{position:relative;width:100%;max-width:1100px;height:75vh;margin:0 auto}
.map-lines{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1}
.map-lines line{stroke:rgba(0,0,0,0.06);stroke-width:0.5;transition:stroke 0.4s}
body.dark-mode .map-lines line{stroke:rgba(255,255,255,0.06)}
.map-node{position:absolute;z-index:3;cursor:pointer;transform:translate(-50%,-50%)}
.map-dot{width:8px;height:8px;border-radius:50%;background:#000;transition:transform 0.3s,box-shadow 0.3s;position:relative}
.map-dot::after{content:'';position:absolute;top:-6px;left:-6px;width:20px;height:20px;border-radius:50%;border:1px solid rgba(0,0,0,0.08);transition:0.3s}
body.dark-mode .map-dot{background:#fff}
body.dark-mode .map-dot::after{border-color:rgba(255,255,255,0.1)}
.map-node:hover .map-dot{transform:scale(1.8);box-shadow:0 0 24px rgba(0,0,0,0.2)}
body.dark-mode .map-node:hover .map-dot{box-shadow:0 0 24px rgba(255,255,255,0.3)}
.map-node:active .map-dot{transform:scale(0.6)!important;transition:transform 0.08s}
.map-node:hover .map-dot::after{transform:scale(1.6);border-color:rgba(0,0,0,0.15)}
body.dark-mode .map-node:hover .map-dot::after{border-color:rgba(255,255,255,0.2)}
.map-label{position:absolute;top:20px;left:50%;transform:translateX(-50%);white-space:nowrap;text-align:center;pointer-events:none}
.map-label-cat{font-size:9px;letter-spacing:0.12em;text-transform:uppercase;color:#999;margin-bottom:2px;font-weight:500}
.map-label-name{font-size:13px;font-weight:500;letter-spacing:0.02em;color:var(--text)}
/* Breathing glow */
.map-dot-glow{position:absolute;top:50%;left:50%;width:30px;height:30px;border-radius:50%;transform:translate(-50%,-50%);background:radial-gradient(circle,rgba(0,0,0,0.06) 0%,transparent 70%);animation:dotBreathe 4s ease-in-out infinite;pointer-events:none}
body.dark-mode .map-dot-glow{background:radial-gradient(circle,rgba(255,255,255,0.08) 0%,transparent 70%)}
@keyframes dotBreathe{0%,100%{transform:translate(-50%,-50%) scale(1);opacity:0.6}50%{transform:translate(-50%,-50%) scale(2.2);opacity:0.15}}
.map-node[data-node="0"] .map-dot-glow{animation-delay:0s}
.map-node[data-node="1"] .map-dot-glow{animation-delay:-0.7s}
.map-node[data-node="2"] .map-dot-glow{animation-delay:-1.4s}
.map-node[data-node="3"] .map-dot-glow{animation-delay:-2.1s}
.map-node[data-node="4"] .map-dot-glow{animation-delay:-2.8s}
.map-node[data-node="5"] .map-dot-glow{animation-delay:-3.5s}
/* Twinkle sparks */
.map-spark{position:absolute;width:2px;height:2px;border-radius:50%;background:#000;opacity:0;pointer-events:none}
body.dark-mode .map-spark{background:#fff}
.map-spark.s1{top:-12px;left:4px;animation:sparkle 5s ease-in-out infinite 0s}
.map-spark.s2{top:6px;left:-10px;animation:sparkle 5s ease-in-out infinite 1.7s}
.map-spark.s3{top:10px;left:14px;animation:sparkle 5s ease-in-out infinite 3.3s}
@keyframes sparkle{0%,85%,100%{opacity:0;transform:scale(0)}90%{opacity:0.8;transform:scale(1.2)}95%{opacity:0;transform:scale(0)}}
/* Pulse animation on dots */
.map-dot::before{content:'';position:absolute;top:50%;left:50%;width:8px;height:8px;border-radius:50%;background:rgba(0,0,0,0.08);transform:translate(-50%,-50%);animation:mapPulse 3s ease-in-out infinite}
body.dark-mode .map-dot::before{background:rgba(255,255,255,0.08)}
@keyframes mapPulse{0%,100%{transform:translate(-50%,-50%) scale(1);opacity:0.6}50%{transform:translate(-50%,-50%) scale(3);opacity:0}}
.map-node[data-node="0"] .map-dot::before{animation-delay:0s}
.map-node[data-node="1"] .map-dot::before{animation-delay:0.5s}
.map-node[data-node="2"] .map-dot::before{animation-delay:1s}
.map-node[data-node="3"] .map-dot::before{animation-delay:1.5s}
.map-node[data-node="4"] .map-dot::before{animation-delay:2s}
.map-node[data-node="5"] .map-dot::before{animation-delay:2.5s}
/* Node floating */
.map-node{animation:nodeFloat 6s ease-in-out infinite}
.map-node[data-node="1"]{animation-delay:-1s}
.map-node[data-node="2"]{animation-delay:-2s}
.map-node[data-node="3"]{animation-delay:-3.5s}
.map-node[data-node="4"]{animation-delay:-4.2s}
.map-node[data-node="5"]{animation-delay:-5s}
@keyframes nodeFloat{0%,100%{margin-top:0}50%{margin-top:-6px}}
/* Orbital micro-particles around each node */
.map-orbit{position:absolute;top:50%;left:50%;width:40px;height:40px;transform:translate(-50%,-50%);pointer-events:none}
.map-orbit-dot{position:absolute;width:2px;height:2px;border-radius:50%;background:rgba(0,0,0,0.2);animation:orbitSpin 8s linear infinite}
body.dark-mode .map-orbit-dot{background:rgba(255,255,255,0.25)}
.map-orbit-dot:nth-child(1){animation-duration:6s;top:0;left:50%}
.map-orbit-dot:nth-child(2){animation-duration:8s;animation-delay:-2s;top:50%;left:100%}
.map-orbit-dot:nth-child(3){animation-duration:10s;animation-delay:-4s;top:100%;left:50%}
@keyframes orbitSpin{from{transform:rotate(0deg) translateX(18px) rotate(0deg)}to{transform:rotate(360deg) translateX(18px) rotate(-360deg)}}
/* Line dash animation */
.map-lines line{stroke-dasharray:4 8;animation:lineDash 20s linear infinite}
@keyframes lineDash{from{stroke-dashoffset:0}to{stroke-dashoffset:-120}}

body.pd-open .map-node,body.pd-open .map-orbit-dot,body.pd-open .map-dot::before,body.pd-open .map-dot-glow,body.pd-open .map-spark{animation-play-state:paused!important}
.project-detail{position:fixed;top:0;left:0;width:100%;height:100%;z-index:10000;opacity:0;visibility:hidden;transition:opacity 0.6s cubic-bezier(0.4,0,0.2,1),visibility 0s 0.6s;will-change:opacity}
.project-detail.show{opacity:1;visibility:visible;transition:opacity 0.6s cubic-bezier(0.4,0,0.2,1),visibility 0s 0s}
.project-detail-bg{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(255,255,255,0.75);backdrop-filter:blur(50px);-webkit-backdrop-filter:blur(50px)}
body.dark-mode .project-detail-bg{background:rgba(10,10,10,0.75)}
.project-detail-inner{position:relative;z-index:2;max-width:900px;margin:0 auto;height:100%;overflow-y:auto;padding:80px 60px;scrollbar-width:none;-ms-overflow-style:none}
.project-detail-inner::-webkit-scrollbar{display:none}
.project-detail-close{position:fixed;top:30px;right:40px;width:40px;height:40px;border:1px solid rgba(0,0,0,0.1);border-radius:50%;background:rgba(255,255,255,0.6);backdrop-filter:blur(20px);display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:3;transition:0.3s}
.project-detail-close:hover{background:rgba(0,0,0,0.05);border-color:rgba(0,0,0,0.2)}
.project-detail-close svg{width:16px;height:16px;stroke:#333;fill:none;stroke-width:1.5}
body.dark-mode .project-detail-close{border-color:rgba(255,255,255,0.1);background:rgba(30,30,30,0.6)}
body.dark-mode .project-detail-close:hover{background:rgba(255,255,255,0.08);border-color:rgba(255,255,255,0.2)}
body.dark-mode .project-detail-close svg{stroke:#ccc}
.pd-cat{font-size:10px;letter-spacing:0.14em;text-transform:uppercase;color:#999;margin-bottom:12px;font-weight:500}
.pd-name{font-size:clamp(36px,5vw,56px);font-weight:300;letter-spacing:-0.03em;margin-bottom:8px;color:var(--text);line-height:1.1}
.pd-sub{font-size:16px;color:#888;font-style:italic;margin-bottom:40px;font-weight:300}
.pd-gallery{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:40px}
.pd-gallery-item{aspect-ratio:4/3;border-radius:10px;overflow:hidden;position:relative}
.pd-gallery-item.wide{grid-column:span 2;aspect-ratio:21/9}
.pd-gallery-placeholder{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:11px;color:#aaa;letter-spacing:0.06em;text-transform:uppercase;border:1px solid rgba(0,0,0,0.04)}
body.dark-mode .pd-gallery-placeholder{border-color:rgba(255,255,255,0.06);color:#555}
/* Generative patterns for placeholders */
.pd-gallery-placeholder{background-size:10px 10px}
.pd-gallery-item img{width:100%;height:100%;object-fit:cover;display:block;border-radius:10px}
.pd-pat-dots{background-image:radial-gradient(rgba(0,0,0,0.06) 1px,transparent 1px);background-size:8px 8px}
.pd-pat-lines{background-image:repeating-linear-gradient(45deg,transparent,transparent 4px,rgba(0,0,0,0.03) 4px,rgba(0,0,0,0.03) 5px)}
.pd-pat-grid{background-image:linear-gradient(rgba(0,0,0,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(0,0,0,0.03) 1px,transparent 1px);background-size:16px 16px}
.pd-pat-cross{background-image:radial-gradient(rgba(0,0,0,0.04) 1.5px,transparent 1.5px),radial-gradient(rgba(0,0,0,0.04) 1.5px,transparent 1.5px);background-size:12px 12px;background-position:0 0,6px 6px}
body.dark-mode .pd-pat-dots{background-image:radial-gradient(rgba(255,255,255,0.06) 1px,transparent 1px)}
body.dark-mode .pd-pat-lines{background-image:repeating-linear-gradient(45deg,transparent,transparent 4px,rgba(255,255,255,0.04) 4px,rgba(255,255,255,0.04) 5px)}
body.dark-mode .pd-pat-grid{background-image:linear-gradient(rgba(255,255,255,0.04) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,0.04) 1px,transparent 1px)}
body.dark-mode .pd-pat-cross{background-image:radial-gradient(rgba(255,255,255,0.05) 1.5px,transparent 1.5px),radial-gradient(rgba(255,255,255,0.05) 1.5px,transparent 1.5px)}
.pd-section{margin-bottom:32px}
.pd-section-title{font-size:10px;letter-spacing:0.1em;text-transform:uppercase;color:#999;margin-bottom:10px;font-weight:500}
.pd-section-body{font-size:14px;line-height:1.8;color:#555;word-break:keep-all}
body.dark-mode .pd-section-body{color:#999}
.pd-tags{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:32px}
.pd-tag{padding:5px 12px;border:1px solid rgba(0,0,0,0.08);border-radius:20px;font-size:11px;color:#666;letter-spacing:0.02em}
body.dark-mode .pd-tag{border-color:rgba(255,255,255,0.08);color:#888}
.pd-meta{display:flex;gap:40px;padding-top:24px;border-top:1px solid rgba(0,0,0,0.04);margin-top:40px}
body.dark-mode .pd-meta{border-top-color:rgba(255,255,255,0.04)}
.pd-meta-item{display:flex;flex-direction:column;gap:4px}
.pd-meta-label{font-size:10px;letter-spacing:0.08em;text-transform:uppercase;color:#aaa;font-weight:500}
.pd-meta-value{font-size:13px;color:var(--text);font-weight:400}
/* archive detail styles moved to map-card */

/* MY PAGE */
#page-mypage{padding-top:115px;overflow-y:auto}
.mypage-inner{max-width:800px;margin:0 auto;padding:0 40px 80px}
.mypage-title{font-size:28px;font-weight:300;margin-bottom:40px}
.mypage-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.mypage-card{padding:28px 24px;border:1px solid rgba(0,0,0,0.05);border-radius:12px;background:rgba(255,255,255,0.6);backdrop-filter:blur(16px)}
.mc-label{font-size:10px;font-weight:600;color:#aaa;letter-spacing:0.08em;margin-bottom:14px}
.mc-value{font-size:22px;font-weight:300;margin-bottom:4px}
.mc-sub{font-size:12px;color:#999}
.sub-badge{display:inline-block;padding:3px 10px;border-radius:4px;font-size:10px;font-weight:700;letter-spacing:0.05em;background:rgba(0,0,0,0.05);color:#999}
.sub-badge.pro{background:#000;color:#fff}
.btn-upgrade{margin-top:16px;padding:10px 22px;font-size:12px;font-weight:500;border:1px solid #000;border-radius:8px;background:#000;color:#fff;cursor:pointer;transition:0.2s;font-family:inherit;display:block}
.btn-upgrade:hover{background:#222}

/* MODALS */
.modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0);backdrop-filter:blur(0px);-webkit-backdrop-filter:blur(0px);z-index:9000;display:none;align-items:center;justify-content:center;transition:background 0.4s,backdrop-filter 0.4s,-webkit-backdrop-filter 0.4s}
.modal-overlay.show{display:flex;animation:modalBgIn 1s ease forwards}
@keyframes modalBgIn{from{background:rgba(0,0,0,0);backdrop-filter:blur(0px);-webkit-backdrop-filter:blur(0px)}to{background:rgba(0,0,0,0.2);backdrop-filter:blur(14px);-webkit-backdrop-filter:blur(14px)}}
.login-modal,.pricing-modal{opacity:0;transform:translateY(16px) scale(0.98);filter:blur(8px);animation:modalContentIn 1.4s cubic-bezier(0.19,1,0.22,1) 0.2s forwards}
@keyframes modalContentIn{to{opacity:1;transform:translateY(0) scale(1);filter:blur(0)}}
.login-modal{background:rgba(255,255,255,0.92);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-radius:16px;padding:48px 40px 40px;max-width:400px;width:90%;text-align:center;box-shadow:0 30px 80px rgba(0,0,0,0.15)}
.login-logo svg{width:36px;height:36px;fill:none;stroke:#000;stroke-width:1.5;margin-bottom:24px}
.login-title{font-size:20px;font-weight:400;margin-bottom:8px}
.login-sub{font-size:13px;color:#999;margin-bottom:32px;font-weight:300}
.btn-google{width:100%;padding:14px;border:1px solid #ddd;border-radius:10px;background:#fff;font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;transition:0.2s;font-family:inherit}
.btn-google:hover{background:#f8f8f8;border-color:#bbb}
.btn-google:active{transform:scale(0.97);transition:0.06s}
.btn-google svg{width:18px;height:18px}
.login-terms{font-size:11px;color:#bbb;margin-top:20px}.login-terms a{color:#888}
.pricing-modal{background:rgba(255,255,255,0.92);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-radius:16px;padding:48px 40px 40px;max-width:700px;width:90%;text-align:center;position:relative;box-shadow:0 30px 80px rgba(0,0,0,0.15);max-height:90vh;overflow-y:auto}
.pricing-title{font-size:24px;font-weight:400;margin-bottom:8px}
.pricing-sub{font-size:13px;color:#999;margin-bottom:32px;font-weight:300}
.pricing-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;text-align:left}
.price-card{padding:28px 24px;border:1px solid rgba(0,0,0,0.06);border-radius:12px;display:flex;flex-direction:column}
.price-card.featured{border-color:#000}
.pc-name{font-size:16px;font-weight:500;margin-bottom:8px}
.pc-price{font-size:28px;font-weight:300;margin-bottom:8px}.pc-price span{font-size:13px;color:#999}
.pc-desc{font-size:12px;color:#999;margin-bottom:20px}
.pc-features{list-style:none;margin-bottom:24px}
.pc-features li{font-size:13px;color:#444;padding:4px 0;font-weight:300}.pc-features li::before{content:"✓ ";color:#000;font-weight:600}
.btn-price{padding:12px;border-radius:8px;font-size:13px;font-weight:500;cursor:pointer;transition:0.2s;text-align:center;border:1px solid #000;font-family:inherit;margin-top:auto}
.btn-price.primary{background:#000;color:#fff}.btn-price.primary:hover{background:#222}.btn-price.primary:active{transform:scale(0.96);transition:0.06s}
.btn-price.secondary{background:transparent;color:#999;border-color:#ddd;cursor:default}
.modal-close{position:absolute;top:16px;right:16px;width:32px;height:32px;border:none;background:none;cursor:pointer;display:flex;align-items:center;justify-content:center}
.modal-close svg{width:16px;height:16px;stroke:#999;fill:none;stroke-width:2}

#modelMenu{position:fixed;z-index:99999;background:#fff;border:1px solid rgba(0,0,0,0.08);border-radius:10px;padding:4px;min-width:170px;box-shadow:0 8px 30px rgba(0,0,0,0.12);display:none;pointer-events:auto}
#modelMenu.show{display:block}
.mm-opt{display:flex;align-items:center;gap:8px;padding:9px 12px;border-radius:7px;font-size:12px;color:#333;cursor:pointer;transition:0.15s}
.mm-opt:hover{background:rgba(0,0,0,0.04)}
.mm-opt.active{font-weight:600;background:rgba(0,0,0,0.04)}
.mm-opt .md{width:6px;height:6px;border-radius:50%;flex-shrink:0}
.mm-opt.locked{opacity:0.45;cursor:default}.mm-opt.locked:hover{background:transparent}
.mm-lock{margin-left:auto;font-size:9px;font-weight:600;padding:2px 7px;border-radius:4px;background:rgba(0,0,0,0.06);color:#999}

/* ============ DARK MODE OVERRIDES ============ */
body.dark-mode nav{background:rgba(255,255,255,0.06);border-color:rgba(255,255,255,0.08);backdrop-filter:blur(30px);-webkit-backdrop-filter:blur(30px)}
body.dark-mode .logo{color:#fff}
body.dark-mode .logo svg{stroke:#fff}
body.dark-mode .nav-center li{color:#666}
body.dark-mode .nav-center li:hover{color:#eee}
body.dark-mode .nav-center li.active{color:#fff}
body.dark-mode .nav-center li.active::after{background:#fff}
body.dark-mode .btn-signin{color:#ccc;border-color:rgba(255,255,255,0.12)}
body.dark-mode .btn-signin:hover{border-color:rgba(255,255,255,0.25);background:rgba(255,255,255,0.04)}
body.dark-mode .nav-name{color:#ccc}
body.dark-mode .nav-profile-btn{color:#ccc;border-color:rgba(255,255,255,0.12)}
body.dark-mode .nav-profile-btn:hover{border-color:rgba(255,255,255,0.25);background:rgba(255,255,255,0.04)}
body.dark-mode .profile-dropdown{background:#1a1a1a;border-color:rgba(255,255,255,0.08);box-shadow:0 8px 30px rgba(0,0,0,0.4)}
body.dark-mode .pd-item{color:#ccc}
body.dark-mode .pd-item:hover{background:rgba(255,255,255,0.06)}
body.dark-mode .hl-logo{color:#fff}
body.dark-mode .hl-typing{color:#ddd;text-shadow:0 0 40px rgba(0,0,0,0.5)}
body.dark-mode .hl-typing .cursor{background:#fff}
body.dark-mode .hl-sub-line1{color:#aaa}
body.dark-mode .hl-sub-line2{color:#888}
body.dark-mode .hl-btn{color:#ddd;border-color:rgba(255,255,255,0.15);background:rgba(255,255,255,0.04)}
body.dark-mode .hl-btn:hover{background:rgba(255,255,255,0.1);border-color:rgba(255,255,255,0.3)}
body.dark-mode .scroll-icon{border-color:rgba(255,255,255,0.2)}
body.dark-mode .scroll-wheel{background:rgba(255,255,255,0.3)}
body.dark-mode .scroll-text{color:rgba(255,255,255,0.3)}
body.dark-mode .label{color:#fff;text-shadow:0 0 30px rgba(0,0,0,0.5)}
body.dark-mode .phi-text{color:#ddd}
body.dark-mode .phi-desc{color:#888}
body.dark-mode .m-num{color:#666}
body.dark-mode .m-desc{color:#999}
body.dark-mode .big-typo{color:#fff;text-shadow:0 0 40px rgba(0,0,0,0.5)}
body.dark-mode .m-btn{border-color:#555;color:#ddd}
body.dark-mode .m-btn:hover{border-color:#fff;background:#fff;color:#000}
body.dark-mode .method-row{border-bottom-color:rgba(255,255,255,0.04)}
body.dark-mode #page-about section{border-bottom-color:rgba(255,255,255,0.04)}
body.dark-mode footer{color:#666;border-top-color:rgba(255,255,255,0.06)}
body.dark-mode .svc-intro-title{color:#eee}
body.dark-mode .svc-intro-desc{color:#777}
body.dark-mode .svc-intro-num{color:#555}
body.dark-mode .chatbox{background:rgba(30,30,30,0.6);border-color:rgba(255,255,255,0.06)}
body.dark-mode .chatbox.expanded{background:rgba(20,20,20,0.75);border-color:rgba(255,255,255,0.08)}
body.dark-mode .cb-header{border-bottom-color:rgba(255,255,255,0.06)}
body.dark-mode .cb-header-name{color:#ccc}
body.dark-mode .cb-header-logo{background:rgba(255,255,255,0.12)}
body.dark-mode .cb-header-logo svg{stroke:#fff}
body.dark-mode .cb-icon-btn{background:rgba(255,255,255,0.06)}
body.dark-mode .cb-icon-btn:hover{background:rgba(255,255,255,0.12)}
body.dark-mode .cb-icon-btn svg{stroke:#999}
body.dark-mode .cb-icon-btn.active{background:#fff}
body.dark-mode .cb-icon-btn.active svg{stroke:#000}
body.dark-mode .cb-close{background:rgba(255,255,255,0.06)}
body.dark-mode .cb-close:hover{background:rgba(255,255,255,0.12)}
body.dark-mode .cb-close svg{stroke:#888}
body.dark-mode .cb-stage-name{color:#ccc;background:rgba(255,255,255,0.06)}
body.dark-mode .ob-dot{background:rgba(255,255,255,0.15)}
body.dark-mode .ob-dot.active{background:#fff}
body.dark-mode .ob-dot.done{background:rgba(255,255,255,0.35)}
body.dark-mode .msg-text{color:#ddd}
body.dark-mode .msg-text strong,body.dark-mode .msg-text b{color:#f0f0f0}
body.dark-mode .msg-text em,body.dark-mode .msg-text i{color:#ccc}
body.dark-mode .msg-text code{background:rgba(255,255,255,0.08)}
body.dark-mode .msg-text pre{background:rgba(255,255,255,0.06)}
body.dark-mode .msg-text blockquote{border-left-color:rgba(255,255,255,0.15);color:#999}
body.dark-mode .msg-text hr{border-top-color:rgba(255,255,255,0.08)}
body.dark-mode .msg-text h3,body.dark-mode .msg-text h4{color:#eee}
body.dark-mode .msg-role{color:#555}
body.dark-mode .msg.msg-right .msg-text{background:rgba(255,255,255,0.08)}
body.dark-mode .msg:not(.msg-right) .msg-text{background:transparent}
body.dark-mode .msg-ava.ai{background:rgba(255,255,255,0.12)}
body.dark-mode .msg-action-btn{background:rgba(255,255,255,0.04)}
body.dark-mode .msg-action-btn:hover{background:rgba(255,255,255,0.08)}
body.dark-mode .msg-action-btn svg{stroke:#666}
body.dark-mode .cb-welcome-t{color:#eee}
body.dark-mode .cb-welcome-s{color:#666}
body.dark-mode .cb-chip{background:rgba(255,255,255,0.04);border-color:rgba(255,255,255,0.08);color:#aaa}
body.dark-mode .cb-chip:hover{background:rgba(255,255,255,0.08);border-color:rgba(255,255,255,0.15)}
body.dark-mode .cb-input{border-top-color:rgba(255,255,255,0.04)}
body.dark-mode .cb-input-row{background:rgba(255,255,255,0.05);border-color:rgba(255,255,255,0.06)}
body.dark-mode .cb-input-row:focus-within{border-color:rgba(255,255,255,0.15);background:rgba(255,255,255,0.08)}
body.dark-mode .cb-ta{color:#eee}
body.dark-mode .cb-ta::placeholder{color:#555}
body.dark-mode .cb-send{background:#fff}
body.dark-mode .cb-send svg{stroke:#000}
body.dark-mode .cb-attach{background:rgba(255,255,255,0.04)}
body.dark-mode .cb-attach:hover{background:rgba(255,255,255,0.08)}
body.dark-mode .cb-attach svg{stroke:#888}
body.dark-mode .cb-model{color:#888;background:rgba(255,255,255,0.06)}
body.dark-mode .cb-model:hover{background:rgba(255,255,255,0.1);color:#bbb}
body.dark-mode .cb-ph{color:#555}
body.dark-mode .cb-caret{background:#666}
body.dark-mode .cb-overlay-panel{background:rgba(10,10,10,0.94);backdrop-filter:blur(60px)}
body.dark-mode .cbp-title{color:#ddd}
body.dark-mode .cbp-profile-sub{color:#666}
body.dark-mode .cbh-item{background:rgba(255,255,255,0.04)}
body.dark-mode .cbh-item:hover{background:rgba(255,255,255,0.08)}
body.dark-mode .cbh-item-preview{color:#ccc}
body.dark-mode .cbh-item-date{color:#555}
body.dark-mode .cbh-empty{color:#555}
body.dark-mode .cbp-tag{background:rgba(255,255,255,0.06);color:#aaa;border-color:rgba(255,255,255,0.08)}
body.dark-mode .cbp-tag.new{background:rgba(255,255,255,0.12);color:#fff;border-color:rgba(255,255,255,0.15)}
body.dark-mode .cbp-section{background:rgba(255,255,255,0.03);border-color:rgba(255,255,255,0.06)}
body.dark-mode .cbp-section-title{color:#666}
body.dark-mode .cbp-section-value{color:#ccc}
body.dark-mode .cbp-prompt-wrap{background:rgba(255,255,255,0.02);border-color:rgba(255,255,255,0.04)}
body.dark-mode .cbp-prompt{color:#666}
body.dark-mode .cbp-gallery-empty{color:#555}
body.dark-mode .cb-file-preview{background:rgba(255,255,255,0.04);color:#aaa}
body.dark-mode .cb-file-preview-icon{background:rgba(255,255,255,0.06)}
body.dark-mode .cb-file-preview-icon svg{stroke:#888}
body.dark-mode #modelMenu{background:#1a1a1a;border-color:rgba(255,255,255,0.08);box-shadow:0 8px 30px rgba(0,0,0,0.4)}
body.dark-mode .mm-opt{color:#ccc}
body.dark-mode .mm-opt:hover{background:rgba(255,255,255,0.06)}
body.dark-mode .mm-opt.active{background:rgba(255,255,255,0.06)}
body.dark-mode .mm-lock{background:rgba(255,255,255,0.08);color:#666}
body.dark-mode .modal-overlay.show{animation:modalBgInDark 1s ease forwards}
@keyframes modalBgInDark{from{background:rgba(0,0,0,0);backdrop-filter:blur(0px)}to{background:rgba(0,0,0,0.5);backdrop-filter:blur(14px)}}
body.dark-mode .login-modal,.dark-mode .pricing-modal{background:rgba(20,20,20,0.92);box-shadow:0 30px 80px rgba(0,0,0,0.5)}
body.dark-mode .login-title,.dark-mode .pricing-title{color:#eee}
body.dark-mode .login-sub,.dark-mode .pricing-sub{color:#666}
body.dark-mode .login-logo svg{stroke:#fff}
body.dark-mode .login-logo svg circle{fill:#fff}
body.dark-mode .btn-google{background:#1a1a1a;border-color:rgba(255,255,255,0.1);color:#ddd}
body.dark-mode .btn-google:hover{background:#222;border-color:rgba(255,255,255,0.2)}
body.dark-mode .login-terms{color:#444}
body.dark-mode .login-terms a{color:#666}
body.dark-mode .price-card{border-color:rgba(255,255,255,0.06)}
body.dark-mode .price-card.featured{border-color:#fff}
body.dark-mode .pc-name{color:#eee}
body.dark-mode .pc-price{color:#eee}
body.dark-mode .pc-price span{color:#666}
body.dark-mode .pc-desc{color:#666}
body.dark-mode .pc-features li{color:#bbb}
body.dark-mode .pc-features li::before{color:#fff}
body.dark-mode .btn-price{border-color:#fff}
body.dark-mode .btn-price.primary{background:#fff;color:#000}
body.dark-mode .btn-price.primary:hover{background:#ddd}
body.dark-mode .btn-price.secondary{border-color:#333;color:#555}
body.dark-mode .modal-close svg{stroke:#666}
body.dark-mode .archive-map-title{color:#eee}
body.dark-mode .archive-map-sub{color:#666}
body.dark-mode .mypage-title{color:#eee}
body.dark-mode .mypage-card{background:rgba(30,30,30,0.6);border-color:rgba(255,255,255,0.06)}
body.dark-mode .mc-value{color:#eee}
body.dark-mode .mc-sub{color:#666}
body.dark-mode .sub-badge{background:rgba(255,255,255,0.06);color:#888}
body.dark-mode .sub-badge.pro{background:#fff;color:#000}
body.dark-mode .btn-upgrade{background:#fff;color:#000;border-color:#fff}
body.dark-mode .btn-unmask-start{background:#fff;color:#000;border-color:#fff}
body.dark-mode .interpret-input{background:rgba(255,255,255,0.05);border-color:rgba(255,255,255,0.08);color:#eee}
body.dark-mode .interpret-input:focus{border-color:rgba(255,255,255,0.2);background:rgba(255,255,255,0.08)}
body.dark-mode .interpret-go{background:#fff;color:#000}
body.dark-mode .ir-field{color:#eee}
body.dark-mode .ir-badge{color:#888;border-color:rgba(255,255,255,0.1)}
body.dark-mode .ir-card{background:rgba(255,255,255,0.03);border-color:rgba(255,255,255,0.06)}
body.dark-mode .ir-card-title{color:#888}
body.dark-mode .ir-card-body{color:#ddd}
body.dark-mode .ir-insight{background:rgba(255,255,255,0.02);border-color:rgba(255,255,255,0.06)}

/* ============ THEME TOGGLE ============ */
.btn-theme{display:flex;align-items:center;justify-content:center;width:34px;height:34px;border:1px solid rgba(0,0,0,0.08);border-radius:8px;background:transparent;cursor:pointer;transition:0.2s;flex-shrink:0}
.btn-theme:hover{border-color:rgba(0,0,0,0.2);background:rgba(0,0,0,0.02)}
.btn-theme:active{transform:scale(0.92);transition:0.06s}
.btn-theme svg{width:15px;height:15px;stroke:#555;fill:none;stroke-width:1.5;transition:0.3s}
body.dark-mode .btn-theme{border-color:rgba(255,255,255,0.1)}
body.dark-mode .btn-theme:hover{border-color:rgba(255,255,255,0.2);background:rgba(255,255,255,0.04)}
body.dark-mode .btn-theme svg{stroke:#999}
.btn-theme .icon-moon{display:block}
.btn-theme .icon-sun{display:none}
body.dark-mode .btn-theme .icon-moon{display:none}
body.dark-mode .btn-theme .icon-sun{display:block}

/* ============ LANGUAGE SELECTOR ============ */
.lang-sel{position:relative;display:flex;align-items:center}
.lang-btn{display:flex;align-items:center;gap:5px;padding:0 12px;height:34px;border:1px solid rgba(0,0,0,0.08);border-radius:8px;background:transparent;font-size:11px;font-weight:500;color:#666;cursor:pointer;transition:0.2s;font-family:inherit;letter-spacing:0.04em;box-sizing:border-box}
.lang-btn:hover{border-color:rgba(0,0,0,0.2);background:rgba(0,0,0,0.02)}
.lang-btn:active{transform:scale(0.94);transition:0.06s}
.lang-btn svg{width:12px;height:12px;stroke:currentColor;fill:none;stroke-width:1.5}
body.dark-mode .lang-btn{color:#999;border-color:rgba(255,255,255,0.1)}
body.dark-mode .lang-btn:hover{border-color:rgba(255,255,255,0.2);background:rgba(255,255,255,0.04)}
.lang-dropdown{display:none;position:absolute;top:42px;right:0;background:#fff;border:1px solid rgba(0,0,0,0.08);border-radius:10px;padding:4px;min-width:130px;box-shadow:0 8px 30px rgba(0,0,0,0.12);z-index:9999}
.lang-dropdown.show{display:block}
body.dark-mode .lang-dropdown{background:#1a1a1a;border-color:rgba(255,255,255,0.08);box-shadow:0 8px 30px rgba(0,0,0,0.4)}
.lang-opt{display:flex;align-items:center;gap:8px;width:100%;padding:9px 12px;font-size:12px;color:#333;border:none;background:none;cursor:pointer;border-radius:6px;transition:0.15s;font-family:inherit;text-align:left}
.lang-opt:hover{background:rgba(0,0,0,0.04)}
.lang-opt.active{font-weight:600;background:rgba(0,0,0,0.04)}
body.dark-mode .lang-opt{color:#ccc}
body.dark-mode .lang-opt:hover{background:rgba(255,255,255,0.06)}
body.dark-mode .lang-opt.active{background:rgba(255,255,255,0.06)}

/* ============ FILE ATTACH PREVIEW ============ */
.cb-attach-preview{display:flex;align-items:center;gap:8px;padding:6px 10px;margin-bottom:6px;background:rgba(0,0,0,0.03);border-radius:8px;font-size:12px;color:#555;animation:msgIn 0.3s ease}
body.dark-mode .cb-attach-preview{background:rgba(255,255,255,0.04);color:#aaa}
.cb-attach-preview-icon{width:24px;height:24px;border-radius:6px;background:rgba(0,0,0,0.06);display:flex;align-items:center;justify-content:center;flex-shrink:0}
body.dark-mode .cb-attach-preview-icon{background:rgba(255,255,255,0.06)}
.cb-attach-preview-icon svg{width:12px;height:12px;stroke:#666;fill:none;stroke-width:1.5}
body.dark-mode .cb-attach-preview-icon svg{stroke:#888}
.cb-attach-preview-name{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.cb-attach-preview-img{width:40px;height:40px;border-radius:6px;object-fit:cover;flex-shrink:0}
.cb-attach-preview-remove{width:20px;height:20px;border:none;background:none;cursor:pointer;display:flex;align-items:center;justify-content:center;opacity:0.4;transition:0.15s}
.cb-attach-preview-remove:hover{opacity:1}
.cb-attach-preview-remove svg{width:10px;height:10px;stroke:#999;fill:none;stroke-width:2}

</style>
</head>
<body>
<div class="cursor-dot"></div>
<div class="cursor-ring"></div>
<nav>
  <div class="logo" id="logoBtn"><svg viewBox="0 0 24 24"><path d="M 5 19 A 10 10 0 1 1 19 19" fill="none" stroke-linecap="round"/><circle cx="12" cy="12" r="2.5" fill="currentColor" stroke="none"/></svg>Aletheia</div>
  <ul class="nav-center">
    <li data-page="about" class="active">ABOUT</li>
    <li data-page="unmask">UNMASK</li>
    <li data-page="interpret">INTERPRET</li>
    <li data-page="archive">ARCHIVE</li>
  </ul>
  <div class="nav-auth">
    <div class="lang-sel" id="langSel">
      <button class="lang-btn" id="langBtn"><span id="langCurrent">KO</span><svg viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg></button>
      <div class="lang-dropdown" id="langDropdown">
        <button class="lang-opt active" data-lang="ko">한국어</button>
        <button class="lang-opt" data-lang="en">English</button>
        <button class="lang-opt" data-lang="es">Español</button>
      </div>
    </div>
    <button class="btn-theme" id="btnTheme" title="테마 변경">
      <svg class="icon-moon" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3a9 9 0 0 0 9.79 9.79z"/></svg>
      <svg class="icon-sun" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
    </button>
    <button class="btn-signin" id="btnSignIn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="8" r="4"/><path d="M6 21v-1a6 6 0 0 1 12 0v1"/></svg><span data-i18n="signIn">Sign in</span></button>
    <div class="nav-profile" id="navProfile">
      <div class="nav-profile-btn" id="navProfileBtn"><svg viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M6 21v-1a6 6 0 0 1 12 0v1"/></svg><span class="nav-name" id="navName">User</span></div>
      <div class="profile-dropdown" id="profileDropdown">
        <button class="pd-item" id="btnMyPage" data-i18n="myPage">My Page</button>
        <button class="pd-item" id="btnSignOut" data-i18n="signOut">Sign out</button>
      </div>
    </div>
  </div>
  <button class="nav-hamburger" id="navHamburger"><span></span><span></span><span></span></button>
</nav>
<div class="nav-mobile-menu" id="navMobileMenu">
  <li data-page="about">ABOUT</li>
  <li data-page="unmask">UNMASK</li>
  <li data-page="interpret">INTERPRET</li>
  <li data-page="archive">ARCHIVE</li>
  <li id="mobileSignIn">SIGN IN</li>
</div>
<div id="canvas-container"></div>

<!-- ABOUT -->
<div class="page active" id="page-about">
  <div class="hero-top">
    <div class="hero-landing">
      <div class="hl-logo" id="hlLogo">Aletheia</div>
      <div class="hl-bottom">
        <div class="hl-typing" id="hlTyping"></div>
        <div class="hl-subtitle" id="hlSubtitle">
          <div class="hl-sub-line1">본질을 대화로 꺼내는 AI 서비스</div>
          <div class="hl-sub-line2">물성(物性) : 겉치레를 벗겨낸 당신 그 자체. 그것이 가장 강한 이야기입니다.</div>
        </div>
        <div class="hl-buttons" id="hlButtons">
          <button class="hl-btn" onclick="goPage('unmask')">UNMASK</button>
          <button class="hl-btn" onclick="goPage('interpret')">INTERPRET</button>
        </div>
      </div>
      <div class="scroll-indicator">
        <div class="scroll-icon">
          <div class="scroll-wheel"></div>
        </div>
        <div class="scroll-text">scroll</div>
      </div>
    </div>
  </div>
  <div class="container">
    <section id="sec-philosophy"><span class="label typing-target" data-text="Our Core"></span><div class="phi-text reveal reveal-d1">"당신의 이야기에서 본질을 추출하고, 그것을 물성으로 치환합니다."</div><div class="phi-desc reveal reveal-d2">우리는 외부에서 유행하는 아이템을 가져오는 것이 아니라, 당신 내면의 원초적인 경험과 성질을 추출하여 세상에 단 하나뿐인 비즈니스의 물성으로 치환합니다. 대화할수록 데이터가 쌓이고, 그 데이터가 당신의 본질이 됩니다.</div></section>

    <!-- ===== DEMO SECTIONS ===== -->
    <section id="sec-howit" style="padding:120px 0 0"><span class="label typing-target" data-text="How It Works"></span></section>
    <section id="sec-demo1" class="demo-section">
      <div class="demo-layout">
        <div class="demo-text reveal">
          <span class="demo-num">/STEP 01</span>
          <h2 class="demo-title">대화가 깊어질수록<br>윤곽이 드러납니다.</h2>
          <p class="demo-desc">Aletheia는 답을 주지 않습니다.<br>가려져 있던 것의 가림막을 벗깁니다.</p>
        </div>
        <div class="demo-visual reveal reveal-d2">
          <div class="demo-chat-mock">
            <div class="dcm-header">
              <span class="dcm-status"></span>
              <span class="dcm-title">Aletheia Core</span>
            </div>
            <div class="dcm-messages" id="demo-chat-1">
              <div class="dcm-msg dcm-ai" data-demo="요즘 어떤 생각에 빠져 있어요?">
                <span class="dcm-label">ALETHEIA</span>
                <div class="dcm-bubble">요즘 어떤 생각에 빠져 있어요?</div>
              </div>
              <div class="dcm-msg dcm-user" data-demo="카페를 열고 싶은데... 뭔가 확신이 없어요.">
                <span class="dcm-label">YOU</span>
                <div class="dcm-bubble">카페를 열고 싶은데... 뭔가 확신이 없어요.</div>
              </div>
              <div class="dcm-msg dcm-ai" data-demo="카페라는 형태를 걷어내면, 진짜 하고 싶은 건 뭘까요?">
                <span class="dcm-label">ALETHEIA</span>
                <div class="dcm-bubble">카페라는 형태를 걷어내면, 진짜 하고 싶은 건 뭘까요?</div>
              </div>
              <div class="dcm-msg dcm-user" data-demo="...공간? 내 이야기가 담긴 공간을 만들고 싶은 것 같아요.">
                <span class="dcm-label">YOU</span>
                <div class="dcm-bubble">...공간? 내 이야기가 담긴 공간을 만들고 싶은 것 같아요.</div>
              </div>
              <div class="dcm-msg dcm-ai" data-demo="'공간'이라는 단어를 두 번 썼어요. 거기에 뭔가 있는 것 같아요.">
                <span class="dcm-label">ALETHEIA</span>
                <div class="dcm-bubble">'공간'이라는 단어를 두 번 썼어요. 거기에 뭔가 있는 것 같아요.</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="sec-demo2" class="demo-section">
      <div class="demo-layout demo-layout-reverse">
        <div class="demo-visual reveal">
          <div class="demo-profile-mock">
            <div class="dpm-header"><span class="dpm-title">Essence Snapshot</span><span class="dpm-ver">v1.0</span></div>
            <div class="dpm-body">
              <div class="dpm-tag-area" id="demo-tags">
                <span class="dpm-tag" data-delay="0">공간감각</span>
                <span class="dpm-tag" data-delay="200">독립지향</span>
                <span class="dpm-tag" data-delay="400">경험기반</span>
                <span class="dpm-tag" data-delay="600">자기탐색</span>
                <span class="dpm-tag" data-delay="800">본질추구</span>
              </div>
              <div class="dpm-section">
                <span class="dpm-label">핵심 가치</span>
                <p class="dpm-value" id="demo-value">표면을 뚫고 구조를 보려는 사람</p>
              </div>
              <div class="dpm-section">
                <span class="dpm-label">에너지 지도</span>
                <div class="dpm-energy">
                  <span class="dpm-energy-high">↑ 자기 철학을 만들 때</span>
                  <span class="dpm-energy-low">↓ 남의 기준에 맞출 때</span>
                </div>
              </div>
              <div class="dpm-section">
                <span class="dpm-label">서사</span>
                <p class="dpm-narrative" id="demo-narrative">가짜를 참지 못하는 사람이 진짜를 찾아 헤매다, 자기만의 도구를 만들기 시작했다.</p>
              </div>
            </div>
          </div>
        </div>
        <div class="demo-text reveal reveal-d2">
          <span class="demo-num">/STEP 02</span>
          <h2 class="demo-title">태그가 아니라 서사.<br>진단이 아니라 발견.</h2>
          <p class="demo-desc">대화가 쌓일수록 당신만의 Essence가 형성됩니다.<br>확정이 아니라 현재 버전의 스냅샷.</p>
        </div>
      </div>
    </section>

    <section id="sec-demo3" class="demo-section">
      <div class="demo-layout">
        <div class="demo-text reveal">
          <span class="demo-num">/STEP 03</span>
          <h2 class="demo-title">자기를 아는 사람은<br>AI를 도구로 쓴다.</h2>
          <p class="demo-desc">Aletheia는 AI 과의존을 만들지 않습니다.<br>자기 기준이 있는 사람을 만드는 것이 목표입니다.</p>
        </div>
        <div class="demo-visual reveal reveal-d2">
          <div class="demo-manifesto">
            <div class="dm-line dm-line-fade">알고리즘이 추천하는 '나'</div>
            <div class="dm-line dm-line-strike">트렌드가 만드는 '나'</div>
            <div class="dm-line dm-line-strike">데이터가 예측하는 '나'</div>
            <div class="dm-divider"></div>
            <div class="dm-line dm-line-strong">진짜 '나'</div>
          </div>
        </div>
      </div>
    </section>
    <!-- ===== END DEMO SECTIONS ===== -->
    <section id="sec-method"><span class="label typing-target" data-text="The Method"></span><div class="method-list">
      <div class="method-row reveal reveal-d1"><div class="method-left"><span class="m-num">/0.1</span><p class="m-desc"><strong>Unmask</strong><br>대화를 통해 당신의 패턴, 가치관, 잠재 동기를 추출하고<br>하나의 프로필로 합성합니다.</p><button class="m-btn" onclick="goPage('unmask')">Start Unmask →</button></div><div class="method-right"><div class="big-typo">UNMASK</div></div></div>
      <div class="method-row reveal reveal-d2"><div class="method-left"><span class="m-num">/0.2</span><p class="m-desc"><strong>Interpret</strong><br>산업의 본질과 당신의 본질이 만나는 교차점을 찾습니다.</p><button class="m-btn" onclick="goPage('interpret')">Start Interpret →</button></div><div class="method-right"><div class="big-typo">INTERPRET</div></div></div>
    </div></section>
    <footer><div>© 2026 Aletheia</div><div>Less but Better</div></footer>
  </div>
</div>

<!-- CORE -->
<div class="page" id="page-unmask">
  <div class="svc-page">
    <div class="svc-intro"><div class="svc-intro-num svc-anim" data-delay="0">/0.1</div><h2 class="svc-intro-title svc-anim" data-delay="100">당신을 발견하세요.</h2><p class="svc-intro-desc svc-anim" data-delay="200">대화를 시작하면 당신의 윤곽이 드러납니다.<br>가치관, 패턴, 회피하는 것 — 모든 것이 여기에 쌓입니다.</p></div>
  </div>
  <!-- v4-style chatbox -->
  <div class="chatbox-wrap" id="coreWrap">
    <div class="chatbox" id="coreBox">
      <div class="cb-slider" id="cbSlider">
      <div class="cb-body">
        <div class="cb-header">
          <div class="cb-header-left">
            <div class="cb-header-logo"><svg viewBox="0 0 24 24"><path d="M 5 19 A 10 10 0 1 1 19 19" stroke-linecap="round"/><circle cx="12" cy="12" r="2" fill="currentColor" stroke="none"/></svg></div>
            <span class="cb-header-name" id="cbHeaderName">Aletheia Core</span>
          </div>
          <div class="cb-header-center" id="cbProgress">
            <div class="cb-progress-info">
              <span class="cb-turn-count" id="cbTurnCount">0턴</span>
              <span class="cb-stage-name" id="cbStageName">표면</span>
            </div>
            <div class="cb-progress-bar">
              <div class="cb-progress-fill" id="cbProgressFill"></div>
            </div>
          </div>
          <div class="cb-header-right">
            <button class="cb-icon-btn" id="cbNewChat" title="새 대화"><svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button>
            <button class="cb-icon-btn" id="cbBookmarkList" title="북마크"><svg viewBox="0 0 24 24"><path d="M6 4h12a1 1 0 0 1 1 1v16l-7-4-7 4V5a1 1 0 0 1 1-1z"/></svg></button>
            <button class="cb-icon-btn" id="cbGalleryBtn" title="갤러리"><svg viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="3"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg></button>
            <button class="cb-icon-btn" id="cbProfileBtn" title="Unmask"><svg viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M6 21v-1a6 6 0 0 1 12 0v1"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="17" y1="11" x2="23" y2="11"/></svg><span class="unmask-badge" id="umBadge">0</span></button>
            <button class="cb-icon-btn" id="cbHistoryBtn" title="이전 대화"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></button>
            <button class="cb-icon-btn" id="cbPrintBtn" title="대화 프린트"><svg viewBox="0 0 24 24"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg></button>
            <button class="cb-close" id="cbClose"><svg viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg></button>
          </div>
        </div>
        <!-- History Panel -->
        <div class="cb-overlay-panel" id="cbHistoryPanel">
          <div class="cbp-title">이전 대화</div>
          <div class="cbp-list" id="cbHistoryList"></div>
        </div>
        <!-- Bookmark Panel -->
        <div class="cb-overlay-panel" id="cbBookmarkPanel">
          <div class="cbp-title">저장된 메시지</div>
          <div class="cbp-list" id="cbBookmarkListContent"></div>
        </div>
        <!-- Gallery Panel -->
        <div class="cb-overlay-panel" id="cbGalleryPanel">
          <div class="cbp-title">갤러리</div>
          <div class="cbp-gallery" id="cbGalleryGrid"></div>
        </div>
        <!-- Profile Panel -->
        <div class="cb-overlay-panel" id="cbProfilePanel">
          <div class="cbp-title">UNMASK</div>
          <div class="cbp-profile-sub">대화할수록 당신의 윤곽이 드러납니다.</div>
          <div class="um-status" id="umStatus"><span class="um-status-dot" id="umStatusDot2"></span><span id="umStatusText2">대기 중</span></div>
          <div class="um-depth-wrap">
            <div class="um-depth-label"><span class="um-depth-title">대화 깊이</span><span class="um-depth-count" id="umDepthCount">0회</span></div>
            <div class="um-depth-bar"><div class="um-depth-fill" id="umDepthFill"></div></div>
            <div class="um-depth-stages" id="umStages">
              <span class="um-stage active" data-stage="0">표면</span>
              <span class="um-stage" data-stage="1">패턴</span>
              <span class="um-stage" data-stage="2">가치관</span>
              <span class="um-stage" data-stage="3">동기</span>
              <span class="um-stage" data-stage="4">Essence</span>
            </div>
          </div>
          <div class="cbp-tags" id="cbProfileTags"></div>
          <div class="cbp-section locked" id="umSecValues">
            <div class="cbp-section-title">핵심 가치관</div>
            <div class="cbp-section-value" id="profileValues">대화가 더 필요합니다...</div>
          </div>
          <div class="cbp-section locked" id="umSecAvoid">
            <div class="cbp-section-title">회피 패턴</div>
            <div class="cbp-section-value" id="profileAvoid">대화가 더 필요합니다...</div>
          </div>
          <div class="cbp-section locked" id="umSecMotiv">
            <div class="cbp-section-title">잠재 동기</div>
            <div class="cbp-section-value" id="profileMotiv">대화가 더 필요합니다...</div>
          </div>
          <!-- Essence Prompts (blur paywall) -->
          <div class="essence-prompts" id="essencePrompts" style="display:none">
            <div class="ep-header">
              <span class="ep-title"><svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>AI PROMPTS</span>
              <span class="ep-badge">GENERATED</span>
            </div>
            <div class="ep-list" id="epList">
              <div class="ep-item preview">나는 표면보다 구조를 보는 사람입니다.</div>
              <div class="ep-item locked">추상적 조언보다 구체적 사례와 경험으로 설명해주세요.</div>
              <div class="ep-item locked">완벽보다 진짜를 추구합니다. 솔직하게 대화해주세요.</div>
              <div class="ep-item locked">권위보다 논리로 설득해주세요.</div>
            </div>
            <button class="ep-unlock" id="epUnlock"><svg viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>전체 프롬프트 보기 — 구독 또는 크레딧</button>
          </div>
          <!-- Essence Document Generation -->
          <div class="essence-doc-gen" id="essenceDocGen" style="display:none">
            <button class="ed-btn" id="edGenBtn"><svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>Essence Document 생성</button>
            <p class="ed-desc">대화에서 추출된 본질을 문서로 정리합니다.<br>ChatGPT, Gemini 등에 바로 붙여넣기 가능.</p>
          </div>
        </div>
        <div class="cb-msgs" id="cbMsgs">
          <div class="cb-welcome" id="cbWelcome">
            <!-- Onboarding Step 1: 목적 선택 -->
            <div class="ob-step active" id="obStep1">
              <div class="ob-progress"><span class="ob-dot active"></span><span class="ob-dot"></span><span class="ob-dot"></span></div>
              <div class="ob-title">무엇을 알러 오셨나요?</div>
              <div class="ob-subtitle">선택하시면 맞춤형 대화가 시작됩니다</div>
              <div class="ob-options">
                <button class="ob-option" data-purpose="career">
                  <div class="ob-option-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="7" width="18" height="14" rx="2"/><path d="M8 7V5a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg></div>
                  <div class="ob-option-label">직업 / 커리어</div>
                  <div class="ob-option-desc">전환, 방향 찾기</div>
                </button>
                <button class="ob-option" data-purpose="study">
                  <div class="ob-option-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg></div>
                  <div class="ob-option-label">전공 / 학업</div>
                  <div class="ob-option-desc">진로 고민, 적성 탐색</div>
                </button>
                <button class="ob-option" data-purpose="hobby">
                  <div class="ob-option-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><path d="M9.5 9.5c0-1 .5-2 2.5-2s2.5 1 2.5 2c0 2-2.5 2-2.5 4"/><circle cx="12" cy="17" r=".5" fill="currentColor"/></svg></div>
                  <div class="ob-option-label">취향 / 취미</div>
                  <div class="ob-option-desc">사업화, 수익화</div>
                </button>
                <button class="ob-option" data-purpose="creator">
                  <div class="ob-option-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="2" y="2" width="20" height="20" rx="2"/><circle cx="12" cy="12" r="3"/></svg></div>
                  <div class="ob-option-label">크리에이터</div>
                  <div class="ob-option-desc">콘텐츠 방향 찾기</div>
                </button>
                <button class="ob-option" data-purpose="unsure">
                  <div class="ob-option-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M3 12h18"/><path d="M12 3v18"/></svg></div>
                  <div class="ob-option-label">잘 모르겠어요</div>
                  <div class="ob-option-desc">탐색부터 시작</div>
                </button>
              </div>
            </div>

            <!-- Onboarding Step 2: 구체적 정보 -->
            <div class="ob-step" id="obStep2">
              <div class="ob-progress"><span class="ob-dot done"></span><span class="ob-dot active"></span><span class="ob-dot"></span></div>
              <div class="ob-title" id="obStep2Title">조금 더 구체적으로 알려주세요</div>
              <div class="ob-subtitle" id="obStep2Subtitle">자유롭게 작성하거나 선택해주세요</div>

              <!-- Career/Study 입력 -->
              <div class="ob-input-group" id="obCareerGroup" style="display:none">
                <input type="text" class="ob-input" id="obCareerInput" placeholder="예: 마케팅, 개발자, 디자이너...">
                <div class="ob-quick-picks" id="obCareerPicks"></div>
              </div>

              <!-- Hobby 입력 -->
              <div class="ob-input-group" id="obHobbyGroup" style="display:none">
                <input type="text" class="ob-input" id="obHobbyInput" placeholder="예: 커피, 베이킹, 향수, 목공...">
                <div class="ob-quick-picks" id="obHobbyPicks"></div>
              </div>

              <!-- Creator 입력 -->
              <div class="ob-input-group" id="obCreatorGroup" style="display:none">
                <input type="text" class="ob-input" id="obCreatorInput" placeholder="예: 브이로그, 리뷰, 일상, 교육...">
                <div class="ob-quick-picks" id="obCreatorPicks"></div>
              </div>

              <div class="ob-nav">
                <button class="ob-btn ob-btn-back" id="obBack1">← 이전</button>
                <button class="ob-btn ob-btn-next" id="obNext1">다음 →</button>
              </div>
            </div>

            <!-- Onboarding Step 3: 시작 확인 -->
            <div class="ob-step" id="obStep3">
              <div class="ob-progress"><span class="ob-dot done"></span><span class="ob-dot done"></span><span class="ob-dot active"></span></div>
              <div class="ob-title">준비되었습니다</div>
              <div class="ob-summary" id="obSummary">
                <div class="ob-summary-item"><strong>목적:</strong> <span id="obSummaryPurpose"></span></div>
                <div class="ob-summary-item"><strong>분야:</strong> <span id="obSummaryDetail"></span></div>
              </div>
              <div class="ob-subtitle">대화를 시작하면 당신의 본질을 찾아갑니다</div>
              <div class="ob-nav">
                <button class="ob-btn ob-btn-back" id="obBack2">← 수정</button>
                <button class="ob-btn ob-btn-start" id="obStart">대화 시작하기 →</button>
              </div>
            </div>
          </div>
        </div>
        <div class="cb-input locked" id="cbInputArea">
          <div class="cb-model-row"><div class="cb-model" id="cbModel"><span class="dot" style="background:#000"></span><span class="model-name">Core</span><svg class="arr" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg></div></div>
          <div class="cb-input-row"><button class="cb-attach" id="cbAttach" title="파일 첨부"><svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button><textarea class="cb-ta" id="cbTa" placeholder="위에서 모드를 선택해주세요" rows="1" disabled></textarea><button class="cb-send" id="cbSend"><svg viewBox="0 0 24 24"><line x1="12" y1="19" x2="12" y2="5"/><polyline points="5 12 12 5 19 12"/></svg></button></div>
        </div>
      </div>
      <!-- URP View (slide-in within chatbox) -->
      <div class="urp-view" id="urpView">
        <div class="urp-head">
          <button class="urp-back" id="urpBack" title="대화로 돌아가기"><svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg></button>
          <span class="urp-head-title">UNMASK</span>
          <span class="urp-head-badge">Essence v2.0</span>
          <button class="urp-print" id="urpPrint" title="프린트"><svg viewBox="0 0 24 24"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg></button>
        </div>
        <div class="urp-body" id="urpBody">
          <div class="urp-empty">대화가 충분히 진행되면<br>분석 결과가 여기에 표시됩니다.</div>
        </div>
      </div>
      </div><!-- /cb-slider -->
      <div class="cb-bar" id="cbBar"><span class="cb-ph"><span class="cb-caret"></span>대화를 시작하세요...</span></div>
    </div>
  <!-- UNMASK ANALYSIS PANEL -->
  <div class="unmask-panel" id="unmaskPanel" style="display:none">
    <div class="um-header">
      <span class="um-header-title">Unmask</span>
      <span class="um-header-status"><span class="um-status-dot" id="umStatusDot"></span><span id="umStatusText">대기</span></span>
    </div>
    <div class="um-body" id="umBody">
      <div class="um-empty" id="umEmpty">
        <div class="um-empty-icon"><svg viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M6 21v-1a6 6 0 0 1 12 0v1"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="17" y1="11" x2="23" y2="11"/></svg></div>
        <div class="um-empty-text">대화를 시작하면<br>당신의 본질이 여기에 쌓입니다.</div>
      </div>
    </div>
  </div>
  </div>
</div>

<!-- INTERPRET -->
<div class="page" id="page-interpret">
  <div class="svc-page"><div class="svc-intro"><div class="svc-intro-num svc-anim" data-delay="0">/0.3</div><h2 class="svc-intro-title svc-anim" data-delay="100">산업의 본질을<br>교차시킵니다.</h2><p class="svc-intro-desc svc-anim" data-delay="200">진입하려는 분야를 입력하세요.<br>그 분야가 진짜로 팔고 있는 것과 당신의 본질이 만나는 지점.</p><div class="interpret-input-wrap svc-anim" data-delay="300"><input class="interpret-input" id="interpretInput" placeholder="예: 스페셜티 커피"/><button class="interpret-go" id="interpretGo">해석 시작</button></div></div>
  <div class="interpret-result" id="interpretResult" style="display:none">
    <div class="ir-header"><span class="ir-field" id="irField"></span><span class="ir-badge">INTERPRET ANALYSIS</span></div>
    <div class="ir-grid">
      <div class="ir-card"><div class="ir-card-title">표면적 가치</div><div class="ir-card-body" id="irSurface"></div></div>
      <div class="ir-card"><div class="ir-card-title">본질적 가치</div><div class="ir-card-body" id="irEssence"></div></div>
      <div class="ir-card"><div class="ir-card-title">숨겨진 욕구</div><div class="ir-card-body" id="irDesire"></div></div>
      <div class="ir-card"><div class="ir-card-title">교차점</div><div class="ir-card-body" id="irCross"></div></div>
    </div>
    <div class="ir-insight"><div class="ir-card-title">핵심 인사이트</div><div class="ir-card-body" id="irInsight"></div></div>
  </div>
  </div>
</div>

<!-- ARCHIVE -->
<div class="page" id="page-archive">
  <div class="archive-map">
    <div class="archive-map-header">
      <h1 class="archive-map-title">실증의 기록.</h1>
      <p class="archive-map-sub">Aletheia가 해석한 다양한 분야의 본질 아카이브.</p>
    </div>
    <div class="archive-map-canvas" id="archiveMapCanvas">
      <svg class="map-lines" id="mapLines"></svg>
      <div class="map-node" style="left:18%;top:32%" data-node="0">
        <div class="map-dot-glow"></div><div class="map-dot"></div><div class="map-orbit"><div class="map-orbit-dot"></div><div class="map-orbit-dot"></div><div class="map-orbit-dot"></div></div><div class="map-spark s1"></div><div class="map-spark s2"></div><div class="map-spark s3"></div>
        <div class="map-label"><div class="map-label-cat">Cafe & Bakery</div><div class="map-label-name">GYEOL</div></div>
      </div>
      <div class="map-node" style="left:45%;top:22%" data-node="1">
        <div class="map-dot-glow"></div><div class="map-dot"></div><div class="map-orbit"><div class="map-orbit-dot"></div><div class="map-orbit-dot"></div><div class="map-orbit-dot"></div></div><div class="map-spark s1"></div><div class="map-spark s2"></div><div class="map-spark s3"></div>
        <div class="map-label"><div class="map-label-cat">Space Design</div><div class="map-label-name">RAW CONCRETE</div></div>
      </div>
      <div class="map-node" style="left:75%;top:28%" data-node="2">
        <div class="map-dot-glow"></div><div class="map-dot"></div><div class="map-orbit"><div class="map-orbit-dot"></div><div class="map-orbit-dot"></div><div class="map-orbit-dot"></div></div><div class="map-spark s1"></div><div class="map-spark s2"></div><div class="map-spark s3"></div>
        <div class="map-label"><div class="map-label-cat">Fashion</div><div class="map-label-name">STRUCTURE 01</div></div>
      </div>
      <div class="map-node" style="left:28%;top:62%" data-node="3">
        <div class="map-dot-glow"></div><div class="map-dot"></div><div class="map-orbit"><div class="map-orbit-dot"></div><div class="map-orbit-dot"></div><div class="map-orbit-dot"></div></div><div class="map-spark s1"></div><div class="map-spark s2"></div><div class="map-spark s3"></div>
        <div class="map-label"><div class="map-label-cat">Fragrance</div><div class="map-label-name">DEEP SOIL</div></div>
      </div>
      <div class="map-node" style="left:55%;top:55%" data-node="4">
        <div class="map-dot-glow"></div><div class="map-dot"></div><div class="map-orbit"><div class="map-orbit-dot"></div><div class="map-orbit-dot"></div><div class="map-orbit-dot"></div></div><div class="map-spark s1"></div><div class="map-spark s2"></div><div class="map-spark s3"></div>
        <div class="map-label"><div class="map-label-cat">Exhibition</div><div class="map-label-name">THE VOID</div></div>
      </div>
      <div class="map-node" style="left:80%;top:65%" data-node="5">
        <div class="map-dot-glow"></div><div class="map-dot"></div><div class="map-orbit"><div class="map-orbit-dot"></div><div class="map-orbit-dot"></div><div class="map-orbit-dot"></div></div><div class="map-spark s1"></div><div class="map-spark s2"></div><div class="map-spark s3"></div>
        <div class="map-label"><div class="map-label-cat">Architecture</div><div class="map-label-name">MONOLITH</div></div>
      </div>
    </div>
  </div>
</div>

<!-- PROJECT DETAIL OVERLAY -->
<div class="project-detail" id="projectDetail">
  <div class="project-detail-bg"></div>
  <button class="project-detail-close" id="pdClose"><svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
  <div class="project-detail-inner" id="pdInner"></div>
</div>

<!-- MY PAGE -->
<div class="page" id="page-mypage">
  <div class="mypage-inner"><h1 class="mypage-title">나의 여정.</h1><div class="mypage-grid"><div class="mypage-card"><div class="mc-label">PROFILE</div><div class="mc-value" id="mpName">—</div><div class="mc-sub" id="mpEmail">—</div></div><div class="mypage-card"><div class="mc-label">SUBSCRIPTION</div><span class="sub-badge" id="mpBadge">FREE</span><button class="btn-upgrade" id="btnUpgrade">구독 시작하기</button></div></div></div>
</div>

<!-- MODALS -->
<div class="modal-overlay" id="loginOverlay"><div class="login-modal"><div class="login-logo"><svg viewBox="0 0 24 24"><path d="M 5 19 A 10 10 0 1 1 19 19" fill="none" stroke-linecap="round"/><circle cx="12" cy="12" r="2.5" fill="currentColor" stroke="none"/></svg></div><div class="login-title">Aletheia에 오신 것을 환영합니다</div><div class="login-sub">본질을 탐구하는 여정을 시작하세요.</div><button class="btn-google" id="btnGoogle"><svg viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>Google로 계속하기</button><div class="login-terms">로그인 시 <a href="#">이용약관</a> 및 <a href="#">개인정보처리방침</a>에 동의합니다.</div></div></div>
<div class="modal-overlay" id="pricingOverlay"><div class="pricing-modal"><button class="modal-close" id="pricingClose"><svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button><div class="pricing-title">당신의 본질에 투자하세요.</div><div class="pricing-sub">Aletheia의 서비스를 선택하세요.</div><div class="pricing-grid"><div class="price-card"><div class="pc-name">Explorer</div><div class="pc-price">₩0 <span>/ 영구</span></div><div class="pc-desc">Aletheia의 철학을 경험하세요.</div><ul class="pc-features"><li data-i18n="priceFeat1">Unmask 기본 대화 (일 10세션)</li><li>Unmask 실시간 프로필</li><li>Archive 열람</li></ul><button class="btn-price secondary" disabled>현재 플랜</button></div><div class="price-card featured"><div class="pc-name">Seeker</div><div class="pc-price">₩29,000 <span>/ 월</span></div><div class="pc-desc">본질을 깊이 탐구하는 풀 서비스.</div><ul class="pc-features"><li>Unmask 무제한 대화</li><li>Unmask 심층 분석</li><li>Interpret 분야 해석</li><li>채팅 기록 저장·열람</li><li>Deep / Interpret 모델 해금</li></ul><button class="btn-price primary" id="btnCheckout">구독 시작 →</button></div></div></div></div>
<div id="modelMenu"><div class="mm-opt" data-model="Core" data-color="#000" data-tier="free"><span class="md" style="background:#000"></span>Aletheia Core</div><div class="mm-opt" data-model="Deep" data-color="#444" data-tier="seeker"><span class="md" style="background:#444"></span>Aletheia Deep<span class="mm-lock">PRO</span></div><div class="mm-opt" data-model="Interpret" data-color="#666" data-tier="seeker"><span class="md" style="background:#666"></span>Interpret v1<span class="mm-lock">PRO</span></div></div>

<script>
(function(){
'use strict';
var LOGO='<svg viewBox="0 0 24 24"><path d="M 5 19 A 10 10 0 1 1 19 19" stroke-linecap="round"/><circle cx="12" cy="12" r="2" fill="currentColor" stroke="none"/></svg>';
var USVG='<svg viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M6 21v-1a6 6 0 0 1 12 0v1"/></svg>';
var dot=document.querySelector('.cursor-dot'),ring=document.querySelector('.cursor-ring');
document.addEventListener('mousemove',function(e){dot.style.left=e.clientX+'px';dot.style.top=e.clientY+'px';ring.style.left=e.clientX+'px';ring.style.top=e.clientY+'px'});
document.addEventListener('mousedown',function(){document.body.classList.add('clicking')});
document.addEventListener('mouseup',function(){document.body.classList.remove('clicking')});
document.querySelectorAll('button,a,input,textarea,.map-node,.logo,.method-row,.cb-chip,.m-btn,.cb-bar').forEach(function(el){el.addEventListener('mouseenter',function(){document.body.classList.add('hovered')});el.addEventListener('mouseleave',function(){document.body.classList.remove('hovered')})});

/* AUTH */
var MOCK={name:'이민수',email:'minsu@aletheia.kr',plan:'free',avatar:'M'};
var authUser=null,currentModel='Core',pendingPage=null;
var MODEL_NAMES={Core:'Aletheia Core',Deep:'Aletheia Deep',Interpret:'Interpret v1'};

/* ============ THEME TOGGLE ============ */
var isDark=false;
document.body.classList.remove('dark-mode');
localStorage.setItem('aletheia-theme','light');
document.getElementById('btnTheme').addEventListener('click',function(){
  document.body.classList.toggle('dark-mode');
  isDark=document.body.classList.contains('dark-mode');
  localStorage.setItem('aletheia-theme',isDark?'dark':'light');
  if(window._alScene){window._alScene._c1Mat.color.setHex(isDark?0xffffff:0x000000);window._alScene._c2Mat.color.setHex(isDark?0xaaaaaa:0x555555)}
});

/* ============ i18n ============ */
var currentLang=localStorage.getItem('aletheia-lang')||'ko';
var I18N={
  ko:{
    signIn:'Sign in',myPage:'My Page',signOut:'Sign out',
    heroTyping:'당신의 이야기가 가장 강력한 물성이 될 때.',
    aboutLabel1:'Our Core',aboutLabel2:'The Method',
    phiText:'"당신의 이야기에서 본질을 추출합니다."',
    phiDesc:'우리는 외부의 트렌드를 따라가지 않습니다. 당신 내면의 경험과 가치를 추출하여, 세상에 단 하나뿐인 이야기로 만듭니다. 대화할수록 데이터가 쌓이고, 그 데이터가 당신의 본질이 됩니다.',
    m1Desc:'<strong>Unmask</strong><br>대화를 통해 당신의 패턴, 가치관, 잠재 동기를 추출하고 하나의 프로필로 합성합니다.',
    m2Desc:'<strong>Interpret</strong><br>산업의 본질과 당신의 본질이 만나는 교차점을 찾습니다.',
    m3Desc:'<strong>Interpret</strong><br>산업의 본질과 당신의 본질이 만나는 교차점을 찾습니다.',
    m1Btn:'Start Dialogue →',m2Btn:'View Profile →',m3Btn:'Start Interpret →',
    unmaskTitle:'당신을 발견하세요.',unmaskDesc:'대화를 시작하면 당신의 윤곽이 드러납니다.<br>가치관, 패턴, 회피하는 것 — 모든 것이 여기에 쌓입니다.',
    unmaskTitle:'당신보다<br>당신을 잘 아는 지도.',unmaskDesc:'Core에서 추출된 데이터 — 가치관, 패턴, 회피하는 것.<br>이 모든 것이 하나의 프로필로 합성됩니다.',unmaskBtn:'Core에서 대화 시작하기',
    interpTitle:'분야의 본질을 해석합니다.',interpDesc:'브랜드, 산업, 외부 대상의 숨겨진 본질을 드러냅니다.',interpPh:'분야 또는 브랜드를 입력하세요',interpGo:'해석 시작',
    archTitle:'실증의 기록.',archSub:'Aletheia가 해석한 다양한 분야의 본질 아카이브.',
    welcomeT:'무엇이 당신을 이끄나요?',welcomeS:'당신의 이야기에서 본질을 추출합니다.',
    chatPh:'대화를 시작하세요...',
    chip1:'카페 창업',chip2:'자기 탐구',chip3:'브랜드 방향',
    chipQ1:'나는 카페를 하고 싶어',chipQ2:'내가 진짜 좋아하는게 뭔지 모르겠어',chipQ3:'브랜드를 만들고 싶은데 방향을 모르겠어',
    histTitle:'이전 대화',bmTitle:'저장된 메시지',galTitle:'갤러리',profTitle:'실시간 프로필',
    profSub:'대화를 통해 실시간으로 추출되는 당신의 프로필입니다.',
    profVal:'핵심 가치관',profAvoid:'회피 패턴',profMotiv:'잠재 동기',profPrompt:'현재 시스템 프롬프트',
    profEmpty:'대화가 더 필요합니다...',
    myTitle:'나의 여정.',
    pricingTitle:'당신의 본질에 투자하세요.',pricingSub:'Aletheia의 서비스를 선택하세요.',
    loginTitle:'Aletheia에 오신 것을 환영합니다',loginSub:'본질을 탐구하는 여정을 시작하세요.',
    loginGoogle:'Google로 계속하기',loginTerms:'로그인 시 <a href="#">이용약관</a> 및 <a href="#">개인정보처리방침</a>에 동의합니다.',
    explorerName:'Explorer',seekerName:'Seeker',
    explorerPrice:'₩0',explorerUnit:'/ 영구',explorerDesc:'Aletheia의 철학을 경험하세요.',
    seekerPrice:'₩29,000',seekerUnit:'/ 월',seekerDesc:'본질을 깊이 탐구하는 풀 서비스.',
    priceFeat1:'Unmask 기본 대화 (일 10세션)',priceFeat2:'Unmask 실시간 프로필',priceFeat3:'Archive 열람',
    priceFeat4:'Unmask 무제한 대화',priceFeat5:'Unmask 심층 분석',priceFeat6:'Interpret 분야 해석',priceFeat7:'채팅 기록 저장·열람',priceFeat8:'Deep / Interpret 모델 해금',
    currentPlan:'현재 플랜',startSub:'구독 시작 →',upgrade:'구독 시작하기',
    newChat:'새 대화',bookmark:'북마크',gallery:'갤러리',profile:'Unmask',history:'이전 대화',
    footer:'Less but Better',
    hlSub1:'본질을 대화로 꺼내는 AI 서비스',
    hlSub2:'물성(物性) : 겉치레를 벗겨낸 당신 그 자체. 그것이 가장 강한 이야기입니다.',
    howItWorks:'How It Works',
    demoTitle1:'대화가 깊어질수록<br>윤곽이 드러납니다.',
    demoDesc1:'Aletheia는 답을 주지 않습니다.<br>가려져 있던 것의 가림막을 벗깁니다.',
    demoTitle2:'태그가 아니라 서사.<br>진단이 아니라 발견.',
    demoDesc2:'대화가 쌓일수록 당신만의 Essence가 형성됩니다.<br>확정이 아니라 현재 버전의 스냅샷.',
    demoTitle3:'자기를 아는 사람은<br>AI를 도구로 쓴다.',
    demoDesc3:'Aletheia는 AI 과의존을 만들지 않습니다.<br>자기 기준이 있는 사람을 만드는 것이 목표입니다.',
    dChat1a:'요즘 어떤 생각에 빠져 있어요?',
    dChat1u:'카페를 열고 싶은데... 뭔가 확신이 없어요.',
    dChat2a:'카페라는 형태를 걷어내면, 진짜 하고 싶은 건 뭘까요?',
    dChat2u:'...공간? 내 이야기가 담긴 공간을 만들고 싶은 것 같아요.',
    dChat3a:"'공간'이라는 단어를 두 번 썼어요. 거기에 뭔가 있는 것 같아요.",
    dpTag1:'공간감각',dpTag2:'독립지향',dpTag3:'경험기반',dpTag4:'자기탐색',dpTag5:'본질추구',
    dpLabel1:'핵심 가치',dpLabel2:'에너지 지도',dpLabel3:'서사',
    dpValue:'표면을 뚫고 구조를 보려는 사람',
    dpEnergyH:'↑ 자기 철학을 만들 때',dpEnergyL:'↓ 남의 기준에 맞출 때',
    dpNarr:'가짜를 참지 못하는 사람이 진짜를 찾아 헤매다, 자기만의 도구를 만들기 시작했다.',
    mfLine1:"알고리즘이 추천하는 '나'",mfLine2:"트렌드가 만드는 '나'",mfLine3:"데이터가 예측하는 '나'",mfLine4:"진짜 '나'"
  },
  en:{
    signIn:'Sign in',myPage:'My Page',signOut:'Sign out',
    heroTyping:'When your story becomes the most powerful material.',
    aboutLabel1:'Our Core',aboutLabel2:'The Method',
    phiText:'"We extract the essence from your story and transform it into material."',
    phiDesc:"We don't borrow trending ideas from the outside. We extract the primal experiences and qualities from within you, and transform them into the unique material of your business. The more you talk, the more data accumulates — and that data becomes your essence.",
    m1Desc:'<strong>Unmask</strong><br>Extracts your patterns, values, and latent motivations through dialogue, synthesized into one profile.',
    m2Desc:"<strong>Interpret</strong><br>Finds the intersection of an industry's essence and your own.",
    m3Desc:'<strong>Interpret</strong><br>Finds the intersection where industry essence meets your essence.',
    m1Btn:'Start Dialogue →',m2Btn:'View Profile →',m3Btn:'Start Interpret →',
    unmaskTitle:'Discover yourself.',unmaskDesc:'Start a conversation and your contours will emerge.<br>Values, patterns, avoidance — everything accumulates here.',
    unmaskTitle:'A map that knows you<br>better than you.',unmaskDesc:'Data extracted from Core — values, patterns, avoidance.<br>All synthesized into a single profile.',unmaskBtn:'Start dialogue in Core',
    interpTitle:'Interpreting the essence of fields.',interpDesc:'Revealing the hidden essence of brands, industries, and external subjects.',interpPh:'Enter a field or brand',interpGo:'Start Interpret',
    archTitle:'Record of Proof.',archSub:'An archive of essences interpreted by Aletheia across various fields.',
    welcomeT:'What drives you?',welcomeS:'We extract the essence from your story.',
    chatPh:'Start a conversation...',
    chip1:'Café startup',chip2:'Self-discovery',chip3:'Brand direction',
    chipQ1:'I want to open a café',chipQ2:"I don't know what I truly like",chipQ3:"I want to build a brand but don't know the direction",
    histTitle:'Previous chats',bmTitle:'Saved messages',galTitle:'Gallery',profTitle:'Live profile',
    profSub:'Your profile, extracted in real-time through conversation.',
    profVal:'Core values',profAvoid:'Avoidance patterns',profMotiv:'Latent motivations',profPrompt:'Current system prompt',
    profEmpty:'Start a conversation to begin extraction...',
    myTitle:'My journey.',
    pricingTitle:'Invest in your essence.',pricingSub:'Choose your Aletheia plan.',
    loginTitle:'Welcome to Aletheia',loginSub:'Begin your journey of essence discovery.',
    loginGoogle:'Continue with Google',loginTerms:'By signing in, you agree to our <a href="#">Terms</a> and <a href="#">Privacy Policy</a>.',
    explorerName:'Explorer',seekerName:'Seeker',
    explorerPrice:'$0',explorerUnit:'/ forever',explorerDesc:'Experience the philosophy of Aletheia.',
    seekerPrice:'$29',seekerUnit:'/ month',seekerDesc:'Full service for deep essence exploration.',
    priceFeat1:'Core basic dialogue (10/day)',priceFeat2:'Unmask basic profile',priceFeat3:'Archive access',
    priceFeat4:'Core unlimited dialogue',priceFeat5:'Unmask deep profile',priceFeat6:'Interpret field analysis',priceFeat7:'Chat history save & view',priceFeat8:'Deep / Interpret model unlock',
    currentPlan:'Current plan',startSub:'Start subscription →',upgrade:'Start subscription',
    newChat:'New chat',bookmark:'Bookmark',gallery:'Gallery',profile:'Unmask',history:'Previous chats',
    footer:'Less but Better',
    hlSub1:'AI service that extracts essence through dialogue',
    hlSub2:'Materiality : Your authentic self, stripped of pretense. That is the strongest story.',
    howItWorks:'How It Works',
    demoTitle1:'The deeper the conversation,<br>the clearer you become.',
    demoDesc1:"Aletheia doesn't give you answers.<br>It removes what was concealing them.",
    demoTitle2:'Not tags, but narrative.<br>Not diagnosis, but discovery.',
    demoDesc2:'As conversations accumulate, your unique Essence forms.<br>Not a verdict — a snapshot of the current version.',
    demoTitle3:'Those who know themselves<br>use AI as a tool.',
    demoDesc3:"Aletheia doesn't create AI dependency.<br>The goal is to build people with their own standards.",
    dChat1a:'What thoughts have been occupying your mind lately?',
    dChat1u:"I want to open a café... but I'm not sure about it.",
    dChat2a:'If you strip away the form of a café, what do you really want?',
    dChat2u:'...A space? I think I want to create a space that holds my story.',
    dChat3a:"You used the word 'space' twice. There might be something there.",
    dpTag1:'Spatial sense',dpTag2:'Independence',dpTag3:'Experience-driven',dpTag4:'Self-exploration',dpTag5:'Essence-seeking',
    dpLabel1:'Core value',dpLabel2:'Energy map',dpLabel3:'Narrative',
    dpValue:'Someone who pierces the surface to see the structure',
    dpEnergyH:'↑ When building own philosophy',dpEnergyL:"↓ When conforming to others' standards",
    dpNarr:"A person who couldn't tolerate the fake wandered seeking the real, then began building their own tools.",
    mfLine1:"The 'me' algorithms recommend",mfLine2:"The 'me' trends create",mfLine3:"The 'me' data predicts",mfLine4:"The real 'me'"
  },
  es:{
    signIn:'Iniciar sesión',myPage:'Mi Página',signOut:'Cerrar sesión',
    heroTyping:'Cuando tu historia se convierte en la materia más poderosa.',
    aboutLabel1:'Nuestro Núcleo',aboutLabel2:'El Método',
    phiText:'"Extraemos la esencia de tu historia y la transformamos en materia."',
    phiDesc:'No tomamos ideas de moda del exterior. Extraemos las experiencias y cualidades primordiales de tu interior, y las transformamos en la materia única de tu negocio. Cuanto más hablas, más datos se acumulan — y esos datos se convierten en tu esencia.',
    m1Desc:'<strong>Unmask</strong><br>Extrae tus patrones, valores y motivaciones latentes a través del diálogo, sintetizados en un perfil.',
    m2Desc:'<strong>Interpret</strong><br>Encuentra la intersección entre la esencia de una industria y la tuya.',
    m3Desc:'<strong>Interpret</strong><br>Encuentra la intersección donde la esencia de la industria se encuentra con tu esencia.',
    m1Btn:'Iniciar Diálogo →',m2Btn:'Ver Perfil →',m3Btn:'Iniciar Interpret →',
    unmaskTitle:'Descúbrete.',unmaskDesc:'Inicia una conversación y tus contornos emergerán.<br>Valores, patrones, evasión — todo se acumula aquí.',
    unmaskTitle:'Un mapa que te conoce<br>mejor que tú.',unmaskDesc:'Datos extraídos de Core — valores, patrones, evasión.<br>Todo sintetizado en un solo perfil.',unmaskBtn:'Iniciar diálogo en Core',
    interpTitle:'Interpretando la esencia de los campos.',interpDesc:'Revelando la esencia oculta de marcas, industrias y sujetos externos.',interpPh:'Ingresa un campo o marca',interpGo:'Iniciar Interpret',
    archTitle:'Registro de Prueba.',archSub:'Un archivo de esencias interpretadas por Aletheia en diversos campos.',
    welcomeT:'¿Qué te impulsa?',welcomeS:'Extraemos la esencia de tu historia.',
    chatPh:'Inicia una conversación...',
    chip1:'Abrir cafetería',chip2:'Autodescubrimiento',chip3:'Dirección de marca',
    chipQ1:'Quiero abrir una cafetería',chipQ2:'No sé qué me gusta realmente',chipQ3:'Quiero crear una marca pero no sé la dirección',
    histTitle:'Chats anteriores',bmTitle:'Mensajes guardados',galTitle:'Galería',profTitle:'Perfil en vivo',
    profSub:'Tu perfil, extraído en tiempo real a través de la conversación.',
    profVal:'Valores fundamentales',profAvoid:'Patrones de evasión',profMotiv:'Motivaciones latentes',profPrompt:'Prompt del sistema actual',
    profEmpty:'Inicia una conversación para comenzar la extracción...',
    myTitle:'Mi viaje.',
    pricingTitle:'Invierte en tu esencia.',pricingSub:'Elige tu plan de Aletheia.',
    loginTitle:'Bienvenido a Aletheia',loginSub:'Comienza tu viaje de descubrimiento esencial.',
    loginGoogle:'Continuar con Google',loginTerms:'Al iniciar sesión, aceptas nuestros <a href="#">Términos</a> y <a href="#">Política de Privacidad</a>.',
    explorerName:'Explorer',seekerName:'Seeker',
    explorerPrice:'$0',explorerUnit:'/ siempre',explorerDesc:'Experimenta la filosofía de Aletheia.',
    seekerPrice:'$29',seekerUnit:'/ mes',seekerDesc:'Servicio completo para exploración profunda de esencia.',
    priceFeat1:'Diálogo básico Core (10/día)',priceFeat2:'Perfil básico Unmask',priceFeat3:'Acceso al Archivo',
    priceFeat4:'Diálogo ilimitado Core',priceFeat5:'Perfil profundo Unmask',priceFeat6:'Análisis de campo Interpret',priceFeat7:'Guardar y ver historial de chat',priceFeat8:'Desbloquear modelos Deep / Interpret',
    currentPlan:'Plan actual',startSub:'Iniciar suscripción →',upgrade:'Iniciar suscripción',
    newChat:'Nuevo chat',bookmark:'Marcador',gallery:'Galería',profile:'Unmask',history:'Chats anteriores',
    footer:'Less but Better',
    hlSub1:'Servicio de IA que extrae la esencia a través del diálogo',
    hlSub2:'Materialidad : Tu auténtico yo, sin pretensiones. Esa es la historia más poderosa.',
    howItWorks:'Cómo Funciona',
    demoTitle1:'Cuanto más profunda la conversación,<br>más claro te vuelves.',
    demoDesc1:'Aletheia no te da respuestas.<br>Retira lo que las ocultaba.',
    demoTitle2:'No etiquetas, sino narrativa.<br>No diagnóstico, sino descubrimiento.',
    demoDesc2:'A medida que las conversaciones se acumulan, tu Esencia única se forma.<br>No es un veredicto — es una instantánea de la versión actual.',
    demoTitle3:'Quienes se conocen a sí mismos<br>usan la IA como herramienta.',
    demoDesc3:'Aletheia no crea dependencia de la IA.<br>El objetivo es construir personas con sus propios estándares.',
    dChat1a:'¿Qué pensamientos te han ocupado últimamente?',
    dChat1u:'Quiero abrir una cafetería... pero no estoy seguro.',
    dChat2a:'Si quitas la forma de cafetería, ¿qué es lo que realmente quieres?',
    dChat2u:'...¿Un espacio? Creo que quiero crear un espacio que contenga mi historia.',
    dChat3a:"Usaste la palabra 'espacio' dos veces. Puede que haya algo ahí.",
    dpTag1:'Sentido espacial',dpTag2:'Independencia',dpTag3:'Experiencial',dpTag4:'Autoexploración',dpTag5:'Busca-esencia',
    dpLabel1:'Valor central',dpLabel2:'Mapa de energía',dpLabel3:'Narrativa',
    dpValue:'Alguien que perfora la superficie para ver la estructura',
    dpEnergyH:'↑ Al construir filosofía propia',dpEnergyL:'↓ Al conformarse con estándares ajenos',
    dpNarr:'Una persona que no toleraba lo falso vagó buscando lo real, y luego comenzó a construir sus propias herramientas.',
    mfLine1:"El 'yo' que recomiendan los algoritmos",mfLine2:"El 'yo' que crean las tendencias",mfLine3:"El 'yo' que predicen los datos",mfLine4:"El verdadero 'yo'"
  }
};

function t(key){return (I18N[currentLang]&&I18N[currentLang][key])||I18N['ko'][key]||key}
function applyLang(){
  /* Nav */
  document.querySelector('#btnSignIn span').textContent=t('signIn');
  document.getElementById('btnMyPage').textContent=t('myPage');
  document.getElementById('btnSignOut').textContent=t('signOut');
  /* Hero */
  document.querySelector('.phi-text').innerHTML=t('phiText');
  document.querySelector('.phi-desc').textContent=t('phiDesc');
  /* Method */
  var mDescs=document.querySelectorAll('.m-desc');
  if(mDescs[0])mDescs[0].innerHTML=t('m1Desc');
  if(mDescs[1])mDescs[1].innerHTML=t('m2Desc');
  var mBtns=document.querySelectorAll('.m-btn');
  if(mBtns[0])mBtns[0].textContent=t('m1Btn');
  if(mBtns[1])mBtns[1].textContent=t('m2Btn');
  if(mBtns[2])mBtns[2].textContent=t('m3Btn');
  /* Service pages */
  var umT=document.querySelector('#page-unmask .svc-intro-title');if(umT)umT.innerHTML=t('unmaskTitle');
  var umD=document.querySelector('#page-unmask .svc-intro-desc');if(umD)umD.innerHTML=t('unmaskDesc');
  /* unmask merged into core */
  var inT=document.querySelector('#page-interpret .svc-intro-title');if(inT)inT.innerHTML=t('interpTitle');
  var inD=document.querySelector('#page-interpret .svc-intro-desc');if(inD)inD.innerHTML=t('interpDesc');
  var inPh=document.getElementById('interpretInput');if(inPh)inPh.placeholder=t('interpPh');
  var inGo=document.getElementById('interpretGo');if(inGo&&!inGo.disabled)inGo.textContent=t('interpGo');
  /* Archive */
  var archT=document.querySelector('.archive-map-title');if(archT)archT.textContent=t('archTitle');
  var archS=document.querySelector('.archive-map-sub');if(archS)archS.textContent=t('archSub');
  /* Chat */
  var wT=document.querySelector('.cb-welcome-t');if(wT)wT.textContent=t('welcomeT');
  var wS=document.querySelector('.cb-welcome-s');if(wS)wS.textContent=t('welcomeS');
  var cbTa=document.getElementById('cbTa');if(cbTa)cbTa.placeholder=t('chatPh');
  var barPh=document.querySelector('.cb-ph');if(barPh){var caret=barPh.querySelector('.cb-caret');barPh.textContent='';if(caret)barPh.appendChild(caret);barPh.appendChild(document.createTextNode(t('chatPh')))}
  var chips=document.querySelectorAll('.cb-chip');
  if(chips[0]){chips[0].textContent=t('chip1');chips[0].setAttribute('data-q',t('chipQ1'))}
  if(chips[1]){chips[1].textContent=t('chip2');chips[1].setAttribute('data-q',t('chipQ2'))}
  if(chips[2]){chips[2].textContent=t('chip3');chips[2].setAttribute('data-q',t('chipQ3'))}
  /* Panels */
  var panels=document.querySelectorAll('.cbp-title');
  if(panels[0])panels[0].textContent=t('histTitle');
  if(panels[1])panels[1].textContent=t('bmTitle');
  if(panels[2])panels[2].textContent=t('galTitle');
  if(panels[3])panels[3].textContent=t('profTitle');
  var profSub=document.querySelector('.cbp-profile-sub');if(profSub)profSub.textContent=t('profSub');
  var secTitles=document.querySelectorAll('.cbp-section-title');
  if(secTitles[0])secTitles[0].textContent=t('profVal');
  if(secTitles[1])secTitles[1].textContent=t('profAvoid');
  if(secTitles[2])secTitles[2].textContent=t('profMotiv');
  if(secTitles[3])secTitles[3].textContent=t('profPrompt');
  /* Tooltips */
  document.getElementById('cbNewChat').title=t('newChat');
  document.getElementById('cbBookmarkList').title=t('bookmark');
  document.getElementById('cbGalleryBtn').title=t('gallery');
  document.getElementById('cbProfileBtn').title=t('profile');
  document.getElementById('cbHistoryBtn').title=t('history');
  /* My Page */
  var myT=document.querySelector('.mypage-title');if(myT)myT.textContent=t('myTitle');
  var upBtn=document.getElementById('btnUpgrade');if(upBtn)upBtn.textContent=t('upgrade');
  /* Login */
  var loginT=document.querySelector('.login-title');if(loginT)loginT.textContent=t('loginTitle');
  var loginS=document.querySelector('.login-sub');if(loginS)loginS.textContent=t('loginSub');
  var gBtn=document.getElementById('btnGoogle');if(gBtn){var svg=gBtn.querySelector('svg');gBtn.textContent='';if(svg)gBtn.appendChild(svg);gBtn.appendChild(document.createTextNode(t('loginGoogle')))}
  var loginTe=document.querySelector('.login-terms');if(loginTe)loginTe.innerHTML=t('loginTerms');
  /* Pricing */
  var prT=document.querySelector('.pricing-title');if(prT)prT.textContent=t('pricingTitle');
  var prS=document.querySelector('.pricing-sub');if(prS)prS.textContent=t('pricingSub');
  var pcNames=document.querySelectorAll('.pc-name');
  if(pcNames[0])pcNames[0].textContent=t('explorerName');
  if(pcNames[1])pcNames[1].textContent=t('seekerName');
  var pcPrices=document.querySelectorAll('.pc-price');
  if(pcPrices[0])pcPrices[0].innerHTML=t('explorerPrice')+' <span>'+t('explorerUnit')+'</span>';
  if(pcPrices[1])pcPrices[1].innerHTML=t('seekerPrice')+' <span>'+t('seekerUnit')+'</span>';
  var pcDescs=document.querySelectorAll('.pc-desc');
  if(pcDescs[0])pcDescs[0].textContent=t('explorerDesc');
  if(pcDescs[1])pcDescs[1].textContent=t('seekerDesc');
  /* Footer */
  var footerR=document.querySelector('footer div:last-child');if(footerR)footerR.textContent=t('footer');
  /* Typing labels */
  var labels=document.querySelectorAll('.typing-target');
  if(labels[0])labels[0].setAttribute('data-text',t('aboutLabel1'));
  if(labels[2])labels[2].setAttribute('data-text',t('aboutLabel2'));
  /* Hero replay */
  if(window._heroReplay)window._heroReplay(t('heroTyping'));
  /* Pricing features */
  var pcFeats=document.querySelectorAll('.pc-features');
  if(pcFeats[0]){var lis0=pcFeats[0].querySelectorAll('li');if(lis0[0])lis0[0].textContent=t('priceFeat1');if(lis0[1])lis0[1].textContent=t('priceFeat2');if(lis0[2])lis0[2].textContent=t('priceFeat3')}
  if(pcFeats[1]){var lis1=pcFeats[1].querySelectorAll('li');if(lis1[0])lis1[0].textContent=t('priceFeat4');if(lis1[1])lis1[1].textContent=t('priceFeat5');if(lis1[2])lis1[2].textContent=t('priceFeat6');if(lis1[3])lis1[3].textContent=t('priceFeat7');if(lis1[4])lis1[4].textContent=t('priceFeat8')}
  var btnCur=pcFeats[0]?pcFeats[0].parentElement.querySelector('.btn-price'):null;if(btnCur)btnCur.textContent=t('currentPlan');
  var btnSub=pcFeats[1]?pcFeats[1].parentElement.querySelector('.btn-price'):null;if(btnSub)btnSub.textContent=t('startSub');
  /* Hero subtitle */
  var hsl1=document.querySelector('.hl-sub-line1');if(hsl1)hsl1.textContent=t('hlSub1');
  var hsl2=document.querySelector('.hl-sub-line2');if(hsl2)hsl2.textContent=t('hlSub2');
  /* How It Works label */
  if(labels[1])labels[1].setAttribute('data-text',t('howItWorks'));
  /* Demo sections */
  var dTitles=document.querySelectorAll('.demo-title');
  var dDescs=document.querySelectorAll('.demo-desc');
  if(dTitles[0])dTitles[0].innerHTML=t('demoTitle1');
  if(dDescs[0])dDescs[0].innerHTML=t('demoDesc1');
  if(dTitles[1])dTitles[1].innerHTML=t('demoTitle2');
  if(dDescs[1])dDescs[1].innerHTML=t('demoDesc2');
  if(dTitles[2])dTitles[2].innerHTML=t('demoTitle3');
  if(dDescs[2])dDescs[2].innerHTML=t('demoDesc3');
  /* Demo chat messages */
  var dcmMsgs=document.querySelectorAll('#demo-chat-1 .dcm-bubble');
  if(dcmMsgs[0])dcmMsgs[0].textContent=t('dChat1a');
  if(dcmMsgs[1])dcmMsgs[1].textContent=t('dChat1u');
  if(dcmMsgs[2])dcmMsgs[2].textContent=t('dChat2a');
  if(dcmMsgs[3])dcmMsgs[3].textContent=t('dChat2u');
  if(dcmMsgs[4])dcmMsgs[4].textContent=t('dChat3a');
  /* Demo profile tags */
  var dpTags=document.querySelectorAll('#demo-tags .dpm-tag');
  if(dpTags[0])dpTags[0].textContent=t('dpTag1');
  if(dpTags[1])dpTags[1].textContent=t('dpTag2');
  if(dpTags[2])dpTags[2].textContent=t('dpTag3');
  if(dpTags[3])dpTags[3].textContent=t('dpTag4');
  if(dpTags[4])dpTags[4].textContent=t('dpTag5');
  /* Demo profile labels + values */
  var dpLabels=document.querySelectorAll('.dpm-label');
  if(dpLabels[0])dpLabels[0].textContent=t('dpLabel1');
  if(dpLabels[1])dpLabels[1].textContent=t('dpLabel2');
  if(dpLabels[2])dpLabels[2].textContent=t('dpLabel3');
  var dpVal=document.getElementById('demo-value');if(dpVal)dpVal.textContent=t('dpValue');
  var dpNarr=document.getElementById('demo-narrative');if(dpNarr)dpNarr.textContent=t('dpNarr');
  var dpEH=document.querySelector('.dpm-energy-high');if(dpEH)dpEH.textContent=t('dpEnergyH');
  var dpEL=document.querySelector('.dpm-energy-low');if(dpEL)dpEL.textContent=t('dpEnergyL');
  /* Manifesto */
  var mfLines=document.querySelectorAll('.dm-line');
  if(mfLines[0])mfLines[0].textContent=t('mfLine1');
  if(mfLines[1])mfLines[1].textContent=t('mfLine2');
  if(mfLines[2])mfLines[2].textContent=t('mfLine3');
  if(mfLines[3])mfLines[3].textContent=t('mfLine4');
}

/* Language selector */
var LANG_LABELS={ko:'KO',en:'EN',es:'ES'};
document.getElementById('langBtn').addEventListener('click',function(e){e.stopPropagation();document.getElementById('langDropdown').classList.toggle('show')});
document.querySelectorAll('.lang-opt').forEach(function(opt){
  opt.addEventListener('click',function(e){
    e.stopPropagation();
    currentLang=this.getAttribute('data-lang');
    localStorage.setItem('aletheia-lang',currentLang);
    document.getElementById('langCurrent').textContent=LANG_LABELS[currentLang];
    document.querySelectorAll('.lang-opt').forEach(function(o){o.classList.toggle('active',o.getAttribute('data-lang')===currentLang)});
    document.getElementById('langDropdown').classList.remove('show');
    applyLang();
  });
});
document.addEventListener('click',function(e){if(!e.target.closest('.lang-sel'))document.getElementById('langDropdown').classList.remove('show')});
/* Init lang */
document.getElementById('langCurrent').textContent=LANG_LABELS[currentLang];
document.querySelectorAll('.lang-opt').forEach(function(o){o.classList.toggle('active',o.getAttribute('data-lang')===currentLang)});
if(currentLang!=='ko')applyLang();
function mockSignIn(){authUser=MOCK;updateAuthUI();closeModal('loginOverlay');switchPage(pendingPage||'unmask');pendingPage=null}
function mockSignOut(){authUser=null;currentModel='Core';updateAuthUI();closeProfileDropdown();switchPage('about')}
function updateAuthUI(){var btn=document.getElementById('btnSignIn'),prof=document.getElementById('navProfile');if(authUser){btn.style.display='none';prof.classList.add('show');document.getElementById('navName').textContent=authUser.name;document.getElementById('mpName').textContent=authUser.name;document.getElementById('mpEmail').textContent=authUser.email;var badge=document.getElementById('mpBadge');if(authUser.plan==='seeker'){badge.textContent='SEEKER';badge.classList.add('pro')}else{badge.textContent='FREE';badge.classList.remove('pro')}}else{btn.style.display='flex';prof.classList.remove('show')}}

/* PAGES */
var loginRequired=['mypage']; /* login only on mypage entry; unmask/interpret gate on action */
function switchPage(page){
  if(loginRequired.indexOf(page)!==-1&&!authUser){pendingPage=page;openModal('loginOverlay');return}
  document.querySelectorAll('.page').forEach(function(p){p.classList.remove('active')});
  var el=document.getElementById('page-'+page);if(!el)return;el.classList.add('active');
  document.querySelectorAll('.nav-center li').forEach(function(l){l.classList.toggle('active',l.getAttribute('data-page')===page)});
  document.getElementById('coreWrap').style.display=(page==='unmask')?'flex':'none';
  if(page!=='unmask'){collapseChat()}
  if(page==='about'||page==='archive'){document.body.style.overflow='auto';el.style.overflow='auto'}else{document.body.style.overflow='hidden'}
  if(page==='unmask'){
    if(window._alScene)window._alScene.unmaskMode=true;
  }else{
    if(window._alScene)window._alScene.unmaskMode=false;
  }
  /* 등장 모션 */
  el.querySelectorAll('.svc-anim').forEach(function(a){a.classList.remove('visible')});
  setTimeout(function(){
    el.querySelectorAll('.svc-anim').forEach(function(a){
      var delay=parseInt(a.getAttribute('data-delay'))||0;
      setTimeout(function(){a.classList.add('visible')},delay);
    });
  },50);
}
window.goPage=function(p){switchPage(p)};
function openModal(id){document.getElementById(id).classList.add('show')}
function closeModal(id){document.getElementById(id).classList.remove('show')}
function closeProfileDropdown(){document.getElementById('profileDropdown').classList.remove('show')}

/* EVENTS */
document.querySelectorAll('.nav-center li').forEach(function(li){li.addEventListener('click',function(){switchPage(li.getAttribute('data-page'))})});
document.getElementById('logoBtn').addEventListener('click',function(){switchPage('about');var ap=document.getElementById('page-about');if(ap)ap.scrollTop=0;window.scrollTo(0,0);if(window._lenis)window._lenis.scrollTo(0,{immediate:true});});
document.getElementById('btnSignIn').addEventListener('click',function(){openModal('loginOverlay')});
document.getElementById('btnGoogle').addEventListener('click',mockSignIn);
document.getElementById('btnSignOut').addEventListener('click',mockSignOut);
document.getElementById('btnMyPage').addEventListener('click',function(){closeProfileDropdown();switchPage('mypage')});
document.getElementById('navProfileBtn').addEventListener('click',function(e){if(e.target.closest('.profile-dropdown'))return;document.getElementById('profileDropdown').classList.toggle('show')});
document.addEventListener('click',function(e){if(!e.target.closest('.nav-profile'))closeProfileDropdown()});
document.querySelectorAll('.modal-overlay').forEach(function(ov){ov.addEventListener('click',function(e){if(e.target===ov)closeModal(ov.id)})});
document.getElementById('pricingClose').addEventListener('click',function(){closeModal('pricingOverlay')});
document.getElementById('btnUpgrade').addEventListener('click',function(){openModal('pricingOverlay')});
document.getElementById('btnCheckout').addEventListener('click',function(){if(!authUser){closeModal('pricingOverlay');openModal('loginOverlay');return}authUser.plan='seeker';updateAuthUI();closeModal('pricingOverlay');alert('Seeker 구독이 시작되었습니다!')});
/* unmask button removed — merged into core */

/* INTERPRET MOCK */
var INTERPRET_DATA={
  '스페셜티 커피':{surface:'고급 원두, 산지 정보, 추출 방식의 다양성',essence:'감각적 경험의 큐레이션 — 미각을 통한 세계 인식',desire:'일상에서 특별한 순간을 소유하고 싶은 욕구',cross:'당신의 공간 감각과 장인 정신이 만나는 지점. 커피는 매개체이고, 진짜 팔리는 것은 "나만의 취향을 가진 사람"이라는 정체성.',insight:'스페셜티 커피 시장은 음료를 파는 것이 아니라 "감각적 자아"를 파는 시장입니다. 원두의 차이를 아는 것은 곧 "남들과 다른 나"를 증명하는 행위입니다.'},
  '패션':{surface:'트렌드, 소재, 실루엣, 시즌 컬렉션',essence:'외면을 통한 내면의 선언 — 입는 것은 곧 존재 방식의 표현',desire:'타인의 시선 속에서 자신의 이상적 자아를 확인받고 싶은 욕구',cross:'당신의 브랜드 감각과 독립 지향성이 교차하는 지점.',insight:'패션은 천을 파는 것이 아니라 "미래의 나"를 파는 시장입니다.'},
  '인테리어':{surface:'가구 배치, 색감, 조명, 동선 설계',essence:'삶의 철학을 공간에 물리적으로 구현하는 행위',desire:'자신만의 세계를 물리적으로 소유하고 통제하고 싶은 욕구',cross:'당신의 공간 감각과 완벽주의가 만나는 지점.',insight:'인테리어는 예쁜 집을 만드는 것이 아니라 "나는 이렇게 사는 사람이다"를 물리적으로 선언하는 행위입니다.'}
};
var INTERPRET_DEFAULT={surface:'분석 중...',essence:'분석 중...',desire:'분석 중...',cross:'분석 중...',insight:'분석 중...'};

var SYSTEM_INTERPRET_ANALYSIS='interpret_analysis';

document.getElementById('interpretGo').addEventListener('click',function(){
  if(!authUser){pendingPage='interpret';openModal('loginOverlay');return}
  var input=document.getElementById('interpretInput').value.trim();
  if(!input)return;
  var btn=document.getElementById('interpretGo');
  btn.textContent='분석 중...';btn.disabled=true;
  
  document.getElementById('irField').textContent=input;
  var result=document.getElementById('interpretResult');
  
  /* Show with loading state */
  var fallback=INTERPRET_DATA[input]||null;
  var loadingData=INTERPRET_DEFAULT;
  document.getElementById('irSurface').textContent=loadingData.surface;
  document.getElementById('irEssence').textContent=loadingData.essence;
  document.getElementById('irDesire').textContent=loadingData.desire;
  document.getElementById('irCross').textContent=loadingData.cross;
  document.getElementById('irInsight').textContent=loadingData.insight;
  result.style.display='block';result.style.animation='none';result.offsetHeight;result.style.animation='msgIn 0.6s ease';
  
  /* Build user context */
  var userContext='분석 대상: '+input+'\n';
  if(profileData.tags.length>0)userContext+='사용자 태그: '+profileData.tags.join(', ')+'\n';
  if(profileData.values&&profileData.values!=='대화가 더 필요합니다...')userContext+='사용자 가치관: '+profileData.values+'\n';
  if(profileData.motiv&&profileData.motiv!=='대화가 더 필요합니다...')userContext+='사용자 동기: '+profileData.motiv+'\n';
  if(profileData.patterns.length>0)userContext+='발견된 패턴: '+profileData.patterns.join('; ')+'\n';
  
  callClaude(SYSTEM_INTERPRET_ANALYSIS,[{role:'user',content:userContext}],800).then(function(resp){
    try{
      var clean=resp.replace(/```json|```/g,'').trim();
      var data=JSON.parse(clean);
      document.getElementById('irSurface').textContent=data.surface||'—';
      document.getElementById('irEssence').textContent=data.essence||'—';
      document.getElementById('irDesire').textContent=data.desire||'—';
      document.getElementById('irCross').textContent=data.cross||'—';
      document.getElementById('irInsight').textContent=data.insight||'—';
    }catch(e){
      console.log('Interpret parse error:',e);
      if(fallback){
        document.getElementById('irSurface').textContent=fallback.surface;
        document.getElementById('irEssence').textContent=fallback.essence;
        document.getElementById('irDesire').textContent=fallback.desire;
        document.getElementById('irCross').textContent=fallback.cross;
        document.getElementById('irInsight').textContent=fallback.insight;
      }
    }
    btn.textContent='해석 시작';btn.disabled=false;
  }).catch(function(err){
    console.log('Interpret API error:',err);
    if(fallback){
      document.getElementById('irSurface').textContent=fallback.surface;
      document.getElementById('irEssence').textContent=fallback.essence;
      document.getElementById('irDesire').textContent=fallback.desire;
      document.getElementById('irCross').textContent=fallback.cross;
      document.getElementById('irInsight').textContent=fallback.insight;
    }
    btn.textContent='해석 시작';btn.disabled=false;
  });
});
document.getElementById('interpretInput').addEventListener('keydown',function(e){if(e.key==='Enter')document.getElementById('interpretGo').click()});


/* CHATBOX – v4 expand pattern */
var box=document.getElementById('coreBox'),bar=document.getElementById('cbBar'),closeBtn=document.getElementById('cbClose');
function expandChat(){
  if(!authUser){pendingPage='unmask';openModal('loginOverlay');return}
  box.classList.add('expanded');
  setTimeout(function(){document.getElementById('cbTa').focus()},300);
}
function collapseChat(){
  box.classList.remove('expanded');
  closePanels();
}
bar.addEventListener('click',function(e){if(e.target.closest('.cb-model'))return;expandChat()});
closeBtn.addEventListener('click',collapseChat);
document.getElementById('coreWrap').style.display='none';

/* OVERLAY PANELS */
var historyPanel=document.getElementById('cbHistoryPanel');
var profilePanel=document.getElementById('cbProfilePanel');
var bookmarkPanel=document.getElementById('cbBookmarkPanel');
var galleryPanel=document.getElementById('cbGalleryPanel');
var historyBtn=document.getElementById('cbHistoryBtn');
var profileBtn=document.getElementById('cbProfileBtn');
var bookmarkListBtn=document.getElementById('cbBookmarkList');
var galleryBtn=document.getElementById('cbGalleryBtn');
var allPanels=[historyPanel,profilePanel,bookmarkPanel,galleryPanel];
var allPanelBtns=[historyBtn,profileBtn,bookmarkListBtn,galleryBtn];
function closePanels(){allPanels.forEach(function(p){p.classList.remove('show')});allPanelBtns.forEach(function(b){b.classList.remove('active')})}
function togglePanel(panel,btn,onOpen){
  var wasOpen=panel.classList.contains('show');closePanels();
  if(!wasOpen){panel.classList.add('show');btn.classList.add('active');if(onOpen)onOpen()}
}
historyBtn.addEventListener('click',function(e){e.stopPropagation();togglePanel(historyPanel,historyBtn,renderHistory)});
profileBtn.addEventListener('click',function(e){e.stopPropagation();togglePanel(profilePanel,profileBtn)});
bookmarkListBtn.addEventListener('click',function(e){e.stopPropagation();togglePanel(bookmarkPanel,bookmarkListBtn,renderBookmarks)});
galleryBtn.addEventListener('click',function(e){e.stopPropagation();togglePanel(galleryPanel,galleryBtn,renderGallery)});

/* NEW CHAT */
document.getElementById('cbNewChat').addEventListener('click',function(){
  // 현재 대화 저장
  saveCurrentSession();
  closePanels();chatStarted=false;msgCount=0;umMsgCount=0;umExtractCount=0;
  document.getElementById('cbMsgs').innerHTML='';
  /* Reset Unmask panel */
  document.getElementById('cbProfileTags').innerHTML='';
  document.getElementById('umDepthFill').style.width='0%';
  document.getElementById('umDepthCount').textContent='0회';
  document.getElementById('umBadge').classList.remove('show');
  document.getElementById('umBadge').textContent='0';
  document.getElementById('umStatusDot2').classList.remove('active');
  document.getElementById('umStatusText2').textContent='대기 중';
  document.getElementById('profileValues').textContent='대화가 더 필요합니다...';
  document.getElementById('profileAvoid').textContent='대화가 더 필요합니다...';
  document.getElementById('profileMotiv').textContent='대화가 더 필요합니다...';
  document.getElementById('umSecValues').className='cbp-section locked';
  document.getElementById('umSecAvoid').className='cbp-section locked';
  document.getElementById('umSecMotiv').className='cbp-section locked';
  /* Re-lock input */
  onboardingDone=false;
  onboardingData={purpose:'',detail:'',customInput:''};
  var inputArea=document.getElementById('cbInputArea');
  if(inputArea)inputArea.classList.add('locked');
  var ta2=document.getElementById('cbTa');
  if(ta2){ta2.disabled=true;ta2.placeholder='위에서 모드를 선택해주세요';}
  /* Restore full onboarding */
  var w=obCache.cloneNode(true);
  document.getElementById('cbMsgs').appendChild(w);
  bindOnboarding();
  welcome=w;currentSessionMsgs=[];
});

/* UNMASK RESULT PANEL BUTTON (replaces print) */
document.getElementById('cbPrintBtn').addEventListener('click',function(){
  if(window.openFounderPanel)window.openFounderPanel();
});

/* FILE ATTACH – GPT-style: preview first, send with message */
var pendingFile=null;
function showAttachPreview(file,dataUrl){
  removeAttachPreview();
  pendingFile={file:file,dataUrl:dataUrl||null};
  var preview=document.createElement('div');
  preview.className='cb-attach-preview';
  preview.id='cbAttachPreview';
  if(file.type.startsWith('image/')&&dataUrl){
    preview.innerHTML='<img class="cb-attach-preview-img" src="'+dataUrl+'" alt=""/><span class="cb-attach-preview-name">'+file.name+'</span><button class="cb-attach-preview-remove"><svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>';
  } else {
    preview.innerHTML='<div class="cb-attach-preview-icon"><svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg></div><span class="cb-attach-preview-name">'+file.name+'</span><button class="cb-attach-preview-remove"><svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>';
  }
  var inputArea=document.querySelector('.cb-input');
  inputArea.insertBefore(preview,inputArea.querySelector('.cb-input-row'));
  preview.querySelector('.cb-attach-preview-remove').addEventListener('click',removeAttachPreview);
  sendBtn.classList.add('ready');
}
function removeAttachPreview(){
  pendingFile=null;
  var el=document.getElementById('cbAttachPreview');if(el)el.remove();
  if(!ta.value.trim())sendBtn.classList.remove('ready');
}
document.getElementById('cbAttach').addEventListener('click',function(){
  var input=document.createElement('input');input.type='file';input.accept='image/*,.pdf,.doc,.docx,.txt,.csv,.xls,.xlsx';
  input.addEventListener('change',function(e){
    var file=e.target.files[0];if(!file)return;
    if(!box.classList.contains('expanded'))expandChat();
    closePanels();
    if(file.type.startsWith('image/')){
      var reader=new FileReader();
      reader.onload=function(ev){showAttachPreview(file,ev.target.result)};
      reader.readAsDataURL(file);
    } else {
      showAttachPreview(file,null);
    }
    ta.focus();
  });input.click();
});
var imageGallery=[];

/* GALLERY */
function renderGallery(){
  var grid=document.getElementById('cbGalleryGrid');
  if(!imageGallery.length){grid.innerHTML='<div class="cbp-gallery-empty">아직 이미지가 없습니다.<br>대화에서 이미지를 첨부해보세요.</div>';return}
  grid.innerHTML='';imageGallery.forEach(function(img){
    var item=document.createElement('div');item.className='cbp-gallery-item';
    item.innerHTML='<img src="'+img.src+'" alt="gallery"/>';
    item.addEventListener('click',function(){window.open(img.src,'_blank')});
    grid.appendChild(item);
  });
}

/* CHAT HISTORY – full session save/restore */
var chatHistory=[];
var currentSessionMsgs=[];
function saveCurrentSession(){
  if(!currentSessionMsgs.length)return;
  var preview=currentSessionMsgs.find(function(m){return m.role==='user'&&m.type==='text'});
  chatHistory.unshift({
    date:new Date().toLocaleString('ko-KR',{month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'}),
    preview:preview?preview.text:'(파일 첨부)',
    messages:currentSessionMsgs.slice()
  });
}
function renderHistory(){
  var list=document.getElementById('cbHistoryList');
  if(!chatHistory.length){list.innerHTML='<div class="cbh-empty">아직 대화 기록이 없습니다.<br>대화를 시작해보세요.</div>';return}
  list.innerHTML='';chatHistory.forEach(function(session,i){
    var item=document.createElement('div');item.className='cbh-item';
    item.innerHTML='<div class="cbh-item-date">'+session.date+'</div><div class="cbh-item-preview">'+session.preview+'</div>';
    item.addEventListener('click',function(){restoreSession(i)});
    list.appendChild(item);
  });
}
function restoreSession(idx){
  closePanels();
  var session=chatHistory[idx];if(!session)return;
  chatStarted=true;msgCount=session.messages.filter(function(m){return m.role==='user'}).length;
  msgs.innerHTML='';
  session.messages.forEach(function(m){
    if(m.type==='text'){addMsg(m.role,m.text)}
    else if(m.type==='image'){
      var d=document.createElement('div');d.className='msg msg-right';
      d.innerHTML='<div class="msg-body"><img class="msg-img" src="'+m.src+'" alt="img"/></div>';
      msgs.appendChild(d);
    } else if(m.type==='file'){
      var d=document.createElement('div');d.className='msg msg-right';
      d.innerHTML='<div class="msg-body"><div class="cb-file-preview"><div class="cb-file-preview-icon"><svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg></div><span class="cb-file-preview-name">'+m.name+'</span></div></div>';
      msgs.appendChild(d);
    }
  });
  currentSessionMsgs=session.messages.slice();
  msgs.scrollTop=msgs.scrollHeight;
}

/* BOOKMARKS */
var bookmarks=[];
function toggleBookmark(idx,text,role){
  var existing=bookmarks.findIndex(function(b){return b.idx===idx});
  if(existing!==-1){bookmarks.splice(existing,1);return false}
  bookmarks.push({idx:idx,text:text,role:role,date:new Date().toLocaleString('ko-KR',{month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'})});return true;
}
function renderBookmarks(){
  var list=document.getElementById('cbBookmarkListContent');
  if(!bookmarks.length){list.innerHTML='<div class="cbh-empty">북마크한 메시지가 없습니다.<br>메시지에 마우스를 올려 🔖를 클릭하세요.</div>';return}
  var html='';bookmarks.forEach(function(b){html+='<div class="cbh-item"><div class="cbh-item-date">'+b.date+' · '+(b.role==='ai'?'AI':'You')+'</div><div class="cbh-item-preview">'+b.text+'</div></div>'});
  list.innerHTML=html;
}

/* LIVE PROFILE */
var profileData={tags:[],essence:'',patterns:[],values:'대화가 더 필요합니다...',avoid:'대화가 더 필요합니다...',motiv:'대화가 더 필요합니다...',timeline:[]};

/* SYSTEM PROMPTS */
var SYSTEM_CORE='core';

var SYSTEM_INTERPRET='interpret';

var SYSTEM_META_EXTRACT='meta_extract';

var conversationHistory=[];window.conversationHistory=conversationHistory;
var unmaskRawData=[];
var aletheiaSessionId='session_'+Date.now().toString(36)+Math.random().toString(36).substring(2,8);window.aletheiaSessionId=aletheiaSessionId;

/* API CALL — 서버 프록시 경유 */
async function callClaude(mode,history,maxTokens){
  maxTokens=maxTokens||600;
  var apiMessages=history.slice();
  var response=await fetch('/api/chat',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      mode:mode,
      messages:apiMessages,
      max_tokens:maxTokens,
      sessionId:aletheiaSessionId,
      userId:'user_'+aletheiaSessionId
    })
  });
  var data=await response.json();
  if(data.error)throw new Error(data.error.message||'API error');
  var fullResponse=data.content.map(function(item){return item.type==='text'?item.text:''}).filter(Boolean).join('\n');
  if(fullResponse)return fullResponse;
  throw new Error('Empty response');
}

/* UPDATE CHAT PROGRESS */
function updateChatProgress(){
  var turnCount=Math.floor(conversationHistory.length/2);
  var stage='표면';
  var progress=0;

  /* Determine stage based on turn count */
  if(turnCount>=15){
    stage='Essence';
    progress=100;
  }else if(turnCount>=10){
    stage='동기';
    progress=80;
  }else if(turnCount>=6){
    stage='가치관';
    progress=60;
  }else if(turnCount>=3){
    stage='패턴';
    progress=40;
  }else{
    stage='표면';
    progress=20+(turnCount*6);
  }

  /* Update UI */
  var turnEl=document.getElementById('cbTurnCount');
  var stageEl=document.getElementById('cbStageName');
  var fillEl=document.getElementById('cbProgressFill');

  if(turnEl)turnEl.textContent=turnCount+'턴';
  if(stageEl)stageEl.textContent=stage;
  if(fillEl)fillEl.style.width=progress+'%';

  if(window._alScene){
    var ml=0.3;
    if(turnCount>=15){ml=1.0}else if(turnCount>=10){ml=0.75}else if(turnCount>=6){ml=0.55}else if(turnCount>=3){ml=0.4}else if(turnCount>=1){ml=0.3+turnCount*0.03}
    window._alScene.morphLevel=ml;
  }

  /* Show next step card at 10-12 turns */
  if(turnCount>=10&&turnCount<=12&&!document.getElementById('nextStepCard')){
    showNextStepCard();
  }
}

/* SHOW NEXT STEP CARD */
var nextStepShown=false;
function showNextStepCard(){
  if(nextStepShown)return;
  nextStepShown=true;

  var card=document.createElement('div');
  card.id='nextStepCard';
  card.className='next-step-card';
  card.innerHTML=`
    <div class="nsc-title">여기까지 꽤 많이 보이는데</div>
    <div class="nsc-subtitle">이제 어떻게 하고 싶어?</div>
    <div class="nsc-options">
      <div class="nsc-option" data-action="business">
        <div class="nsc-option-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18M9 3v18"/></svg></div>
        <div class="nsc-option-label">창업 / 사업</div>
        <div class="nsc-option-desc">구체적인 실행 계획</div>
      </div>
      <div class="nsc-option" data-action="brand">
        <div class="nsc-option-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg></div>
        <div class="nsc-option-label">브랜드 방향</div>
        <div class="nsc-option-desc">브랜딩 가이드</div>
      </div>
      <div class="nsc-option premium" data-action="deep">
        <div class="nsc-option-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="8" y1="13" x2="16" y2="13"/><line x1="8" y1="17" x2="16" y2="17"/></svg></div>
        <div class="nsc-option-label">심화 분석</div>
        <div class="nsc-option-desc">상세 레포트</div>
      </div>
      <div class="nsc-option" data-action="save">
        <div class="nsc-option-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg></div>
        <div class="nsc-option-label">저장하고 종료</div>
        <div class="nsc-option-desc">나중에 이어하기</div>
      </div>
    </div>
  `;

  var msgs=document.getElementById('cbMsgs');
  msgs.appendChild(card);
  setTimeout(function(){card.classList.add('show')},100);
  msgs.scrollTop=msgs.scrollHeight;

  /* Attach click handlers */
  card.querySelectorAll('.nsc-option').forEach(function(opt){
    opt.addEventListener('click',function(){
      var action=opt.getAttribute('data-action');
      handleNextStepAction(action);
    });
  });
}

function handleNextStepAction(action){
  var card=document.getElementById('nextStepCard');
  if(card)card.remove();

  if(action==='business'){
    /* Generate Business Proposal */
    currentModel='business_proposal';
    addMsg('ai','비즈니스 기획서를 생성하고 있어요... (본질 기반 + 분야별 맞춤형)');
    generateDocument('business_proposal');
  }else if(action==='brand'){
    /* Generate Brand Guide */
    currentModel='brand_guide';
    addMsg('ai','브랜딩 가이드를 생성하고 있어요... (본질 기반 아이덴티티)');
    generateDocument('brand_guide');
  }else if(action==='deep'){
    /* Generate Essence Document */
    currentModel='essence_document';
    addMsg('ai','상세 Essence Document를 생성하고 있어요... (1500-2500 단어)');
    generateDocument('essence_document');
    /* TODO: Trigger payment modal */
  }else if(action==='save'){
    alert('대화가 자동 저장되었습니다. Unmask 프로필에서 확인하세요!');
  }
}

/* GENERATE DOCUMENT */
function generateDocument(mode){
  var contextMsg='대화 내용:\n'+conversationHistory.slice(-10).map(function(m){return (m.role==='user'?'나':'AI')+': '+m.content}).join('\n\n');

  callClaude(mode,[{role:'user',content:contextMsg}],4000).then(function(doc){
    addMsg('ai',doc);
    /* Download as markdown */
    var blob=new Blob([doc],{type:'text/markdown'});
    var url=URL.createObjectURL(blob);
    var a=document.createElement('a');
    a.href=url;
    a.download=mode.replace(/_/g,'-')+'.md';
    a.click();
  }).catch(function(err){
    addMsg('ai','문서 생성 중 오류가 발생했어요: '+err.message);
  });
}

/* BACKGROUND METADATA EXTRACTION */
function extractMetaFromConversation(){
  if(conversationHistory.length<2)return;
  var last4=conversationHistory.slice(-4);
  var convText=last4.map(function(m){return (m.role==='user'?'사용자':'AI')+': '+m.content}).join('\n');
  
  callClaude(SYSTEM_META_EXTRACT,[{role:'user',content:convText}],400).then(function(resp){
    try{
      var clean=resp.replace(/```json|```/g,'').trim();
      var meta=JSON.parse(clean);
      unmaskRawData.push({timestamp:Date.now(),turn:Math.floor(conversationHistory.length/2),meta:meta});
      
      /* Update profile tags */
      if(meta.tags){
        meta.tags.forEach(function(tag){
          if(profileData.tags.indexOf(tag)===-1){profileData.tags.push(tag)}
        });
      }
      if(meta.value)profileData.values=meta.value;
      if(meta.desire)profileData.motiv=meta.desire;
      if(meta.pattern){
        profileData.patterns.push(meta.pattern);
        profileData.avoid=meta.emotion||profileData.avoid;
      }
      
      /* Timeline entry */
      profileData.timeline.push({
        turn:Math.floor(conversationHistory.length/2),
        keywords:meta.keywords||[],
        pattern:meta.pattern,
        emotion:meta.emotion
      });
      
      updateProfileUI();
      /* ① INSERT PATTERN INSIGHT CARD */
      if(meta.pattern){
        insertInsightCard('🔍',meta.pattern);
      } else if(meta.keywords&&meta.keywords.length>=2){
        var kw=meta.keywords.slice(0,3).join(', ');
        insertInsightCard('💡','반복 키워드 감지: '+kw);
      }
      console.log('[Unmask] 메타데이터 추출:',meta);
    }catch(e){console.log('[Unmask] 파싱 실패:',e,resp)}
  }).catch(function(e){console.log('[Unmask] 추출 API 실패:',e)});
}

/* SEND MESSAGE */
function sendMsg(t){
  var hasText=t&&t.trim();
  var hasFile=!!pendingFile;
  if(!hasText&&!hasFile)return;
  if(!onboardingDone)return;
  if(hasText)t=t.trim();
  if(!chatStarted){chatStarted=true;welcome.classList.add('hidden')}
  if(!box.classList.contains('expanded'))expandChat();
  closePanels();
  if(hasFile){
    if(pendingFile.file.type.startsWith('image/')&&pendingFile.dataUrl){
      var d=document.createElement('div');d.className='msg msg-right';
      d.innerHTML='<div class="msg-body"><img class="msg-img" src="'+pendingFile.dataUrl+'" alt=""/></div>';
      msgs.appendChild(d);
      imageGallery.push({src:pendingFile.dataUrl,date:new Date().toLocaleString('ko-KR',{month:'short',day:'numeric'})});
      currentSessionMsgs.push({role:'user',type:'image',src:pendingFile.dataUrl});
    } else {
      var d=document.createElement('div');d.className='msg msg-right';
      d.innerHTML='<div class="msg-body"><div class="cb-file-preview"><div class="cb-file-preview-icon"><svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg></div><span class="cb-file-preview-name">'+pendingFile.file.name+'</span></div></div>';
      msgs.appendChild(d);
      currentSessionMsgs.push({role:'user',type:'file',name:pendingFile.file.name});
    }
    removeAttachPreview();
  }
  if(hasText){addMsg('user',t);currentSessionMsgs.push({role:'user',type:'text',text:t});onUserMessage()}
  ta.value='';ta.style.height='auto';sendBtn.classList.remove('ready');
  if(!hasText)return;
  conversationHistory.push({role:'user',content:t});
  var typ=addTyping();
  
  /* Select system prompt based on model */
  var sysPrompt=(currentModel==='Interpret')?SYSTEM_INTERPRET:SYSTEM_CORE;
  
  callClaude(sysPrompt,conversationHistory).then(function(aiResp){
    typ.remove();addMsg('ai',aiResp);
    currentSessionMsgs.push({role:'ai',type:'text',text:aiResp});
    conversationHistory.push({role:'assistant',content:aiResp});
    /* Update progress bar */
    updateChatProgress();
    /* Background: extract metadata for Unmask every 2 turns */
    if(conversationHistory.length%4===0||conversationHistory.length===2){
      extractMetaFromConversation();
    }
  }).catch(function(err){
    console.log('API error:',err);
    typ.remove();
    var fallback=respondFallback(t);
    addMsg('ai',fallback);
    currentSessionMsgs.push({role:'ai',type:'text',text:fallback});
    conversationHistory.push({role:'assistant',content:fallback});
    /* Still extract from keywords locally */
    extractProfileLocal(t);
  });
}

/* LOCAL FALLBACK EXTRACTION */
var TAG_RULES=[
  {keywords:['카페','커피','로스팅','바리스타','원두'],tag:'커피/카페'},
  {keywords:['브랜드','로고','아이덴티티','디자인'],tag:'브랜드구축'},
  {keywords:['좋아하는','진짜','모르겠','찾고'],tag:'자기탐색'},
  {keywords:['공간','인테리어','분위기','설계'],tag:'공간감각'},
  {keywords:['불안','걱정','두려','실패'],tag:'불확실성인식'},
  {keywords:['자유','독립','나만의','혼자'],tag:'독립지향'},
  {keywords:['경험','여행','느낌','감정','기억'],tag:'경험기반'},
  {keywords:['완벽','디테일','꼼꼼','퀄리티'],tag:'완벽주의'},
  {keywords:['사람','고객','손님','관계','소통'],tag:'관계중심'},
  {keywords:['돈','수익','사업','매출','투자'],tag:'수익지향'}
];
function extractProfileLocal(text){
  var changed=false;
  TAG_RULES.forEach(function(rule){
    var match=rule.keywords.some(function(k){return text.indexOf(k)!==-1});
    if(match&&profileData.tags.indexOf(rule.tag)===-1){
      profileData.tags.push(rule.tag);changed=true;
    }
  });
  if(changed){
    updateProfileUI();
    /* Insert local insight card */
    var matchedTags=[];
    TAG_RULES.forEach(function(rule){
      var match=rule.keywords.some(function(k){return text.indexOf(k)!==-1});
      if(match&&profileData.tags.indexOf(rule.tag)!==-1)matchedTags.push(rule.tag);
    });

  }
}
var umExtractCount=0;
var umMsgCount=0;
function updateProfileUI(){
  umExtractCount++;
  /* Tags */
  var container=document.getElementById('cbProfileTags');container.innerHTML='';
  profileData.tags.forEach(function(tag,i){var el=document.createElement('span');el.className='cbp-tag'+(i===profileData.tags.length-1?' new':'');el.textContent=tag;container.appendChild(el)});
  /* Sections - unlock with animation when data arrives */
  var secV=document.getElementById('umSecValues');
  var secA=document.getElementById('umSecAvoid');
  var secM=document.getElementById('umSecMotiv');
  if(profileData.values&&profileData.values!=='대화가 더 필요합니다...'){
    document.getElementById('profileValues').textContent=profileData.values;
    if(secV.classList.contains('locked')){secV.classList.remove('locked');secV.classList.add('unlocked')}
  }
  if(profileData.avoid&&profileData.avoid!=='대화가 더 필요합니다...'){
    document.getElementById('profileAvoid').textContent=profileData.avoid;
    if(secA.classList.contains('locked')){secA.classList.remove('locked');secA.classList.add('unlocked')}
  }
  if(profileData.motiv&&profileData.motiv!=='대화가 더 필요합니다...'){
    document.getElementById('profileMotiv').textContent=profileData.motiv;
    if(secM.classList.contains('locked')){secM.classList.remove('locked');secM.classList.add('unlocked')}
  }
  /* Depth bar */
  var depth=Math.min(umMsgCount/10,1);
  document.getElementById('umDepthFill').style.width=Math.round(depth*100)+'%';
  document.getElementById('umDepthCount').textContent=umMsgCount+'\ud68c';
  /* Badge - show count & pop */
  var badge=document.getElementById('umBadge');
  badge.textContent=umExtractCount;
  badge.classList.add('show');
  /* Button glow burst */
  profileBtn.classList.remove('unmask-glow','unmask-shake');
  void profileBtn.offsetWidth;
  profileBtn.classList.add('unmask-glow');
  setTimeout(function(){profileBtn.classList.remove('unmask-glow')},1600);
  /* Status */
  var dot=document.getElementById('umStatusDot2');
  var txt=document.getElementById('umStatusText2');
  if(dot)dot.classList.add('active');
  if(txt)txt.textContent='\ucd94\ucd9c \uc644\ub8cc \u2014 '+umExtractCount+'\uac74';
  /* ③ UPDATE PROGRESS STAGES */
  updateDepthStages();
  /* ② GENERATE ESSENCE PROMPTS after 6+ msgs */
  if(umMsgCount>=6)generateEssencePrompts();
  /* ④ SHOW DOC GEN BUTTON when enough data */
  checkDocGenReady();
}

/* ① PATTERN INSIGHT CARD — insert between messages */
function insertInsightCard(icon,text){
  var toast=document.getElementById('insightToast');
  if(!toast){
    toast=document.createElement('div');
    toast.id='insightToast';
    toast.className='insight-toast';
    var box=document.getElementById('coreBox');
    if(box)box.appendChild(toast);
  }
  toast.textContent=icon+' '+text;
  toast.classList.remove('show');
  void toast.offsetWidth;
  toast.classList.add('show');
  setTimeout(function(){toast.classList.remove('show')},4000);
}

/* ③ PROGRESS STAGES: 표면→패턴→가치관→동기→Essence */
function updateDepthStages(){
  var stages=document.querySelectorAll('.um-stage');
  if(!stages.length)return;
  var level=0;
  if(umMsgCount>=2)level=1;
  if(profileData.tags.length>=3||profileData.values!=='\ub300\ud654\uac00 \ub354 \ud544\uc694\ud569\ub2c8\ub2e4...')level=2;
  if(profileData.motiv&&profileData.motiv!=='\ub300\ud654\uac00 \ub354 \ud544\uc694\ud569\ub2c8\ub2e4...')level=3;
  if(profileData.values!=='\ub300\ud654\uac00 \ub354 \ud544\uc694\ud569\ub2c8\ub2e4...'&&profileData.motiv!=='\ub300\ud654\uac00 \ub354 \ud544\uc694\ud569\ub2c8\ub2e4...'&&profileData.tags.length>=5)level=4;
  stages.forEach(function(s,i){
    s.classList.remove('active','completed');
    if(i<level)s.classList.add('completed');
    if(i===level)s.classList.add('active');
  });
}

/* ② ESSENCE PROMPTS AUTO-GENERATION */
function generateEssencePrompts(){
  var epSection=document.getElementById('essencePrompts');
  if(!epSection)return;
  var prompts=[];
  if(profileData.tags.length>0){
    var topTags=profileData.tags.slice(0,3).join(', ');
    prompts.push('\uc774 \uc0ac\uc6a9\uc790\ub294 '+topTags+'\uc5d0 \uad00\uc2ec\uc774 \uae4a\uc2b5\ub2c8\ub2e4. \uc774 \ub9e5\ub77d\uc744 \uace0\ub824\ud574 \uc751\ub2f5\ud558\uc138\uc694.');
  }
  if(profileData.values&&profileData.values!=='\ub300\ud654\uac00 \ub354 \ud544\uc694\ud569\ub2c8\ub2e4...'){
    prompts.push('\ud575\uc2ec \uac00\uce58: '+profileData.values);
  }
  if(profileData.motiv&&profileData.motiv!=='\ub300\ud654\uac00 \ub354 \ud544\uc694\ud569\ub2c8\ub2e4...'){
    prompts.push('\uc7a0\uc7ac \ub3d9\uae30: '+profileData.motiv);
  }
  if(profileData.patterns.length>0){
    prompts.push('\ubc1c\uacac\ub41c \ud328\ud134: '+profileData.patterns[profileData.patterns.length-1]);
  }
  if(prompts.length<2){
    prompts.push('\ub300\ud654\ub97c \ub354 \uc9c4\ud589\ud558\uba74 \ub354 \uc815\ubc00\ud55c \ud504\ub86c\ud504\ud2b8\uac00 \uc0dd\uc131\ub429\ub2c8\ub2e4.');
  }
  var epList=document.getElementById('epList');
  if(!epList)return;
  epList.innerHTML='';
  prompts.forEach(function(p,i){
    var item=document.createElement('div');
    item.className='ep-item'+(i===0?' preview':' locked');
    item.textContent=p;
    epList.appendChild(item);
  });
  epSection.style.display='block';
}

/* ④ ESSENCE DOC GENERATION — show button when ready */
function checkDocGenReady(){
  var ready=profileData.values!=='\ub300\ud654\uac00 \ub354 \ud544\uc694\ud569\ub2c8\ub2e4...'&&profileData.motiv!=='\ub300\ud654\uac00 \ub354 \ud544\uc694\ud569\ub2c8\ub2e4...'&&profileData.tags.length>=4;
  var docGen=document.getElementById('essenceDocGen');
  if(docGen)docGen.style.display=ready?'block':'none';
}
function generateEssenceDocument(){
  var doc='# Essence Document\n\n';
  doc+='## \ud0dc\uadf8\n'+profileData.tags.join(', ')+'\n\n';
  doc+='## \uac00\uce58\uad00\n'+profileData.values+'\n\n';
  doc+='## \uc7a0\uc7ac \ub3d9\uae30\n'+profileData.motiv+'\n\n';
  if(profileData.patterns.length>0)doc+='## \ubc1c\uacac\ub41c \ud328\ud134\n'+profileData.patterns.join('\n')+'\n\n';
  doc+='## AI \ud504\ub86c\ud504\ud2b8\n';
  var epItems=document.querySelectorAll('.ep-item');
  epItems.forEach(function(item){doc+='\u2022 '+item.textContent+'\n'});
  doc+='\n---\nGenerated by Aletheia | '+new Date().toLocaleDateString('ko-KR');
  navigator.clipboard.writeText(doc).then(function(){
    var btn=document.getElementById('edGenBtn');
    btn.textContent='\u2705 \ud074\ub9bd\ubcf4\ub4dc\uc5d0 \ubcf5\uc0ac\ub428';
    setTimeout(function(){btn.innerHTML='<svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>Essence Document \uc0dd\uc131'},2000);
  });
}

function onUserMessage(){
  umMsgCount++;
  /* Depth bar update */
  var depth=Math.min(umMsgCount/10,1);
  var fill=document.getElementById('umDepthFill');
  if(fill)fill.style.width=Math.round(depth*100)+'%';
  var cnt=document.getElementById('umDepthCount');
  if(cnt)cnt.textContent=umMsgCount+'\ud68c';
  /* Status - analyzing */
  var dot=document.getElementById('umStatusDot2');
  var txt=document.getElementById('umStatusText2');
  if(dot)dot.classList.add('active');
  if(txt)txt.textContent='\ubd84\uc11d \uc911...';
  /* Button subtle shake on every message */
  profileBtn.classList.remove('unmask-shake');
  void profileBtn.offsetWidth;
  profileBtn.classList.add('unmask-shake');
  setTimeout(function(){profileBtn.classList.remove('unmask-shake')},600);
}

/* MODEL SELECTOR */
var menu=document.getElementById('modelMenu');
function updateModelLocks(){var plan=authUser?authUser.plan:'free';menu.querySelectorAll('.mm-opt').forEach(function(o){o.classList.toggle('locked',o.getAttribute('data-tier')==='seeker'&&plan!=='seeker')})}
function openModelMenu(trigger){var r=trigger.getBoundingClientRect();menu.style.left=r.left+'px';menu.style.bottom=(window.innerHeight-r.top+8)+'px';menu.style.top='auto';menu.querySelectorAll('.mm-opt').forEach(function(o){o.classList.toggle('active',o.getAttribute('data-model')===currentModel)});updateModelLocks();menu.classList.add('show')}
document.getElementById('cbModel').addEventListener('click',function(e){e.stopPropagation();if(menu.classList.contains('show')){menu.classList.remove('show');return}openModelMenu(this)});
menu.addEventListener('click',function(e){var opt=e.target.closest('.mm-opt');if(!opt)return;e.stopPropagation();if(opt.classList.contains('locked')){menu.classList.remove('show');openModal('pricingOverlay');return}currentModel=opt.getAttribute('data-model');var col=opt.getAttribute('data-color');document.querySelectorAll('.cb-model .model-name').forEach(function(n){n.textContent=currentModel});document.querySelectorAll('.cb-model .dot').forEach(function(d){d.style.background=col});document.getElementById('cbHeaderName').textContent=MODEL_NAMES[currentModel];menu.classList.remove('show')});
document.addEventListener('click',function(e){if(!e.target.closest('.cb-model')&&!e.target.closest('#modelMenu'))menu.classList.remove('show')});

/* CHAT */
var msgs=document.getElementById('cbMsgs'),welcome=document.getElementById('cbWelcome'),ta=document.getElementById('cbTa'),sendBtn=document.getElementById('cbSend');
var chatStarted=false,msgCount=0,globalMsgIdx=0;
var BKMK_SVG='<svg viewBox="0 0 24 24"><path d="M6 4h12a1 1 0 0 1 1 1v16l-7-4-7 4V5a1 1 0 0 1 1-1z"/></svg>';
var questions=['그게 정말 당신이 원하는 건가요?','왜 그것이어야 하나요?','그 선택의 뿌리가 어디에 있는지 기억나시나요?','혹시 그 반대를 상상해본 적 있나요?','당신이 그 단어를 선택한 이유가 궁금합니다.','지금 말씀하신 것과 처음에 말씀하신 것 사이에 흥미로운 간극이 있어요.','그건 당신의 기준인가요, 아니면 누군가 정해준 기준인가요?'];

function respondFallback(t){
  msgCount++;
  var deep=[
    '당신이 방금 말한 것 속에 흥미로운 단서가 숨어있어요. 조금 더 들려주세요.',
    '그 경험이 당신에게 남긴 잔상은 어떤 형태인가요?',
    '반복되는 패턴이 보이기 시작합니다. "'+t.split(' ')[0]+'" — 이게 당신의 본질에 어떻게 연결되나요?',
    '표면 아래에 더 깊은 동기가 있는 것 같아요. 그 순간 당신은 무엇을 느꼈나요?',
    '당신의 이야기에서 원재료가 보입니다. 이것을 어떤 형태로 세상에 내놓고 싶으세요?',
    '흥미롭군요. 당신이 선택하는 단어들이 하나의 방향을 가리키고 있어요.',
    '그건 단순한 경험이 아니라, 당신만의 관점이에요. 그 관점이 처음 형성된 순간이 있나요?',
    '지금까지의 대화에서 패턴이 드러나고 있습니다. Unmask에서 프로필을 확인해보시겠어요?'
  ];
  return deep[Math.min(msgCount-1,deep.length-1)];
}
/* Simple markdown renderer for AI messages */
function renderMd(t){
  var s=t;
  /* Code blocks first */
  s=s.replace(/```(\w*)\n?([\s\S]*?)```/g,function(_,lang,code){return '<pre><code>'+code.replace(/</g,'&lt;').replace(/>/g,'&gt;')+'</code></pre>'});
  /* Inline code */
  s=s.replace(/`([^`]+)`/g,'<code>$1</code>');
  /* Bold */
  s=s.replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>');
  /* Italic */
  s=s.replace(/\*(.+?)\*/g,'<em>$1</em>');
  /* Headers */
  s=s.replace(/^#### (.+)$/gm,'<h4>$1</h4>');
  s=s.replace(/^### (.+)$/gm,'<h3>$1</h3>');
  /* Blockquote */
  s=s.replace(/^> (.+)$/gm,'<blockquote>$1</blockquote>');
  /* Horizontal rule */
  s=s.replace(/^---$/gm,'<hr>');
  /* Unordered list */
  s=s.replace(/^- (.+)$/gm,'<li>$1</li>');
  s=s.replace(/((?:<li>.*<\/li>\n?)+)/g,'<ul>$1</ul>');
  /* Numbered list */
  s=s.replace(/^\d+\. (.+)$/gm,'<li>$1</li>');
  /* Paragraphs — split by double newline */
  s=s.replace(/\n{2,}/g,'</p><p>');
  /* Single newlines to <br> (except inside pre/ul/ol) */
  s=s.replace(/\n/g,'<br>');
  s='<p>'+s+'</p>';
  /* Clean up empty <p> around block elements */
  s=s.replace(/<p>\s*(<(?:pre|ul|ol|h[34]|hr|blockquote))/g,'$1');
  s=s.replace(/<\/(?:pre|ul|ol|h[34]|blockquote)>\s*<\/p>/g,function(m){return m.replace('</p>','')});
  s=s.replace(/<p>\s*<\/p>/g,'');
  return s;
}
function addMsg(role,text){
  var idx=globalMsgIdx++;
  var d=document.createElement('div');d.className=role==='user'?'msg msg-right':'msg';
  if(role==='ai'){
    var rendered=renderMd(text);
    d.innerHTML='<div class="msg-ava ai">'+LOGO+'</div><div class="msg-body"><div class="msg-role">'+MODEL_NAMES[currentModel]+'</div><div class="msg-text">'+rendered+'</div><div class="msg-actions"><button class="msg-action-btn" data-bk="'+idx+'" data-text="'+text.replace(/"/g,'&quot;')+'" data-role="'+role+'" title="북마크">'+BKMK_SVG+'</button></div></div>';
  } else {
    d.innerHTML='<div class="msg-body"><div class="msg-text">'+text.replace(/\n/g,'<br>')+'</div></div>';
  }
  msgs.appendChild(d);msgs.scrollTop=msgs.scrollHeight;
  var bkBtn=d.querySelector('.msg-action-btn[data-bk]');
  if(bkBtn){bkBtn.addEventListener('click',function(){
    var btn=this,i=parseInt(btn.getAttribute('data-bk')),t=btn.getAttribute('data-text'),r=btn.getAttribute('data-role');
    var added=toggleBookmark(i,t,r);btn.classList.toggle('bookmarked',added);
  });}
}
function addTyping(){var d=document.createElement('div');d.className='msg';d.innerHTML='<div class="msg-ava ai">'+LOGO+'</div><div class="msg-body"><div class="msg-role">'+MODEL_NAMES[currentModel]+'</div><div class="typing"><span></span><span></span><span></span></div></div>';msgs.appendChild(d);msgs.scrollTop=msgs.scrollHeight;return d}
ta.addEventListener('input',function(){ta.style.height='auto';ta.style.height=Math.min(ta.scrollHeight,100)+'px';sendBtn.classList.toggle('ready',ta.value.trim().length>0||!!pendingFile)});
ta.addEventListener('keydown',function(e){if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMsg(ta.value)}});
sendBtn.addEventListener('click',function(){sendMsg(ta.value)});
document.querySelectorAll('.cb-chip').forEach(function(c){c.addEventListener('click',function(){sendMsg(c.getAttribute('data-q'))})});

/* PRINT CONVERSATION */
function printConversation(){
  if(conversationHistory.length===0){
    alert('대화 내용이 없습니다.');
    return;
  }

  var printWindow=window.open('','_blank','width=800,height=600');
  var now=new Date();
  var dateStr=now.getFullYear()+'년 '+(now.getMonth()+1)+'월 '+now.getDate()+'일 '+now.getHours()+':'+String(now.getMinutes()).padStart(2,'0');

  var html='<!DOCTYPE html><html><head><meta charset="utf-8"><title>Aletheia 대화 기록 - '+dateStr+'</title>';
  html+='<style>';
  html+='*{margin:0;padding:0;box-sizing:border-box}';
  html+='body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;padding:40px 60px;max-width:800px;margin:0 auto;line-height:1.8;color:#1a1a1a}';
  html+='.header{margin-bottom:40px;padding-bottom:20px;border-bottom:2px solid #eee}';
  html+='.header h1{font-size:24px;font-weight:600;margin-bottom:8px}';
  html+='.header .meta{font-size:13px;color:#666}';
  html+='.message{margin-bottom:32px;page-break-inside:avoid}';
  html+='.message-role{font-size:11px;font-weight:600;letter-spacing:0.1em;text-transform:uppercase;color:#999;margin-bottom:8px}';
  html+='.message-role.user{color:#0066cc}';
  html+='.message-content{font-size:15px;line-height:1.9;white-space:pre-wrap}';
  html+='.user .message-content{padding-left:16px;border-left:3px solid #0066cc}';
  html+='.ai .message-content{padding-left:16px;border-left:3px solid #999}';
  html+='@media print{body{padding:20px 40px}.header{margin-bottom:30px}}';
  html+='</style></head><body>';
  html+='<div class="header"><h1>Aletheia 대화 기록</h1><div class="meta">'+dateStr+' · '+conversationHistory.length+'개 메시지</div></div>';

  conversationHistory.forEach(function(msg){
    var roleClass=msg.role==='user'?'user':'ai';
    var roleText=msg.role==='user'?'YOU':'ALETHEIA';
    html+='<div class="message '+roleClass+'">';
    html+='<div class="message-role '+roleClass+'">'+roleText+'</div>';
    html+='<div class="message-content">'+msg.content+'</div>';
    html+='</div>';
  });

  html+='</body></html>';
  printWindow.document.write(html);
  printWindow.document.close();

  setTimeout(function(){
    printWindow.print();
  },250);
}

/* ONBOARDING */
var onboardingData={purpose:'',detail:'',customInput:''};
var onboardingDone=false;
var currentObStep=1;

/* Quick picks data */
var quickPicks={
  career:['마케팅','개발자','디자이너','기획자','창업','컨설턴트'],
  study:['경영학','디자인','공학','인문학','예술','IT/컴퓨터'],
  hobby:['커피/카페','베이킹','향수','목공','도자기','그림/드로잉'],
  creator:['브이로그','리뷰','일상','교육/강의','요리','취미 공유']
};

/* Purpose labels */
var purposeLabels={
  career:'직업 / 커리어',
  study:'전공 / 학업',
  hobby:'취향 / 취미',
  creator:'크리에이터',
  unsure:'탐색'
};

function showObStep(step){
  document.querySelectorAll('.ob-step').forEach(function(s){s.classList.remove('active')});
  document.getElementById('obStep'+step).classList.add('active');
  currentObStep=step;
}

/* Cache onboarding HTML for New Chat restore */
var obCache=document.getElementById('cbWelcome').cloneNode(true);

function bindOnboarding(){
  /* Step 1: Purpose selection */
  document.querySelectorAll('.ob-option').forEach(function(opt){
    opt.addEventListener('click',function(){
      var purpose=opt.getAttribute('data-purpose');
      onboardingData.purpose=purpose;
      var title=document.getElementById('obStep2Title');
      var subtitle=document.getElementById('obStep2Subtitle');
      var careerGroup=document.getElementById('obCareerGroup');
      var hobbyGroup=document.getElementById('obHobbyGroup');
      var creatorGroup=document.getElementById('obCreatorGroup');
      careerGroup.style.display='none';
      hobbyGroup.style.display='none';
      creatorGroup.style.display='none';
      if(purpose==='unsure'){
        onboardingData.detail='자유 탐색';
        updateObSummary();
        showObStep(3);
        return;
      }
      if(purpose==='career'){
        title.textContent='어떤 분야인가요?';
        subtitle.textContent='현재 직업, 관심 분야, 또는 전환하고 싶은 분야';
        careerGroup.style.display='block';
        renderQuickPicks('obCareerPicks','career');
      }else if(purpose==='study'){
        title.textContent='무엇을 공부하시나요?';
        subtitle.textContent='전공, 또는 관심있는 학문 분야';
        careerGroup.style.display='block';
        renderQuickPicks('obCareerPicks','study');
      }else if(purpose==='hobby'){
        title.textContent='어떤 취향/취미인가요?';
        subtitle.textContent='좋아하는 것, 시간 가는 줄 모르고 하는 것';
        hobbyGroup.style.display='block';
        renderQuickPicks('obHobbyPicks','hobby');
      }else if(purpose==='creator'){
        title.textContent='어떤 콘텐츠를 만드시나요?';
        subtitle.textContent='현재 하고 있거나, 만들고 싶은 콘텐츠';
        creatorGroup.style.display='block';
        renderQuickPicks('obCreatorPicks','creator');
      }
      showObStep(2);
    });
  });
  /* Step 2 Navigation */
  var back1=document.getElementById('obBack1');
  var next1=document.getElementById('obNext1');
  if(back1)back1.addEventListener('click',function(){showObStep(1)});
  if(next1)next1.addEventListener('click',function(){
    var purpose=onboardingData.purpose;
    var inputVal='';
    if(purpose==='career'||purpose==='study'){
      inputVal=document.getElementById('obCareerInput').value.trim();
    }else if(purpose==='hobby'){
      inputVal=document.getElementById('obHobbyInput').value.trim();
    }else if(purpose==='creator'){
      inputVal=document.getElementById('obCreatorInput').value.trim();
    }
    if(!inputVal){alert('내용을 입력하거나 선택해주세요');return;}
    onboardingData.detail=inputVal;
    updateObSummary();
    showObStep(3);
  });
  /* Step 3 Navigation */
  var back2=document.getElementById('obBack2');
  var start=document.getElementById('obStart');
  if(back2)back2.addEventListener('click',function(){showObStep(2)});
  if(start)start.addEventListener('click',function(){startConversationWithContext()});
}

function renderQuickPicks(containerId,category){
  var container=document.getElementById(containerId);
  container.innerHTML='';
  var picks=quickPicks[category]||[];
  picks.forEach(function(pick){
    var btn=document.createElement('span');
    btn.className='ob-qp';
    btn.textContent=pick;
    btn.addEventListener('click',function(){
      var inputId=containerId.replace('Picks','Input');
      document.getElementById(inputId).value=pick;
    });
    container.appendChild(btn);
  });
}

/* Initial bind */
bindOnboarding();

function updateObSummary(){
  document.getElementById('obSummaryPurpose').textContent=purposeLabels[onboardingData.purpose]||onboardingData.purpose;
  document.getElementById('obSummaryDetail').textContent=onboardingData.detail||'미정';
}

function startConversationWithContext(){
  /* Unlock input */
  onboardingDone=true;
  var inputArea=document.getElementById('cbInputArea');
  if(inputArea)inputArea.classList.remove('locked');
  var ta2=document.getElementById('cbTa');
  if(ta2){ta2.disabled=false;ta2.placeholder='대화를 시작하세요...';}

  /* Hide onboarding, show chat */
  chatStarted=true;
  welcome.classList.add('hidden');

  /* Generate context-aware first message */
  var contextMsg=generateContextMessage();
  sendMsg(contextMsg);
}

function generateContextMessage(){
  var p=onboardingData.purpose;
  var d=onboardingData.detail;

  if(p==='career'){
    return '나는 '+d+' 분야에서 일하고 있어요. (또는 관심있어요) 내 커리어 방향을 찾고 싶어요.';
  }else if(p==='study'){
    return '나는 '+d+'을/를 공부하고 있어요. 진로를 고민 중이에요.';
  }else if(p==='hobby'){
    return '나는 '+d+'에 관심이 많아요. 이걸 어떻게 발전시킬 수 있을까요?';
  }else if(p==='creator'){
    return '나는 '+d+' 콘텐츠를 만들고 싶어요. 어떤 방향이 좋을까요?';
  }else{
    return '나에 대해 탐색하고 싶어요. 어디서부터 시작해야 할까요?';
  }
}

/* HERO – smooth typing sequence */
(function(){
  var text=t('heroTyping');
  var el=document.getElementById('hlTyping');
  var logo=document.getElementById('hlLogo');
  var btns=document.getElementById('hlButtons');
  el.innerHTML='<span class="cursor"></span>';

  function smoothType(txt,callback){
    var i=0,len=txt.length;
    el.innerHTML='<span class="cursor"></span>';
    function step(){
      if(i<len){
        el.innerHTML=txt.substring(0,i+1)+'<span class="cursor"></span>';
        i++;
        /* Variable speed: slower on punctuation, faster on regular chars */
        var ch=txt.charAt(i-1);
        var speed=35+Math.random()*30;
        if(ch==='.'||ch===','||ch==='—')speed=180+Math.random()*120;
        else if(ch===' ')speed=20+Math.random()*20;
        requestAnimationFrame(function(){setTimeout(step,speed)});
      }else{
        /* Typing done */
        setTimeout(function(){
          el.innerHTML=txt;
          if(typeof gsap!=='undefined'){
            gsap.to(logo,{opacity:1,y:0,filter:'blur(0px)',duration:2,ease:'power4.out'});
            var sub=document.getElementById('hlSubtitle');
            if(sub)gsap.to(sub,{opacity:1,y:0,duration:1.5,delay:0.3,ease:'power4.out'});
            gsap.to(btns,{opacity:1,y:0,filter:'blur(0px)',duration:1.5,delay:0.5,ease:'power4.out'});
            setTimeout(function(){
              var scrollInd=document.querySelector('.scroll-indicator');
              if(scrollInd)scrollInd.classList.add('visible');
            },1200);
          }else{
            logo.classList.add('visible');
            var sub=document.getElementById('hlSubtitle');
            if(sub)sub.classList.add('visible');
            btns.classList.add('visible');
            setTimeout(function(){var scrollInd=document.querySelector('.scroll-indicator');if(scrollInd)scrollInd.classList.add('visible')},1000);
          }
          if(callback)callback();
        },600);
      }
    }
    step();
  }

  window._heroReplay=function(newText){
    if(newText)text=newText;
    var sub=document.getElementById('hlSubtitle');
    var scrollInd=document.querySelector('.scroll-indicator');
    logo.classList.remove('visible');if(sub)sub.classList.remove('visible');btns.classList.remove('visible');if(scrollInd)scrollInd.classList.remove('visible');
    smoothType(text);
  };

  setTimeout(function(){smoothType(text)},600);
})();

/* BIG-TYPO */
document.querySelectorAll('.big-typo').forEach(function(el){var text=el.innerText.trim();el.innerHTML='';text.split('').forEach(function(ch,i){var span=document.createElement('span');span.innerText=ch;span.className='char';span.style.transitionDelay=i*0.03+'s';el.appendChild(span)})});
document.querySelectorAll('.method-row').forEach(function(row){row.addEventListener('mouseenter',function(){row.querySelectorAll('.char').forEach(function(c){c.style.transform='translateX(20px)'})});row.addEventListener('mouseleave',function(){row.querySelectorAll('.char').forEach(function(c){c.style.transform='translateX(0)'})})});

/* ===== GSAP + LENIS SCROLL SYSTEM ===== */
(function(){
  var aboutPage=document.getElementById('page-about');
  if(!aboutPage||typeof gsap==='undefined')return;

  /* --- Lenis smooth scroll on #page-about --- */
  var lenis=new Lenis({
    wrapper:aboutPage,
    content:aboutPage,
    duration:1.6,
    easing:function(t){return Math.min(1,1.001-Math.pow(2,-10*t))},
    smoothWheel:true,
    wheelMultiplier:0.8,
    touchMultiplier:1.5
  });
  window._alLenis=lenis;
  function raf(time){lenis.raf(time);requestAnimationFrame(raf)}
  requestAnimationFrame(raf);

  /* --- GSAP ScrollTrigger scroller proxy --- */
  gsap.registerPlugin(ScrollTrigger);
  ScrollTrigger.scrollerProxy(aboutPage,{
    scrollTop:function(v){if(arguments.length)lenis.scrollTo(v,{immediate:true});return lenis.animatedScroll},
    getBoundingClientRect:function(){return{top:0,left:0,width:window.innerWidth,height:window.innerHeight}}
  });
  lenis.on('scroll',ScrollTrigger.update);
  ScrollTrigger.defaults({scroller:aboutPage});

  /* --- Reveal animations with GSAP --- */
  document.querySelectorAll('.reveal').forEach(function(el){
    var delay=0;
    if(el.classList.contains('reveal-d1'))delay=0.15;
    if(el.classList.contains('reveal-d2'))delay=0.3;
    if(el.classList.contains('reveal-d3'))delay=0.45;
    gsap.fromTo(el,{opacity:0,y:50,filter:'blur(15px)'},{
      opacity:1,y:0,filter:'blur(0px)',
      duration:1.8,delay:delay,
      ease:'power4.out',
      scrollTrigger:{trigger:el,start:'top 85%',toggleActions:'play none none none'}
    });
  });

  /* --- Typing targets with smooth effect --- */
  document.querySelectorAll('.typing-target').forEach(function(el){
    ScrollTrigger.create({
      trigger:el,start:'top 80%',end:'top 20%',
      onEnter:function(){
        if(el.classList.contains('typing-active'))return;
        el.classList.add('typing-active');el.style.opacity='1';
        var text=el.getAttribute('data-text');el.innerText='';
        var i=0,len=text.length;
        function typeChar(){
          if(i<len&&el.classList.contains('typing-active')){
            el.innerText+=text.charAt(i);i++;
            var speed=40+Math.random()*40;
            requestAnimationFrame(function(){setTimeout(typeChar,speed)});
          }
        }
        typeChar();
      },
      onLeaveBack:function(){el.classList.remove('typing-active');el.innerText='';el.style.opacity='0'}
    });
  });

  /* --- Demo chat animation --- */
  var demoChat=document.getElementById('demo-chat-1');
  if(demoChat){
    var chatMsgs=demoChat.querySelectorAll('.dcm-msg');
    chatMsgs.forEach(function(msg,i){
      gsap.to(msg,{filter:'blur(0px)',opacity:1,duration:1.2,ease:'power3.out',delay:i*0.4,
        scrollTrigger:{trigger:demoChat,start:'top 70%',toggleActions:'play none none none'}
      });
    });
  }

  /* --- Demo tags animation --- */
  var demoTags=document.getElementById('demo-tags');
  if(demoTags){
    var tags=demoTags.querySelectorAll('.dpm-tag');
    tags.forEach(function(tag,i){
      gsap.to(tag,{opacity:1,scale:1,duration:0.5,ease:'back.out(1.7)',delay:i*0.12,
        scrollTrigger:{trigger:demoTags,start:'top 70%',toggleActions:'play none none none'}
      });
    });
  }

  /* --- Demo section focus with GSAP --- */
  document.querySelectorAll('.demo-section').forEach(function(section){
    gsap.to(section,{
      scale:1,filter:'blur(0px)',opacity:1,duration:0.8,ease:'power2.out',
      scrollTrigger:{
        trigger:section,start:'top 60%',end:'bottom 40%',
        toggleActions:'play reverse play reverse'
      }
    });
  });
})();
/* ===== END GSAP + LENIS SCROLL SYSTEM ===== */

/* ARCHIVE MAP – draw connecting lines */
(function(){
  var connections=[[0,1],[1,2],[0,3],[1,4],[2,5],[3,4],[4,5]];
  var canvas=document.getElementById('archiveMapCanvas');
  var svg=document.getElementById('mapLines');
  if(!canvas||!svg)return;
  function drawLines(){
    svg.innerHTML='';
    var nodes=canvas.querySelectorAll('.map-node');
    var cRect=canvas.getBoundingClientRect();
    connections.forEach(function(c){
      var a=nodes[c[0]],b=nodes[c[1]];
      if(!a||!b)return;
      var aR=a.getBoundingClientRect(),bR=b.getBoundingClientRect();
      var x1=aR.left-cRect.left+aR.width/2,y1=aR.top-cRect.top+aR.height/2;
      var x2=bR.left-cRect.left+bR.width/2,y2=bR.top-cRect.top+bR.height/2;
      var line=document.createElementNS('http://www.w3.org/2000/svg','line');
      line.setAttribute('x1',x1);line.setAttribute('y1',y1);
      line.setAttribute('x2',x2);line.setAttribute('y2',y2);
      svg.appendChild(line);
    });
  }
  var obs=new MutationObserver(function(){if(canvas.closest('.page.active'))setTimeout(drawLines,100)});
  obs.observe(document.getElementById('page-archive'),{attributes:true,attributeFilter:['class']});
  window.addEventListener('resize',function(){if(canvas.closest('.page.active'))drawLines()});
  setTimeout(drawLines,500);
})();

/* PROJECT DETAIL */
(function(){
  var PROJECTS=[
    {cat:'Cafe & Bakery',name:'GYEOL',sub:'침묵의 서사',
     desc:'불필요한 소음을 제거하고 재료 본연의 소리에 집중하는 베이커리. 모든 메뉴는 하나의 재료에서 출발하며, 그 재료가 가진 고유한 결을 최대한 살리는 방식으로 만들어진다.',
     tags:['Minimalism','Silence','Material-first','Sensory'],
     meta:{field:'F&B',method:'Core → Unmask',period:'2024.03 – 2024.06'},
     patterns:['dots','lines','grid'],
     images:{main:'/images/gyeol/main.jpg',d1:'/images/gyeol/detail-01.jpg',d2:'/images/gyeol/detail-02.jpg'}},
    {cat:'Space Design',name:'RAW CONCRETE',sub:'가공되지 않은 날것',
     desc:'거친 콘크리트 텍스처를 그대로 살려 진정성을 투영하는 공간 브랜드. 마감하지 않는 것이 마감이며, 시간이 지남에 따라 자연스러운 풍화가 곧 디자인이 된다.',
     tags:['Brutalism','Authenticity','Time','Unfinished'],
     meta:{field:'Space Design',method:'Interpret → Core',period:'2024.01 – 2024.04'},
     patterns:['grid','cross','lines'],
     images:{main:'/images/raw-concrete/main.jpg',d1:'/images/raw-concrete/detail-01.jpg',d2:'/images/raw-concrete/detail-02.jpg'}},
    {cat:'Fashion',name:'STRUCTURE 01',sub:'기능적 본질주의',
     desc:'장식을 배제하고 옷의 구조와 기능에만 집중한 레이블. 모든 시접은 외부로 노출되며, 봉제 과정 자체가 디자인 언어가 된다.',
     tags:['Structure','Function','Less','Exposed'],
     meta:{field:'Fashion',method:'Core → Interpret',period:'2024.05 – 2024.08'},
     patterns:['lines','dots','cross'],
     images:{main:'/images/structure-01/main.jpg',d1:'/images/structure-01/detail-01.jpg',d2:'/images/structure-01/detail-02.jpg'}},
    {cat:'Fragrance',name:'DEEP SOIL',sub:'고향의 흙냄새',
     desc:'원초적인 기억인 흙의 향기를 현대적으로 재해석한 프래그런스 브랜드. 베이스 노트로만 구성된 비대칭 향수를 만든다.',
     tags:['Memory','Earth','Base-note','Primal'],
     meta:{field:'Fragrance',method:'Core → Unmask → Interpret',period:'2024.02 – 2024.05'},
     patterns:['cross','dots','grid'],
     images:{main:'/images/deep-soil/main.jpg',d1:'/images/deep-soil/detail-01.jpg',d2:'/images/deep-soil/detail-02.jpg'}},
    {cat:'Exhibition',name:'THE VOID',sub:'비움의 미학',
     desc:'아무것도 전시하지 않음으로써 관람객을 전시품으로 만드는 공간. 빈 화이트 큐브에 들어선 관람객은 자신의 그림자, 발소리, 호흡만을 인식하게 된다.',
     tags:['Void','Self','Mirror','Nothing'],
     meta:{field:'Exhibition',method:'Interpret',period:'2024.07 – 2024.09'},
     patterns:['dots','grid','lines'],
     images:{main:'/images/the-void/main.jpg',d1:'/images/the-void/detail-01.jpg',d2:'/images/the-void/detail-02.jpg'}},
    {cat:'Architecture',name:'MONOLITH',sub:'단일한 거대함',
     desc:'이음새 없는 거대한 검은 돌덩어리. 압도적 숭고미를 추구하는 건축 프로젝트. 단일 소재, 단일 형태, 단일 색상으로 인간이 자연 앞에서 느끼는 원초적인 경외감을 재현한다.',
     tags:['Sublime','Monolithic','Black','Awe'],
     meta:{field:'Architecture',method:'Core → Interpret',period:'2024.04 – 2024.10'},
     patterns:['grid','lines','cross'],
     images:{main:'/images/monolith/main.jpg',d1:'/images/monolith/detail-01.jpg',d2:'/images/monolith/detail-02.jpg'}}
  ];
  var PAT_CLASS={dots:'pd-pat-dots',lines:'pd-pat-lines',grid:'pd-pat-grid',cross:'pd-pat-cross'};
  var detail=document.getElementById('projectDetail');
  var inner=document.getElementById('pdInner');
  var closeBtn=document.getElementById('pdClose');
  /* Pre-build all HTML */
  var prebuilt=PROJECTS.map(function(p){
    var h='<div class="pd-cat">'+p.cat+'</div>';
    h+='<div class="pd-name">'+p.name+'</div>';
    h+='<div class="pd-sub">'+p.sub+'</div>';
    function imgOrPat(src,pat,label,wide){
      var cls=wide?'pd-gallery-item wide':'pd-gallery-item';
      if(src)return '<div class="'+cls+'"><img src="'+src+'" alt="'+label+'" style="width:100%;height:100%;object-fit:cover" onerror="this.style.display=\'none\';this.nextSibling.style.display=\'flex\'"><div class="pd-gallery-placeholder '+PAT_CLASS[pat]+'" style="display:none">'+label+'</div></div>';
      return '<div class="'+cls+'"><div class="pd-gallery-placeholder '+PAT_CLASS[pat]+'">'+label+'</div></div>';
    }
    h+='<div class="pd-gallery">'+imgOrPat(p.images.main,p.patterns[0],p.name,true)+imgOrPat(p.images.d1,p.patterns[1],'Detail 01')+imgOrPat(p.images.d2,p.patterns[2],'Detail 02')+'</div>';
    h+='<div class="pd-tags">';p.tags.forEach(function(t){h+='<span class="pd-tag">'+t+'</span>'});h+='</div>';
    h+='<div class="pd-section"><div class="pd-section-title">Essence</div><div class="pd-section-body">'+p.desc+'</div></div>';
    h+='<div class="pd-meta"><div class="pd-meta-item"><span class="pd-meta-label">Field</span><span class="pd-meta-value">'+p.meta.field+'</span></div><div class="pd-meta-item"><span class="pd-meta-label">Method</span><span class="pd-meta-value">'+p.meta.method+'</span></div><div class="pd-meta-item"><span class="pd-meta-label">Period</span><span class="pd-meta-value">'+p.meta.period+'</span></div></div>';
    return h;
  });
  function openProject(idx){
    if(!prebuilt[idx])return;
    window._alPaused=true;
    document.body.classList.add('pd-open');
    inner.innerHTML=prebuilt[idx];
    inner.scrollTop=0;
    requestAnimationFrame(function(){detail.classList.add('show')});
  }
  function closeProject(){detail.classList.remove('show');document.body.classList.remove('pd-open');setTimeout(function(){window._alPaused=false},650)}
  closeBtn.addEventListener('click',closeProject);
  detail.querySelector('.project-detail-bg').addEventListener('click',closeProject);
  document.addEventListener('keydown',function(e){if(e.key==='Escape'&&detail.classList.contains('show'))closeProject()});
  /* Mouse proximity glow on map */
  var mapCanvas=document.getElementById('archiveMapCanvas');
  if(mapCanvas){
    var mapNodes=mapCanvas.querySelectorAll('.map-node');
    mapCanvas.addEventListener('mousemove',function(e){
      var cr=mapCanvas.getBoundingClientRect();
      var mx=e.clientX-cr.left,my=e.clientY-cr.top;
      mapNodes.forEach(function(node){
        var nr=node.getBoundingClientRect();
        var nx=nr.left-cr.left+nr.width/2,ny=nr.top-cr.top+nr.height/2;
        var dist=Math.sqrt((mx-nx)*(mx-nx)+(my-ny)*(my-ny));
        var maxD=180,glow=Math.max(0,1-dist/maxD);
        var dot=node.querySelector('.map-dot');
        var glowEl=node.querySelector('.map-dot-glow');
        if(glow>0){
          var s=1+glow*0.8;
          var isDk=document.body.classList.contains('dark-mode');
          var shadow=isDk?'0 0 '+(glow*30)+'px rgba(255,255,255,'+(glow*0.4)+')':'0 0 '+(glow*25)+'px rgba(0,0,0,'+(glow*0.2)+')';
          dot.style.transform='scale('+s+')';
          dot.style.boxShadow=shadow;
          if(glowEl)glowEl.style.transform='translate(-50%,-50%) scale('+(1.5+glow*1.5)+')';
        } else {
          dot.style.transform='';dot.style.boxShadow='';
          if(glowEl)glowEl.style.transform='';
        }
      });
    });
    mapCanvas.addEventListener('mouseleave',function(){
      mapNodes.forEach(function(node){
        var dot=node.querySelector('.map-dot');
        var glowEl=node.querySelector('.map-dot-glow');
        dot.style.transform='';dot.style.boxShadow='';
        if(glowEl)glowEl.style.transform='';
      });
    });
  }

  document.querySelectorAll('.map-node').forEach(function(node){
    node.addEventListener('click',function(){openProject(parseInt(node.getAttribute('data-node')))});
  });
})();

/* SCROLL PARALLAX + HIDE SCROLL INDICATOR (GSAP-powered) */
(function(){
  var aboutPage=document.getElementById('page-about');
  if(!aboutPage)return;
  var heroLogo=document.getElementById('hlLogo');
  var heroBottom=document.querySelector('.hl-bottom');
  var scrollIndHidden=false;

  if(typeof gsap!=='undefined'&&typeof ScrollTrigger!=='undefined'){
    /* GSAP parallax for hero elements */
    if(heroLogo){
      gsap.to(heroLogo,{
        y:-120,opacity:0,ease:'none',
        scrollTrigger:{trigger:'.hero-top',scroller:aboutPage,start:'top top',end:'bottom top',scrub:0.5}
      });
    }
    if(heroBottom){
      gsap.to(heroBottom,{
        y:-80,opacity:0,ease:'none',
        scrollTrigger:{trigger:'.hero-top',scroller:aboutPage,start:'top top',end:'60% top',scrub:0.5}
      });
    }
    /* Hide scroll indicator on scroll */
    ScrollTrigger.create({
      scroller:aboutPage,trigger:'.hero-top',start:'top -10px',
      onEnter:function(){
        var scrollInd=document.querySelector('.scroll-indicator');
        if(scrollInd&&!scrollIndHidden){
          gsap.to(scrollInd,{opacity:0,y:10,duration:0.5,ease:'power2.in',onComplete:function(){scrollInd.style.display='none'}});
          scrollIndHidden=true;
        }
      }
    });
  }else{
    /* Fallback */
    aboutPage.addEventListener('scroll',function(){
      var st=aboutPage.scrollTop,vh=window.innerHeight,progress=Math.min(st/(vh*0.5),1);
      if(heroLogo){heroLogo.style.opacity=Math.max(1-progress*1.5,0);heroLogo.style.transform='translateY('+-st*0.3+'px)'}
      if(heroBottom){heroBottom.style.opacity=Math.max(1-progress*1.5,0);heroBottom.style.transform='translateY('+-st*0.2+'px)'}
      if(!scrollIndHidden&&st>10){var scrollInd=document.querySelector('.scroll-indicator');if(scrollInd){scrollInd.style.opacity='0';setTimeout(function(){scrollInd.style.display='none'},600);scrollIndHidden=true}}
    });
  }
})();

/* ESC */
window.addEventListener('keydown',function(e){if(e.key==='Escape'){document.querySelectorAll('.modal-overlay.show').forEach(function(m){closeModal(m.id)});collapseChat()}});

/* HAMBURGER MENU */
var hamburger=document.getElementById('navHamburger');
var mobileMenu=document.getElementById('navMobileMenu');
if(hamburger&&mobileMenu){
  hamburger.addEventListener('click',function(){hamburger.classList.toggle('open');mobileMenu.classList.toggle('show')});
  mobileMenu.querySelectorAll('li[data-page]').forEach(function(li){
    li.addEventListener('click',function(){goPage(li.getAttribute('data-page'));hamburger.classList.remove('open');mobileMenu.classList.remove('show')});
  });
  var mobileSignIn=document.getElementById('mobileSignIn');
  if(mobileSignIn)mobileSignIn.addEventListener('click',function(){hamburger.classList.remove('open');mobileMenu.classList.remove('show');document.getElementById('loginOverlay').classList.add('show')});
}

/* ESSENCE PROMPTS */
var epSection=document.getElementById('essencePrompts');
var epUnlock=document.getElementById('epUnlock');
if(epUnlock)epUnlock.addEventListener('click',function(){document.getElementById('pricingOverlay').classList.add('show')});
var edGenBtn=document.getElementById('edGenBtn');
if(edGenBtn)edGenBtn.addEventListener('click',generateEssenceDocument);
})();
</script>
<script>
(function(){
'use strict';
try{
var container=document.getElementById('canvas-container');if(!container||typeof THREE==='undefined')return;
var _dk=document.body.classList.contains('dark-mode');
var _bgH=_dk?0x0a0a0a:0xfafaf8;
var scene=new THREE.Scene();scene.background=new THREE.Color(_bgH);scene.fog=new THREE.FogExp2(_bgH,0.00025);
var camera=new THREE.PerspectiveCamera(55,innerWidth/innerHeight,0.1,2000);camera.position.z=420;
var renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});renderer.setSize(innerWidth,innerHeight);renderer.setPixelRatio(Math.min(devicePixelRatio,2));renderer.toneMapping=THREE.ACESFilmicToneMapping;renderer.outputEncoding=THREE.sRGBEncoding;container.appendChild(renderer.domElement);

/* FBO — 모바일 대응 SIZE */
var _isMobile=innerWidth<768;
var SIZE=_isMobile?280:400;
var N=SIZE*SIZE;
function createDataTex(data){var t=new THREE.DataTexture(data,SIZE,SIZE,THREE.RGBAFormat,THREE.FloatType);t.needsUpdate=true;return t}

/* 초기 위치 — 넓게 분산 */
var initPosData=new Float32Array(N*4);
for(var i=0;i<N;i++){var phi=Math.acos(1-2*(i+0.5)/N);var theta=Math.PI*(1+Math.sqrt(5))*i;var u=Math.random();var R=20+u*u*120;initPosData[i*4]=Math.sin(phi)*Math.cos(theta)*R;initPosData[i*4+1]=Math.cos(phi)*R;initPosData[i*4+2]=Math.sin(phi)*Math.sin(theta)*R;initPosData[i*4+3]=Math.random()}
var initPosTex=createDataTex(initPosData);

var silTargetData=new Float32Array(N*4);
for(var _si=0;_si<N;_si++){var _u=Math.random();var _r=15+_u*_u*100;var _a=Math.random()*6.2831;var _b=Math.random()*3.1416;silTargetData[_si*4]=Math.sin(_b)*Math.cos(_a)*_r;silTargetData[_si*4+1]=Math.cos(_b)*_r*0.7;silTargetData[_si*4+2]=Math.sin(_b)*Math.sin(_a)*_r*0.4;silTargetData[_si*4+3]=-1.0}
var silTargetTex=createDataTex(silTargetData);

var rtOpts={minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,type:THREE.FloatType};
var rtA=new THREE.WebGLRenderTarget(SIZE,SIZE,rtOpts);var rtB=new THREE.WebGLRenderTarget(SIZE,SIZE,rtOpts);

/* 시뮬레이션 셰이더 */
var simVert='varying vec2 vUv;void main(){vUv=uv;gl_Position=vec4(position,1.0);}';
var simFrag=[
'precision highp float;','varying vec2 vUv;',
'uniform sampler2D uPositions;','uniform sampler2D uInitPositions;','uniform sampler2D uSilTargets;',
'uniform float uTime;','uniform float uMorph;','uniform float uRotAngle;','uniform vec3 uMouse3D;','uniform float uMouseActive;',
'vec3 mod289(vec3 x){return x-floor(x/289.0)*289.0;}',
'vec4 mod289v4(vec4 x){return x-floor(x/289.0)*289.0;}',
'vec4 permute(vec4 x){return mod289v4(((x*34.0)+1.0)*x);}',
'vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-0.85373472095314*r;}',
'float snoise3(vec3 v){',
'  const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);',
'  vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);',
'  vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;',
'  vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);',
'  vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;',
'  i=mod289(i);',
'  vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));',
'  float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;',
'  vec4 j=p-49.0*floor(p*ns.z*ns.z);',
'  vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);',
'  vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;',
'  vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);',
'  vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;',
'  vec4 sh=-step(h,vec4(0.0));',
'  vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;',
'  vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);',
'  vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));',
'  p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;',
'  vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);',
'  m=m*m;return 42.0*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));',
'}','',
'vec3 curlNoise(vec3 p,float t){',
'  float e=0.1;float n1,n2;vec3 curl;',
'  n1=snoise3(vec3(p.x,p.y+e,p.z)+t);n2=snoise3(vec3(p.x,p.y-e,p.z)+t);curl.x=(n1-n2)/(2.0*e);',
'  n1=snoise3(vec3(p.x,p.y,p.z+e)+t*1.1);n2=snoise3(vec3(p.x,p.y,p.z-e)+t*1.1);curl.x-=(n1-n2)/(2.0*e);',
'  n1=snoise3(vec3(p.x,p.y,p.z+e)+t*0.9);n2=snoise3(vec3(p.x,p.y,p.z-e)+t*0.9);curl.y=(n1-n2)/(2.0*e);',
'  n1=snoise3(vec3(p.x+e,p.y,p.z)+t*1.2);n2=snoise3(vec3(p.x-e,p.y,p.z)+t*1.2);curl.y-=(n1-n2)/(2.0*e);',
'  n1=snoise3(vec3(p.x+e,p.y,p.z)+t*0.8);n2=snoise3(vec3(p.x-e,p.y,p.z)+t*0.8);curl.z=(n1-n2)/(2.0*e);',
'  n1=snoise3(vec3(p.x,p.y+e,p.z)+t*1.15);n2=snoise3(vec3(p.x,p.y-e,p.z)+t*1.15);curl.z-=(n1-n2)/(2.0*e);',
'  return curl;',
'}','',
'void main(){',
'  vec4 cur=texture2D(uPositions,vUv);vec4 init=texture2D(uInitPositions,vUv);vec4 target=texture2D(uSilTargets,vUv);',
'  float seed=init.w;vec3 pos=cur.xyz;',
'  float mp=uMorph*uMorph*(3.0-2.0*uMorph);',
'  vec3 nDir=normalize(init.xyz);',
'  float surfN=snoise3(nDir*1.8+vec3(uTime*0.35))+snoise3(nDir*3.5+vec3(-uTime*0.2,uTime*0.25,seed*0.04))*0.35;',
'  float breathe=sin(uTime*0.35)*0.08;',
'  float targetR=length(init.xyz)*(1.0+surfN*0.22+breathe);',
'  vec3 homePos=nDir*targetR;',
'  float cR=cos(uRotAngle);float sR=sin(uRotAngle);',
'  homePos=vec3(homePos.x*cR-homePos.z*sR,homePos.y,homePos.x*sR+homePos.z*cR);',
'  vec3 curlP=pos*0.012;vec3 curl=curlNoise(curlP,uTime*0.15+seed*5.0);',
'  vec3 posNorm=normalize(pos+0.001);vec3 tangentCurl=curl-posNorm*dot(curl,posNorm);',
'  vec3 curlForce=tangentCurl*3.0*(1.0-mp);',
'  vec3 homeForce=(homePos-pos)*0.08*(1.0-mp);',
'  vec3 silPos=target.xyz;float silDensity=target.w;',
'  float isAmbient=step(silDensity,-0.5);vec3 silForce=vec3(0.0);',
'  float isOrbit=step(-0.5,silDensity)*step(silDensity,-0.01);',
'  if(isAmbient<0.5 && isOrbit<0.5){',
'    float looseness=(1.0-silDensity)*(1.0-silDensity);',
'    float pn=snoise3(vec3(seed*50.0,seed*30.0,uTime*0.10));',
'    silPos.x+=pn*looseness*1.5*mp;silPos.y+=sin(uTime*0.18+seed*20.0)*looseness*0.8*mp;silPos.z+=cos(uTime*0.15+seed*15.0)*looseness*1.0*mp;',
'    float figPhase=silPos.x*0.02+silPos.y*0.015;',
'    float swayX=sin(uTime*0.12+figPhase)*2.5+sin(uTime*0.07+figPhase*1.3)*1.2;',
'    float swayY=cos(uTime*0.10+figPhase*0.8)*1.8+sin(uTime*0.06+figPhase*0.5)*0.8;',
'    float swayZ=sin(uTime*0.09+figPhase*1.1)*1.5;',
'    float swayAmt=0.3+looseness*0.7;',
'    silPos.x+=swayX*swayAmt*mp;silPos.y+=swayY*swayAmt*mp;silPos.z+=swayZ*swayAmt*mp;',
'    float attractStr=0.06+silDensity*0.40;silForce=(silPos-pos)*attractStr*mp;',
'  }else if(isOrbit>0.5){',
'    float orbitDist=abs(silDensity);float spd1=0.06+seed*0.08;float spd2=0.04+orbitDist*0.12;',
'    float a1=uTime*spd1+seed*6.2831;float a2=uTime*spd2+seed*3.14+orbitDist*10.0;',
'    float oR=8.0+orbitDist*30.0;',
'    vec3 orbitOffset=vec3(cos(a1)*oR+sin(a2*0.3)*oR*0.4,sin(a1*0.6+seed*2.0)*oR*0.45+cos(a2*0.5)*oR*0.2,sin(a2*0.7+seed)*oR*0.5+cos(a1*0.4)*oR*0.15);',
'    vec3 orbitTarget=silPos+orbitOffset*mp;silForce=(orbitTarget-pos)*0.018*mp;silForce+=tangentCurl*3.0*mp;',
'  }else{',
'    float oAngle=uTime*(0.03+seed*0.05)+seed*6.28;float oR=3.0+seed*8.0;',
'    vec3 drift=silPos+vec3(cos(oAngle)*oR,sin(oAngle*0.6+seed)*oR*0.25,sin(oAngle*0.8)*oR);silForce=(drift-pos)*0.02*mp;',
'  }',
'  if(uMouseActive>0.5){vec3 toP=pos-uMouse3D;float mDist=length(toP);float mRad=mix(50.0,120.0,mp);if(mDist<mRad&&mDist>0.1){float push=1.0-mDist/mRad;push=push*push*push;pos+=normalize(toP)*push*12.0;}}',
'  pos+=curlForce+homeForce+silForce;gl_FragColor=vec4(pos,cur.w);',
'}'
].join('\n');

var simMat=new THREE.ShaderMaterial({vertexShader:simVert,fragmentShader:simFrag,uniforms:{uPositions:{value:null},uInitPositions:{value:initPosTex},uSilTargets:{value:silTargetTex},uTime:{value:0},uMorph:{value:0},uRotAngle:{value:0},uMouse3D:{value:new THREE.Vector3()},uMouseActive:{value:0}}});
var simScene=new THREE.Scene();var simCamera=new THREE.OrthographicCamera(-1,1,1,-1,0,1);
simScene.add(new THREE.Mesh(new THREE.PlaneGeometry(2,2),simMat));

var initMat=new THREE.ShaderMaterial({vertexShader:simVert,fragmentShader:'precision highp float;varying vec2 vUv;uniform sampler2D uTex;void main(){gl_FragColor=texture2D(uTex,vUv);}',uniforms:{uTex:{value:initPosTex}}});
var initScene=new THREE.Scene();initScene.add(new THREE.Mesh(new THREE.PlaneGeometry(2,2),initMat));
renderer.setRenderTarget(rtA);renderer.render(initScene,simCamera);renderer.setRenderTarget(rtB);renderer.render(initScene,simCamera);renderer.setRenderTarget(null);
for(var _w=0;_w<60;_w++){simMat.uniforms.uPositions.value=(_w%2===0)?rtA.texture:rtB.texture;simMat.uniforms.uTime.value=_w*0.001;renderer.setRenderTarget((_w%2===0)?rtB:rtA);renderer.render(simScene,simCamera);renderer.setRenderTarget(null)}

/* 렌더 셰이더 */
var renderVert=[
'attribute vec2 aRef;','uniform sampler2D uPositions;','uniform sampler2D uSilTargets;',
'uniform float uPixelRatio;','uniform float uMorph;','uniform float uDark;',
'varying float vAlpha;','varying float vDensity;','varying float vMorph;','',
'void main(){',
'  vec4 posData=texture2D(uPositions,aRef);vec4 silData=texture2D(uSilTargets,aRef);',
'  vec3 pos=posData.xyz;vec4 mvPos=modelViewMatrix*vec4(pos,1.0);gl_Position=projectionMatrix*mvPos;',
'  float mp=uMorph*uMorph*(3.0-2.0*uMorph);vMorph=mp;',
'  float density=silData.w;float absDen=max(density,0.0);float isAmb=step(density,-0.5);',
'  float isOrb=step(-0.5,density)*step(density,-0.01);',
'  float coreSize=3.0;float figSize=1.8+absDen*1.2;float orbSize=1.2+abs(density)*1.6;float ambSize=0.8;',
'  float unmaskSize=mix(mix(figSize,orbSize,isOrb),ambSize,isAmb);float sz=mix(coreSize,unmaskSize,mp);',
'  float depthScale=340.0/max(-mvPos.z,100.0);gl_PointSize=sz*uPixelRatio*depthScale;gl_PointSize=max(gl_PointSize,0.5);',
'  float coreAlpha=mix(0.15,0.35,posData.w);float figAlpha=0.2+absDen*0.35;',
'  float orbAlpha=0.06+abs(density)*0.18;float ambAlpha=0.03;',
'  float unmaskAlpha=mix(mix(figAlpha,orbAlpha,isOrb),ambAlpha,isAmb);',
'  vAlpha=mix(coreAlpha,max(unmaskAlpha,0.01),mp);vDensity=density;',
'}'
].join('\n');

var renderFrag=[
'varying float vAlpha;','varying float vDensity;','varying float vMorph;','uniform float uDark;',
'void main(){',
'  float d=length(gl_PointCoord-0.5);if(d>0.5)discard;',
'  float absDen=max(vDensity,0.0);',
'  float core=1.0-smoothstep(0.0,0.12,d);float glow=1.0-smoothstep(0.0,0.5,d);glow*=glow;float coreShape=core*0.6+glow*0.5;',
'  float sharpness=10.0+absDen*18.0;float figShape=exp(-d*d*sharpness);',
'  float shape=mix(coreShape,figShape,vMorph);float alpha=shape*vAlpha;if(alpha<0.002)discard;',
'  float lum=mix(0.0,0.65,uDark);gl_FragColor=vec4(vec3(lum),alpha);',
'}'
].join('\n');

var pGeo=new THREE.BufferGeometry();var refs=new Float32Array(N*2);var dummyPos=new Float32Array(N*3);
for(var i=0;i<N;i++){refs[i*2]=(i%SIZE)/SIZE;refs[i*2+1]=Math.floor(i/SIZE)/SIZE}
pGeo.setAttribute('position',new THREE.BufferAttribute(dummyPos,3));pGeo.setAttribute('aRef',new THREE.BufferAttribute(refs,2));

var renderUniforms={uPositions:{value:rtA.texture},uSilTargets:{value:silTargetTex},uPixelRatio:{value:Math.min(devicePixelRatio,2)},uMorph:{value:0},uDark:{value:0}};
var renderMat=new THREE.ShaderMaterial({vertexShader:renderVert,fragmentShader:renderFrag,uniforms:renderUniforms,transparent:true,depthWrite:false,blending:THREE.NormalBlending});
var pts=new THREE.Points(pGeo,renderMat);scene.add(pts);

/* 멀티 피겨 컴포지션 */
var _budgetMul=_isMobile?0.5:1.0;
var FIGURES=[
  {src:'./images/fig-hand.jpg',cx:-0.04,cy:0.02,h3d:115,budget:Math.floor(52000*_budgetMul)},
  {src:'./images/fig-press.jpg',cx:0.20,cy:0.04,h3d:105,budget:Math.floor(46000*_budgetMul)},
  {src:'./images/fig-stipple.jpg',cx:-0.26,cy:-0.12,h3d:75,budget:Math.floor(26000*_budgetMul)},
  {src:'./images/fig-stipple.jpg',cx:0.35,cy:-0.20,h3d:58,budget:Math.floor(18000*_budgetMul)},
  {src:'./images/fig-stipple.jpg',cx:0.52,cy:0.13,h3d:42,budget:Math.floor(13000*_budgetMul)},
  {src:'./images/fig-press.jpg',cx:-0.50,cy:0.04,h3d:28,budget:Math.floor(6000*_budgetMul)}
];
var totalBudget=0;for(var fi=0;fi<FIGURES.length;fi++)totalBudget+=FIGURES[fi].budget;
var DISSOLVE_BUDGET=Math.floor(N*0.22);var AMBIENT_BUDGET=N-totalBudget-DISSOLVE_BUDGET;

function sampleFigure(px,W,H,fig,offset){
  var sumW=0,sumX=0,sumY=0;
  for(var y=0;y<H;y++)for(var x=0;x<W;x++){var idx=(y*W+x)*4;var dk=1-(px[idx]+px[idx+1]+px[idx+2])/(3*255);if(dk>0.05){sumX+=x*dk;sumY+=y*dk;sumW+=dk}}
  if(sumW<1)return 0;var cenX=sumX/sumW,cenY=sumY/sumW;
  var maxR=0;for(var y=0;y<H;y++)for(var x=0;x<W;x++){var idx=(y*W+x)*4;var dk=1-(px[idx]+px[idx+1]+px[idx+2])/(3*255);if(dk>0.10){var d=Math.sqrt((x-cenX)*(x-cenX)+(y-cenY)*(y-cenY));if(d>maxR)maxR=d}}
  var vigR=maxR*1.7,s3d=fig.h3d/H,worldSpan=320,offX=fig.cx*worldSpan,offY=fig.cy*worldSpan*0.6,offZ=(Math.random()-0.5)*15,sizeRatio=fig.h3d/155;
  var bodyTarget=Math.floor(fig.budget*0.60),placed=0,attempts=0,maxAtt=fig.budget*600;
  while(placed<bodyTarget&&attempts<maxAtt){var ix=Math.floor(Math.random()*W),iy=Math.floor(Math.random()*H);var idx=(iy*W+ix)*4;var darkness=1-(px[idx]+px[idx+1]+px[idx+2])/(3*255);var dx=(ix-cenX)/vigR,dy=(iy-cenY)/vigR,radial=Math.sqrt(dx*dx+dy*dy);var vignette=Math.max(0,1-radial);vignette=vignette*vignette*vignette;var prob=darkness*darkness*vignette*4.5;if(darkness>0.03&&Math.random()<prob){var x3d=(ix-cenX)*s3d+offX,y3d=-(iy-cenY)*s3d+offY;var edgeness=(1-darkness)*(1+radial*2),sMul=fig.scatterMul||1.0,scatter=edgeness*edgeness*5.0*sizeRatio*sMul;x3d+=(Math.random()-0.5)*scatter;y3d+=(Math.random()-0.5)*scatter;var zRange=(6*Math.sqrt(darkness)+scatter*0.3)*sizeRatio,z3d=(Math.random()*2-1)*zRange+offZ;var pi=offset+placed;silTargetData[pi*4]=x3d;silTargetData[pi*4+1]=y3d;silTargetData[pi*4+2]=z3d;silTargetData[pi*4+3]=Math.pow(darkness,0.4)*vignette;placed++}attempts++}
  var dissTarget=Math.floor(fig.budget*0.10),dissPlaced=0;attempts=0;
  while(dissPlaced<dissTarget&&attempts<maxAtt){var ix=Math.floor(Math.random()*W),iy=Math.floor(Math.random()*H);var idx=(iy*W+ix)*4;var darkness=1-(px[idx]+px[idx+1]+px[idx+2])/(3*255);if(darkness>0.02&&darkness<0.40){var pushR=(6+Math.random()*45)*sizeRatio,pushA=Math.random()*Math.PI*2;var x3d=(ix-cenX)*s3d+offX+Math.cos(pushA)*pushR,y3d=-(iy-cenY)*s3d+offY+Math.sin(pushA)*pushR*0.7,z3d=(Math.random()-0.5)*pushR*1.2+offZ;var pi=offset+placed+dissPlaced;silTargetData[pi*4]=x3d;silTargetData[pi*4+1]=y3d;silTargetData[pi*4+2]=z3d;silTargetData[pi*4+3]=darkness*0.15;dissPlaced++}attempts++}
  var orbitTarget=fig.budget-bodyTarget-dissTarget,orbitPlaced=0;attempts=0;
  while(orbitPlaced<orbitTarget&&attempts<maxAtt){var ix=Math.floor(Math.random()*W),iy=Math.floor(Math.random()*H);var idx=(iy*W+ix)*4;var darkness=1-(px[idx]+px[idx+1]+px[idx+2])/(3*255);if(darkness>0.08){var x3d=(ix-cenX)*s3d+offX,y3d=-(iy-cenY)*s3d+offY;var orbitR=(3+Math.random()*12)*sizeRatio,orbitA=Math.random()*Math.PI*2;x3d+=Math.cos(orbitA)*orbitR;y3d+=Math.sin(orbitA)*orbitR*0.7;var z3d=(Math.random()-0.5)*orbitR*1.5+offZ;var pi=offset+placed+dissPlaced+orbitPlaced;silTargetData[pi*4]=x3d;silTargetData[pi*4+1]=y3d;silTargetData[pi*4+2]=z3d;silTargetData[pi*4+3]=-(0.05+Math.random()*0.35);orbitPlaced++}attempts++}
  return placed+dissPlaced+orbitPlaced;
}

function buildFromImage(){
  var srcSet={};for(var fi=0;fi<FIGURES.length;fi++)srcSet[FIGURES[fi].src]=true;
  var srcList=Object.keys(srcSet);var loaded={};var loadCount=0;
  function onAllLoaded(){
    var placed=0;
    for(var fi=0;fi<FIGURES.length;fi++){var fig=FIGURES[fi];var img=loaded[fig.src];if(!img)continue;
      var maxDim=Math.max(400,Math.min(600,fig.h3d*4));var sc=maxDim/Math.max(img.width,img.height);var W=Math.round(img.width*sc),H=Math.round(img.height*sc);
      var cvs=document.createElement('canvas');cvs.width=W;cvs.height=H;var ctx=cvs.getContext('2d');ctx.translate(W,0);ctx.scale(-1,1);ctx.drawImage(img,0,0,W,H);var imgData=ctx.getImageData(0,0,W,H);
      var count=sampleFigure(imgData.data,W,H,fig,placed);console.log('[Aletheia] Fig '+fi+': '+count+'/'+fig.budget);placed+=count}
    var dissEnd=placed+DISSOLVE_BUDGET;
    while(placed<dissEnd){var rfi=Math.floor(Math.random()*FIGURES.length);var rf=FIGURES[rfi];var worldSpan=320;var r=Math.random();var bx,by,bz;
      if(r<0.35){bx=rf.cx*worldSpan+(Math.random()-0.5)*rf.h3d*1.2;by=rf.cy*worldSpan*0.6+(Math.random()-0.5)*rf.h3d*0.8;bz=(Math.random()-0.5)*rf.h3d*0.5}
      else if(r<0.70){bx=rf.cx*worldSpan+(Math.random()-0.5)*180;by=rf.cy*worldSpan*0.6+(Math.random()-0.5)*120;bz=(Math.random()-0.5)*50}
      else{var rfi2=Math.floor(Math.random()*FIGURES.length);var rf2=FIGURES[rfi2];var ang=Math.random()*Math.PI*2;var dist=60+Math.random()*160;bx=rf2.cx*worldSpan+Math.cos(ang)*dist;by=rf2.cy*worldSpan*0.6+Math.sin(ang)*dist*0.7;bz=(Math.random()-0.5)*70}
      silTargetData[placed*4]=bx;silTargetData[placed*4+1]=by;silTargetData[placed*4+2]=bz;silTargetData[placed*4+3]=0.02+Math.random()*0.10;placed++}
    while(placed<N){var rfa=Math.floor(Math.random()*FIGURES.length);var rff=FIGURES[rfa];var aAng=Math.random()*Math.PI*2;var aDist=20+Math.random()*200;
      silTargetData[placed*4]=rff.cx*320+Math.cos(aAng)*aDist;silTargetData[placed*4+1]=rff.cy*320*0.6+Math.sin(aAng)*aDist*0.7;silTargetData[placed*4+2]=(Math.random()-0.5)*80;silTargetData[placed*4+3]=-1.0;placed++}
    silTargetTex=createDataTex(silTargetData);simMat.uniforms.uSilTargets.value=silTargetTex;renderUniforms.uSilTargets.value=silTargetTex;
    console.log('[Aletheia] Composition ready:',N,'particles across',FIGURES.length,'figures')}
  for(var si=0;si<srcList.length;si++){(function(src){var img=new Image();img.onload=function(){loaded[src]=img;loadCount++;if(loadCount===srcList.length)onAllLoaded()};img.onerror=function(){console.warn('[Aletheia] Failed to load:',src);loadCount++;if(loadCount===srcList.length)onAllLoaded()};img.src=src})(srcList[si])}
}
buildFromImage();

/* 포스트프로세싱 */
scene.add(new THREE.AmbientLight(0xffffff,1.0));
var bloomPass=new THREE.UnrealBloomPass(new THREE.Vector2(innerWidth,innerHeight),0.05,0.4,0.98);
var composer=new THREE.EffectComposer(renderer);composer.addPass(new THREE.RenderPass(scene,camera));composer.addPass(bloomPass);

/* _alScene 인터페이스 유지 */
var cg=new THREE.Group();scene.add(cg);
var _c1Mat=new THREE.MeshBasicMaterial({color:_dk?0xffffff:0x000000,wireframe:true,transparent:true,opacity:0,visible:false});
var _c2Mat=new THREE.MeshBasicMaterial({color:_dk?0xaaaaaa:0x555555,wireframe:true,transparent:true,opacity:0,visible:false});
cg.add(new THREE.Mesh(new THREE.IcosahedronGeometry(3.8,5),_c1Mat));cg.add(new THREE.Mesh(new THREE.IcosahedronGeometry(5,2),_c2Mat));
function createPT(){}
window._alScene={scene:scene,pts:pts,c1:cg.children[0],c2:cg.children[1],createPT:createPT,unmaskMode:false,morphLevel:1.0,_c1Mat:_c1Mat,_c2Mat:_c2Mat};

/* 메인 루프 */
var time=0,currentMorph=0,currentDark=_dk?1:0,flip=false,rotAngle=0;
var mx=0,my=0;
var _mouseNDC=new THREE.Vector2();var _mouseActive=false,_mouseTimer=null;
document.addEventListener('mousemove',function(e){
  mx=(e.clientX-innerWidth/2)*0.05;my=(e.clientY-innerHeight/2)*0.05;
  _mouseNDC.x=(e.clientX/innerWidth)*2-1;_mouseNDC.y=-(e.clientY/innerHeight)*2+1;
  _mouseActive=true;clearTimeout(_mouseTimer);_mouseTimer=setTimeout(function(){_mouseActive=false},200)});
var _raycaster=new THREE.Raycaster();

(function animate(){
  requestAnimationFrame(animate);
  if(window._alPaused)return;
  time+=0.0018;rotAngle+=0.0002;
  var als=window._alScene;
  var targetMorph=als.unmaskMode?als.morphLevel:0;
  currentMorph+=(targetMorph-currentMorph)*0.012;
  var targetDark=document.body.classList.contains('dark-mode')?1:0;
  currentDark+=(targetDark-currentDark)*0.06;
  if(currentDark>0.5&&renderMat.blending!==THREE.AdditiveBlending){renderMat.blending=THREE.AdditiveBlending;renderMat.needsUpdate=true}
  if(currentDark<=0.5&&renderMat.blending!==THREE.NormalBlending){renderMat.blending=THREE.NormalBlending;renderMat.needsUpdate=true}
  simMat.uniforms.uPositions.value=flip?rtB.texture:rtA.texture;
  simMat.uniforms.uTime.value=time;simMat.uniforms.uMorph.value=currentMorph;simMat.uniforms.uRotAngle.value=rotAngle;
  if(_mouseActive){_raycaster.setFromCamera(_mouseNDC,camera);var rd=_raycaster.ray.direction,ro=_raycaster.ray.origin;
    var t=-ro.z/rd.z;if(t<0)t=420;simMat.uniforms.uMouse3D.value.set(ro.x+rd.x*t,ro.y+rd.y*t,0);simMat.uniforms.uMouseActive.value=1}
  else{simMat.uniforms.uMouseActive.value=0}
  renderer.setRenderTarget(flip?rtA:rtB);renderer.render(simScene,simCamera);renderer.setRenderTarget(null);
  renderUniforms.uPositions.value=flip?rtA.texture:rtB.texture;renderUniforms.uMorph.value=currentMorph;renderUniforms.uDark.value=currentDark;flip=!flip;
  var _bgR=0.980,_bgG=0.980,_bgB=0.973;
  var bgR=_bgR*(1-currentDark)+0.04*currentDark,bgG=_bgG*(1-currentDark)+0.04*currentDark,bgB=_bgB*(1-currentDark)+0.04*currentDark;
  scene.background.setRGB(bgR,bgG,bgB);scene.fog.color.setRGB(bgR,bgG,bgB);
  bloomPass.strength=currentDark>0.5?(0.03+currentMorph*0.08):(0.01+currentMorph*0.03);
  composer.render()})();

addEventListener('resize',function(){camera.aspect=innerWidth/innerHeight;camera.updateProjectionMatrix();renderer.setSize(innerWidth,innerHeight);composer.setSize(innerWidth,innerHeight);renderUniforms.uPixelRatio.value=Math.min(devicePixelRatio,2)});
console.log('[Aletheia] Multi-figure composition —',FIGURES.length,'figures,',N,'particles');
}catch(e){console.log('Three.js FBO skipped:',e)}
})();
</script>
<!-- ===== URP In-Chatbox Script ===== -->
<script>
(function(){
  var SYSTEM_FOUNDER='founder_analysis';
  var slider=document.getElementById('cbSlider');
  var urpBody=document.getElementById('urpBody');
  var founderData=null;
  var founderLoading=false;

  function openURP(){slider.classList.add('show-urp')}
  function closeURP(){slider.classList.remove('show-urp')}

  document.getElementById('urpBack').addEventListener('click',closeURP);
  document.getElementById('urpPrint').addEventListener('click',function(){printURP()});

  /* Build panel from data */
  function buildPanel(d){
    var h='';
    h+='<div class="urp-name">'+(d.name||'분석 결과')+'</div>';
    h+='<div class="urp-role">'+(d.sector?'Founder · '+d.sector:'Essence Analysis')+'</div>';
    if(d.tags&&d.tags.length){
      h+='<div class="urp-tags">';
      d.tags.forEach(function(t){h+='<span class="urp-tag">'+t+'</span>'});
      h+='</div>';
    }
    if(d.core){
      h+='<div class="urp-card"><div class="urp-card-title">핵심 가치</div>';
      h+='<div class="urp-card-text">'+d.core+'</div>';
      if(d.coreDesc)h+='<div class="urp-card-sub">'+d.coreDesc+'</div>';
      h+='</div>';
    }
    if(d.energy&&(d.energy.up||d.energy.down)){
      h+='<div class="urp-card"><div class="urp-card-title">에너지 지도</div>';
      if(d.energy.up)h+='<div class="urp-card-text" style="color:#22c55e;font-size:11px">&#8593; '+d.energy.up+'</div>';
      if(d.energy.down)h+='<div class="urp-card-text" style="color:#ef4444;font-size:11px;margin-top:4px">&#8595; '+d.energy.down+'</div>';
      h+='</div>';
    }
    if(d.narrative){
      h+='<div class="urp-card"><div class="urp-card-title">서사</div>';
      h+='<div class="urp-card-text">'+d.narrative+'</div></div>';
    }
    h+='<div class="urp-divider">DEEP ANALYSIS</div>';
    if(d.golden&&d.golden.why){
      h+='<div class="urp-card"><div class="urp-card-title">Golden Circle</div>';
      h+='<svg class="urp-golden-svg" viewBox="0 0 140 140"><circle cx="70" cy="70" r="64" fill="none" stroke="rgba(0,0,0,0.06)" stroke-width="1"/><circle cx="70" cy="70" r="42" fill="none" stroke="rgba(0,0,0,0.06)" stroke-width="1"/><circle cx="70" cy="70" r="20" fill="#1a1a1a"/><text x="70" y="73" text-anchor="middle" fill="#fff" font-size="7" font-weight="600" letter-spacing="1">WHY</text><text x="70" y="42" text-anchor="middle" fill="#aaa" font-size="6" letter-spacing="1">HOW</text><text x="70" y="20" text-anchor="middle" fill="#ccc" font-size="6" letter-spacing="1">WHAT</text></svg>';
      h+='<div style="text-align:center"><span style="display:inline-block;background:#1a1a1a;color:#fff;padding:4px 12px;border-radius:4px;font-size:11px;font-weight:400">'+d.golden.why.text+'</span></div>';
      if(d.golden.why.desc)h+='<div class="urp-card-sub" style="text-align:center;margin-top:6px">'+d.golden.why.desc+'</div>';
      if(d.golden.how)h+='<div class="urp-card-sub" style="text-align:center;margin-top:10px"><strong>HOW</strong> '+d.golden.how+'</div>';
      if(d.golden.what)h+='<div class="urp-card-sub" style="text-align:center;margin-top:4px"><strong>WHAT</strong> '+d.golden.what+'</div>';
      h+='</div>';
    }
    if(d.paradox&&d.paradox.title){
      h+='<div class="urp-card"><div class="urp-card-title">역설</div>';
      h+='<div class="urp-card-text" style="font-style:italic">"'+d.paradox.title+'"</div>';
      if(d.paradox.desc)h+='<div class="urp-card-sub">'+d.paradox.desc+'</div>';
      h+='</div>';
    }
    if((d.surface&&d.surface.length)||(d.essence&&d.essence.length)){
      h+='<div class="urp-grid2"><div class="urp-card"><div class="urp-card-title">SURFACE</div>';
      if(d.surface)d.surface.forEach(function(s){h+='<div class="urp-strike">'+s+'</div>'});
      h+='</div><div class="urp-card"><div class="urp-card-title">ESSENCE</div>';
      if(d.essence)d.essence.forEach(function(s){h+='<div class="urp-bold">'+s+'</div>'});
      h+='</div></div>';
    }
    if(d.pattern&&d.pattern.title){
      h+='<div class="urp-card"><div class="urp-card-title">행동 패턴</div>';
      h+='<div class="urp-card-text">'+d.pattern.title+'</div>';
      if(d.pattern.desc)h+='<div class="urp-card-sub">'+d.pattern.desc+'</div>';
      if(d.pattern.apps&&d.pattern.apps.length){
        h+='<div style="margin-top:8px">';
        d.pattern.apps.forEach(function(a){h+='<div style="font-size:10px;color:#777;padding:2px 0">&rarr; '+a+'</div>'});
        h+='</div>';
      }
      h+='</div>';
    }
    if(d.positioning&&d.positioning.self){
      var ps=d.positioning.self;
      h+='<div class="urp-card"><div class="urp-card-title">포지셔닝</div>';
      h+='<svg class="urp-pos-svg" viewBox="0 0 400 400">';
      h+='<line x1="0" y1="200" x2="400" y2="200" stroke="rgba(0,0,0,0.06)" stroke-width="1"/>';
      h+='<line x1="200" y1="0" x2="200" y2="400" stroke="rgba(0,0,0,0.06)" stroke-width="1"/>';
      h+='<text x="10" y="196" fill="#ccc" font-size="8">트렌드</text>';
      h+='<text x="360" y="196" fill="#ccc" font-size="8">본질</text>';
      h+='<text x="204" y="14" fill="#ccc" font-size="8">전문</text>';
      h+='<text x="204" y="396" fill="#ccc" font-size="8">대중</text>';
      if(d.positioning.others)d.positioning.others.forEach(function(o){
        var ox=o.x*4,oy=o.y*4;
        h+='<circle cx="'+ox+'" cy="'+oy+'" r="4" fill="rgba(0,0,0,0.12)"/>';
        h+='<text x="'+(ox+8)+'" y="'+(oy+3)+'" fill="#bbb" font-size="8">'+o.l+'</text>';
      });
      var sx=ps.x*4,sy=ps.y*4;
      h+='<circle cx="'+sx+'" cy="'+sy+'" r="6" fill="#1a1a1a"/>';
      h+='<text x="'+(sx+12)+'" y="'+(sy+4)+'" fill="#1a1a1a" font-size="9" font-weight="600">'+(d.name||'나')+'</text>';
      h+='</svg></div>';
    }
    if(d.trajectory&&d.trajectory.length){
      h+='<div class="urp-divider">TRAJECTORY</div>';
      h+='<div class="urp-card"><div class="urp-card-title">궤적</div><div class="urp-timeline">';
      d.trajectory.forEach(function(t){
        h+='<div class="urp-tl-item'+(t.now?' now':'')+'"><span class="urp-tl-year">'+t.y+'</span><span class="urp-tl-name">'+t.n+'</span><span class="urp-tl-desc">'+t.d+'</span></div>';
      });
      h+='</div></div>';
    }
    if(d.influences&&d.influences.length){
      h+='<div class="urp-card"><div class="urp-card-title">영향</div>';
      d.influences.forEach(function(inf){h+='<div style="font-size:11px;padding:3px 0"><strong style="font-weight:400;color:#1a1a1a">'+inf.n+'</strong> <span style="color:#999;font-weight:300">'+inf.d+'</span></div>'});
      h+='</div>';
    }
    if(d.materials&&d.materials.length){
      h+='<div class="urp-divider">MATERIAL</div>';
      h+='<div class="urp-card"><div class="urp-card-title">물성 팔레트</div>';
      h+='<div class="urp-mat-board" id="urpMatBoard">';
      if(d.materialImageUrl){h+='<img src="'+d.materialImageUrl+'" alt="Material Board"/>';}
      else{h+='<div style="display:flex;width:100%;height:100%">';d.materials.forEach(function(m){h+='<div style="flex:1;background:'+m.color+'"></div>'});h+='</div>';}
      h+='</div>';
      d.materials.forEach(function(m){
        h+='<div class="urp-mat-item">';
        h+='<span class="urp-mat-dot" style="background:'+m.color+'"></span>';
        h+='<span class="urp-mat-name">'+m.name+'</span>';
        h+='<span class="urp-mat-note">'+m.note+'</span>';
        h+='<span class="urp-mat-desc">'+m.desc+'</span>';
        h+='</div>';
      });
      h+='</div>';
    }
    if(d.spaceScenario){
      h+='<div class="urp-card"><div class="urp-card-title">공간 시나리오</div>';
      h+='<div class="urp-card-text">'+d.spaceScenario+'</div></div>';
    }
    if(d.keywords&&d.keywords.length){
      h+='<div class="urp-divider">ESSENCE KEYWORDS</div>';
      h+='<div class="urp-kw-grid">';
      d.keywords.forEach(function(k){
        h+='<div class="urp-kw-card"><div class="urp-kw-ko">'+k.ko+'</div><div class="urp-kw-en">'+k.en+'</div><div class="urp-kw-desc">'+k.desc+'</div></div>';
      });
      h+='</div>';
    }
    /* Footer */
    h+='<div style="text-align:center;padding:20px 0 8px;font-size:8px;letter-spacing:2px;color:#bbb;font-family:Courier New,monospace">ALETHEIA &mdash; UNMASK</div>';
    urpBody.innerHTML=h;
  }

  /* Print URP content */
  function printURP(){
    var content=urpBody.innerHTML;
    if(!content||urpBody.querySelector('.urp-empty')||urpBody.querySelector('.urp-loading'))return;
    var pw=window.open('','_blank','width=600,height=800');
    var html='<!DOCTYPE html><html><head><meta charset="utf-8"><title>UNMASK — Essence Document</title><style>';
    html+='*{margin:0;padding:0;box-sizing:border-box}';
    html+='body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;padding:32px;max-width:560px;margin:0 auto;color:#1a1a1a;line-height:1.6;background:#fff}';
    html+='.urp-name{font-size:20px;font-weight:300;margin-bottom:2px}';
    html+='.urp-role{font-size:10px;color:#999;font-family:monospace;margin-bottom:14px}';
    html+='.urp-tags{display:flex;flex-wrap:wrap;gap:5px;margin-bottom:20px}';
    html+='.urp-tag{padding:3px 10px;border-radius:14px;font-size:10px;color:#555;border:1px solid rgba(0,0,0,0.1)}';
    html+='.urp-card{background:rgba(0,0,0,0.02);border:1px solid rgba(0,0,0,0.06);border-radius:10px;padding:14px;margin-bottom:10px;page-break-inside:avoid}';
    html+='.urp-card-title{font-size:9px;font-weight:500;color:#999;margin-bottom:6px;letter-spacing:0.04em;text-transform:uppercase}';
    html+='.urp-card-text{font-size:12px;font-weight:300;color:#1a1a1a;line-height:1.7}';
    html+='.urp-card-sub{font-size:11px;font-weight:300;color:#777;line-height:1.6;margin-top:5px}';
    html+='.urp-divider{font-size:8px;font-weight:400;letter-spacing:4px;color:#bbb;font-family:monospace;margin:24px 0 14px;text-align:center}';
    html+='.urp-grid2{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:10px}';
    html+='.urp-strike{text-decoration:line-through;color:#aaa;font-size:10px;line-height:1.7}';
    html+='.urp-bold{font-weight:400;color:#1a1a1a;font-size:10px;line-height:1.7}';
    html+='.urp-timeline{display:flex;flex-direction:column;gap:10px}';
    html+='.urp-tl-item{display:flex;gap:10px;font-size:10px;color:#777}';
    html+='.urp-tl-item.now{color:#1a1a1a;font-weight:400}';
    html+='.urp-tl-year{width:54px;flex-shrink:0;font-family:monospace;font-size:9px}';
    html+='.urp-tl-name{width:44px;flex-shrink:0;font-weight:400}';
    html+='.urp-tl-desc{flex:1;font-weight:300}';
    html+='.urp-mat-board{width:100%;aspect-ratio:16/9;border-radius:8px;overflow:hidden;margin-bottom:12px}';
    html+='.urp-mat-item{display:flex;align-items:flex-start;gap:8px;padding:6px 0;border-bottom:1px solid rgba(0,0,0,0.04);font-size:10px}';
    html+='.urp-mat-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;margin-top:2px}';
    html+='.urp-mat-name{font-weight:400;min-width:40px}';
    html+='.urp-mat-note{color:#999;font-family:monospace;font-size:8px}';
    html+='.urp-mat-desc{color:#777;font-weight:300;flex:1}';
    html+='.urp-kw-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}';
    html+='.urp-kw-card{background:rgba(0,0,0,0.02);border:1px solid rgba(0,0,0,0.06);border-radius:8px;padding:12px}';
    html+='.urp-kw-ko{font-size:13px;font-weight:300;margin-bottom:2px}';
    html+='.urp-kw-en{font-size:7px;letter-spacing:0.1em;color:#bbb;font-family:monospace;margin-bottom:5px}';
    html+='.urp-kw-desc{font-size:9px;font-weight:300;color:#777;line-height:1.5}';
    html+='.urp-golden-svg{display:block;margin:0 auto 12px;max-width:120px}';
    html+='.urp-pos-svg{display:block;width:100%;max-width:320px;margin:0 auto}';
    html+='@media print{body{padding:16px}}';
    html+='</style></head><body>'+content+'</body></html>';
    pw.document.write(html);
    pw.document.close();
    setTimeout(function(){pw.print()},300);
  }

  /* Fetch analysis from API */
  function fetchFounderAnalysis(){
    if(founderLoading)return;
    if(!window.conversationHistory||window.conversationHistory.length<4){
      urpBody.innerHTML='<div class="urp-empty">대화가 더 필요합니다.<br>최소 2턴 이상 대화를 진행해주세요.</div>';
      openURP();
      return;
    }
    founderLoading=true;
    urpBody.innerHTML='<div class="urp-loading">분석 중...</div>';
    openURP();
    var convText=window.conversationHistory.map(function(m){return (m.role==='user'?'[사용자]':'[Aletheia]')+': '+m.content}).join('\n\n');
    fetch('/api/chat',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({
        mode:SYSTEM_FOUNDER,
        messages:[{role:'user',content:'다음 대화를 분석하여 창업자 분석 데이터를 추출하세요.\n\n'+convText}],
        max_tokens:2000,
        sessionId:window.aletheiaSessionId||'',
        userId:'user_'+(window.aletheiaSessionId||'')
      })
    }).then(function(r){return r.json()}).then(function(data){
      founderLoading=false;
      if(data.error)throw new Error(data.error.message);
      var text=data.content.map(function(c){return c.type==='text'?c.text:''}).join('');
      var json;
      try{
        var mt=text.match(/```json\n?([\s\S]*?)\n?```/)||text.match(/\{[\s\S]*\}/);
        json=JSON.parse(mt?(mt[1]||mt[0]):text);
      }catch(e){
        urpBody.innerHTML='<div class="urp-empty">분석 데이터를 파싱할 수 없습니다.</div>';
        return;
      }
      founderData=json;
      buildPanel(json);
    }).catch(function(e){
      founderLoading=false;
      console.error('Founder analysis error:',e);
      urpBody.innerHTML='<div class="urp-empty">분석 중 오류가 발생했습니다.<br>'+e.message+'</div>';
    });
  }

  window.openFounderPanel=function(){fetchFounderAnalysis()};
  window.closeFounderPanel=closeURP;
})();
</script>

</body>
</html>
